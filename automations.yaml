- id: '1735793299155456532216'
  alias: Integration Watchdog
  description: This automation watches entities to ensure the integration is functioning;
    if not, it will restart it.
  triggers:
  - trigger: state
    entity_id:
    - camera.driveway_cam_0
    - camera.garage_cam_0
    - camera.den_cam_0
    - camera.patio_cam_0
    - camera.go2rtc_streams_front_door
    to: unavailable
    for:
      minutes: 2
  actions:
  - action: homeassistant.reload_config_entry
    target:
      entity_id: '{{ trigger.entity_id }}'
  mode: queued
  max: 10
  initial_state: true
- id: '17055772299155456532'
  mode: single
  alias: Start Voice assistant initiated Timer When Duration Set and notify when completed
  triggers:
  - trigger: numeric_state
    entity_id:
    - input_number.timer_minutes
    - input_number.timer_seconds
    above: 0
  action:
  - delay: 1
  - action: timer.set_duration
    target:
      entity_id: timer.voice_timer
    data_template:
      duration: 00:{{ states('input_number.timer_minutes') | int }}:{{ states('input_number.timer_seconds')
        | int }}
  - delay: 1
  - action: timer.start
    entity_id: timer.voice_timer
  - wait_for_trigger:
      trigger: state
      entity_id: timer.voice_timer
      from: active
      to: idle
  - action: notify.mobile_app_pixel_8_pro
    data_template:
      title: Timer Finished
      message: '{{ state_attr(''timer.voice_timer'', ''duration'') }} timer has finished'
  - delay: 1
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: TTS
      data:
        ttl: 0
        priority: high
        tts_text: The timer has finished
  - action: input_number.set_value
    data:
      value: 0
    target:
      entity_id:
      - input_number.timer_seconds
      - input_number.timer_minutes
- id: '18011577229915545231'
  alias: Turn ON backyard lights when door opened
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.back_door1
    - binary_sensor.backdoor_bt_sensor
    - binary_sensor.back_motion
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.disable_exterior_motion
    state: 'off'
  - condition: or
    conditions:
    - condition: sun
      after: sunset
      after_offset: 00:15:00
    - condition: sun
      before: sunrise
      before_offset: 00:15:00
  actions:
  - action: light.turn_on
    continue_on_error: true
    target:
      entity_id: light.backyard_lights
  - delay:
      minutes: 15
  - action: light.turn_off
    continue_on_error: true
    target:
      entity_id: light.backyard_lights
  mode: restart
- id: '1705577229915545'
  alias: Reload kiosk when lovelace is updated
  triggers:
  - trigger: event
    event_type: lovelace_updated
  condition:
  - condition: state
    entity_id: input_boolean.kiosk_auto_refresh
    state: 'on'
  action:
  - action: lovelace.reload_resources
  - delay: 6
  - choose:
    - conditions:
      - condition: state
        entity_id: switch.main_kiosk_screen
        state: 'off'
      sequence:
      - action: switch.turn_on
        entity_id: switch.main_kiosk_screen
      - delay: 2
      - action: button.press
        target:
          entity_id: button.main_kiosk_load_start_url
    - conditions:
      - condition: state
        entity_id: switch.main_kiosk_screen
        state: 'on'
      sequence:
      - delay: 2
      - action: button.press
        target:
          entity_id: button.main_kiosk_load_start_url
  - choose:
    - conditions:
      - condition: state
        entity_id: switch.ensuite_kiosk_screen
        state: 'off'
      sequence:
      - action: switch.turn_on
        entity_id: switch.ensuite_kiosk_screen
      - delay: 2
      - action: button.press
        target:
          entity_id: button.ensuite_kiosk_load_start_url
    - conditions:
      - condition: state
        entity_id: switch.ensuite_kiosk_screen
        state: 'on'
      sequence:
      - delay: 2
      - action: button.press
        target:
          entity_id: button.ensuite_kiosk_load_start_url
  mode: single
- id: '17016739887151444'
  alias: Reboot Kiosk
  mode: restart
  triggers:
  - trigger: state
    entity_id:
    - switch.main_kiosk_screen
    - light.main_kiosk_screen
    to: 'off'
    for:
      seconds: 10
  conditions:
  - condition: time
    after: 05:00:00
    before: '23:00:00'
  actions:
  - action: switch.turn_on
    target:
      entity_id: switch.main_kiosk_screen
  - delay:
      seconds: 5
  - action: light.turn_on
    target:
      entity_id: light.main_kiosk_screen
  - delay:
      seconds: 5
  - action: button.press
    target:
      entity_id: button.main_kiosk_load_start_url
- id: '1754999377123967'
  alias: '[Notify] Garage Fridge OFF'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: switch.kitchen_fridge
    to: 'off'
    for:
      minutes: 2
  action:
  - action: notify.mobile_app_pixel_8_pro
    data_template:
      message: 'Garage fridge turned off at ''{{ now().strftime(''%I:%M %p'') }}'' '
  - delay: 00:15:00
  - action: homeassistant.turn_on
    entity_id: switch.kitchen_fridge
  - action: notify.mobile_app_pixel_8_pro
    data_template:
      message: 'Garage fridge turned back on at ''{{ now().strftime(''%I:%M %p'')
        }}'' '
- id: '421345566532245565054'
  alias: '[Motion] Nightlights and Kiosk'
  description: Manages Den nightlights and Kiosk wake/sleep based on motion.
  mode: restart
  triggers:
  - trigger: state
    entity_id: binary_sensor.den_night_light_motion
    to: 'on'
  variables:
    is_night: '{{ now().hour >= 23 or now().hour < 5 or (now().hour == 5 and now().minute
      < 30) }}

      '
  actions:
  - action: light.turn_on
    target:
      entity_id: light.den_night_lights_zb
    data:
      hs_color:
      - '{{ range(360)|random }}'
      - '{{ range(80,101)|random }}'
      brightness_pct: '{{ 30 if is_night else 100 }}'
  - if:
    - condition: template
      value_template: '{{ not is_night }}'
    then:
    - action: switch.turn_on
      target:
        entity_id: switch.main_kiosk_screen
    - action: light.turn_on
      target:
        entity_id: light.main_kiosk_screen
    - if:
      - condition: state
        entity_id: input_boolean.camera_motion_detected
        state: 'off'
      then:
      - action: browser_mod.navigate
        data:
          path: /lovelace/newtab
          browser_id:
          - 22de4b5bc46885f8fafdf89c6db80a28
          - 6077e78a0bccd7ab8ef18e1689611a46
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.den_night_light_motion
      to: 'off'
      for:
        seconds: 90
  - action: light.turn_off
    target:
      entity_id: light.den_night_lights_zb
  - choose:
    - conditions: '{{ is_night }}'
      sequence:
      - delay: 15
      - action: light.turn_off
        target:
          entity_id: light.main_kiosk_screen
    default:
    - action: browser_mod.navigate
      data:
        path: /lovelace/screen
        browser_id:
        - 22de4b5bc46885f8fafdf89c6db80a28
        - 6077e78a0bccd7ab8ef18e1689611a46
- id: '17099299999977'
  alias: '[Tablet] Toggle tablet icons color'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: input_boolean.tablet_icons_color
  action:
  - action: homeassistant.turn_{{- trigger.to_state.state -}}
    data:
      entity_id: group.tablet_icons
- id: '302170975645999164'
  alias: '[Timer] 15 minute HVAC Fan timer'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: input_button.hvac_15_fan_timer
  action:
  - action: climate.set_fan_mode
    data:
      fan_mode: 'on'
    target:
      entity_id: climate.den
  - delay:
      minutes: 15
  - action: climate.set_fan_mode
    data:
      fan_mode: 'off'
    target:
      entity_id: climate.den
- id: '312170975645999164'
  alias: '[Timer] 30 minute HVAC Fan timer'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: input_button.hvac_30_fan_timer
  action:
  - action: climate.set_fan_mode
    data:
      fan_mode: 'on'
    target:
      entity_id: climate.den
  - delay:
      minutes: 30
  - action: climate.set_fan_mode
    data:
      fan_mode: 'off'
    target:
      entity_id: climate.den
- id: '17099999919856349'
  alias: '[Notify] Coffee Maker ON'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: switch.coffee_maker
    to: 'on'
  action:
  - action: homeassistant.turn_on
    entity_id: light.coffee_light
  - action: notify.mobile_app_pixel_8_pro
    data_template:
      title: ⚠️Coffee☕️ Maker ON
      message: ' at {{ states(''sensor.time_12_hour_am_pm'') }}'
- id: '170999999299876354'
  alias: '[TIMER] Fountain'
  triggers:
  - trigger: time
    at: '20:00:00'
  action:
  - action: switch.turn_on
    target:
      entity_id: switch.patio_fountain_plug
  - delay: 600
  - action: switch.turn_off
    target:
      entity_id: switch.patio_fountain_plug
  initial_state: true
- id: '170999999799168'
  alias: '[Motion] Kitchen Motion Lights'
  triggers:
  - trigger: state
    entity_id: binary_sensor.kitchen_bt_motion
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.kitchen_bt_motion_2
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.kitchen_bt_motion_3
    from: 'off'
    to: 'on'
  - type: occupied
    device_id: 11ae90ced5ee1712eecfff81dc93849c
    entity_id: 4cee93a6bdbf5e7c5eadbf7db0533093
    domain: binary_sensor
    trigger: device
  - type: occupied
    device_id: 4375f563aa247e4c2b721de05710a219
    entity_id: 5127d146841319d4f08e18845430f13a
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: state
    entity_id: group.person_group
    state: home
    enabled: true
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: time
        after: '23:00:01'
        before: 05:30:00
      sequence:
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id:
          - light.under_cabinet_lights
    - conditions:
      - condition: time
        after: 05:30:01
        before: 08:00:00
      sequence:
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id:
          - light.under_cabinet_lights
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 70
    - conditions:
      - condition: time
        after: 08:00:01
        before: '20:00:00'
      sequence:
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id:
          - light.under_cabinet_lights
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 90
    - conditions:
      - condition: time
        after: '20:00:01'
        before: '23:00:00'
      sequence:
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id:
          - light.under_cabinet_lights
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 45
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.kitchen_occupancy_sensors
      to:
      - 'off'
      for:
        hours: 0
        minutes: 1
        seconds: 35
    timeout:
      minutes: 30
    continue_on_timeout: true
  - action: light.turn_off
    continue_on_error: true
    target:
      entity_id: light.kitchen_ceiling_lights_3
  - action: light.turn_off
    continue_on_error: true
    target:
      entity_id: light.table_light
  - delay: 900
  - action: light.turn_off
    continue_on_error: true
    target:
      entity_id:
      - light.under_cabinet_lights
  mode: restart
  max_exceeded: silent
  initial_state: true
- id: '1701618177497534'
  alias: '[Motion] Entryway Motion Lights'
  description: ''
  triggers:
  - trigger: state
    entity_id: binary_sensor.entryway_motion
    from: 'off'
    to: 'on'
  conditions:
  - condition: state
    entity_id: group.person_group
    state: home
    enabled: true
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  actions:
  - action: light.turn_on
    continue_on_error: true
    target:
      entity_id:
      - light.entryway_ceiling_dimmer
      - light.laundry_room_dimmer
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.entryway_motion
      from: 'on'
      to: 'off'
    timeout:
      minutes: 30
    continue_on_timeout: true
  - delay: 30
  - action: light.turn_off
    continue_on_error: true
    target:
      entity_id:
      - light.entryway_ceiling_dimmer
      - light.laundry_room_dimmer
  mode: restart
  max_exceeded: silent
  initial_state: true
- id: '179161817217497534'
  alias: '[Motion] Foyer Motion Lights'
  description: ''
  triggers:
  - trigger: state
    entity_id: binary_sensor.foyer_motion_sensors
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  action:
  - action: light.turn_on
    continue_on_error: true
    target:
      entity_id: light.foyer_lights
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.foyer_motion_sensors
      from: 'on'
      to: 'off'
    timeout:
      minutes: 30
    continue_on_timeout: true
  - delay: 90
  - action: light.turn_off
    continue_on_error: true
    target:
      entity_id: light.foyer_lights
  mode: restart
  max_exceeded: silent
- id: '17016185774975347'
  alias: '[Notify] Auto Notifications ON'
  triggers:
  - trigger: time
    at: '23:00:00'
  action:
  - action: input_boolean.turn_on
    entity_id:
    - input_boolean.camera_snapshots
    - input_boolean.patio_garage_alerts
    - input_boolean.door_announcements
    - input_boolean.disable_laundry_notifications
  - action: input_boolean.turn_off
    entity_id:
    - input_boolean.motion_lights
    - input_boolean.disable_popups
    - input_boolean.auto_tablet
    - input_boolean.auto_backgroundz
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: "⚠️️Notifications\U0001F4E2 turned ON"
  initial_state: true
  mode: single
- id: '17016161677497534'
  alias: '[Alarmo] Auto Night Arm'
  triggers:
  - trigger: time
    at: '23:56:00'
  conditions:
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: disarmed
  actions:
  - choose:
    - conditions:
      - condition: time
        weekday:
        - fri
        - sat
      sequence:
      - action: notify.mobile_app_pixel_8_pro
        continue_on_error: true
        data:
          message: TTS
          data:
            ttl: 0
            priority: high
            tts_text: The alarm will be activated in three minutes.
      - delay: 180
      - target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
        action: alarm_control_panel.alarm_arm_home
    - conditions:
      - condition: time
        weekday:
        - sun
        - mon
        - tue
        - wed
        - thu
      sequence:
      - delay: 180
      - target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
        action: alarm_control_panel.alarm_arm_home
  initial_state: true
- id: '17071774947534873644'
  alias: '[Alarmo] Someone''s awake run Morning script & Disarm alarm'
  triggers:
  - trigger: state
    entity_id: input_boolean.darren_is_awake
    to: 'on'
  - trigger: state
    entity_id: input_boolean.donna_is_awake
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.morning_triggered_today
    state: 'off'
  - condition: time
    after: 06:00:00
    before: '11:00:00'
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: device
        device_id: 796b669c1f2c31677ae6e0a838928d34
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: is_armed_home
      - condition: device
        device_id: 796b669c1f2c31677ae6e0a838928d34
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: is_armed_night
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.den_main_motion
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id:
      - binary_sensor.kitchen_motion_sensors
      from: 'off'
      to: 'on'
  - action: script.morning
  mode: single
  initial_state: true
- id: '17016181157497534'
  alias: Notify us when the garage door opens and no one home
  triggers:
  - trigger: state
    entity_id: group.person_group
    to: not_home
    for:
      minutes: 2
  condition:
  - condition: state
    entity_id: cover.garage_door
    state: open
  action:
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: TTS
      data:
        ttl: 0
        priority: high
        tts_text: The garage is open.
  - delay: 5
  - action: notify.notify_all
    data:
      message: The garage is open and no one is home!!!
      data:
        color: red
        actions:
        - action: close_garage
          title: Close Garage Door
      title: GARAGE IS OPEN
- id: '17016181274497534'
  alias: Close the garage when notification action is tapped
  trigger:
    trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: close_garage
  action:
    action: cover.close_cover
    entity_id: cover.garage_door
- id: '17016181237497534'
  alias: Notify when desk light goes off
  triggers:
  - trigger: state
    entity_id:
    - light.desk_light
    to: 'off'
  condition:
  - condition: state
    entity_id: person.darren
    state: not_home
  action:
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: Desk light off
      data:
        color: red
        actions:
        - action: turn_on
          title: Turn light on
- id: '17016181474697534'
  alias: Turn desk light on when notification action is tapped
  trigger:
    trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: turn_on
  action:
    action: light.turn_on
    entity_id: light.desk_light
- id: '17016181374977534434343'
  alias: Notify when AC unit goes off
  triggers:
  - trigger: state
    entity_id:
    - climate.den
    to: 'off'
    for:
      minutes: 1
  action:
  - action: notify.notify_all
    data:
      message: A/C Unit is off
      data:
        color: red
        actions:
        - action: turn_on_ac
          title: Turn AC on
- id: '17016181474947534545454'
  alias: Turn AC unit on when notification action is tapped
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: turn_on_ac
  action:
  - delay: 00:05:00
  - action: homeassistant.turn_on
    entity_id: climate.den
- id: '17016499927893058'
  alias: Update notifications
  use_blueprint:
    path: mdegat01/update_notifications.yaml
    input:
      reminder_hours: '3'
      update_entities:
      - update.home_assistant_core_update
      - update.home_assistant_google_drive_backup_update
      - update.home_assistant_operating_system_update
      - update.home_assistant_supervisor_update
      - update.zerotier_one_update
      - update.mariadb_update
      - update.network_ups_tools_update
      - update.mosquitto_broker_update
      - update.nginx_home_assistant_ssl_proxy_update
      - update.silicon_labs_multiprotocol_update
      - update.studio_code_server_update
      mobile_app_device: 5402f427ac93601eeab00b7fc7d6f6da
      send_to_ha: true
      take_backup: false
      only_before: '23:00:00'
      only_after: 07:00:00
      run_config_check: false
      mobile_app_device_2: 5402f427ac93601eeab00b7fc7d6f6da
- id: '17091227643669'
  alias: '[AUTO] Bathroom vent when door opened'
  trigger:
  - type: opened
    trigger: device
    device_id: ddfdaa597a6f3d5253692718365c95a1
    entity_id: 7d7ea576c802654a8876e7ae82d10add
    domain: binary_sensor
  action:
  - action: switch.turn_on
    target:
      entity_id: switch.bathroom_vent
  - delay:
      minutes: 3
  - action: switch.turn_off
    target:
      entity_id: switch.bathroom_vent
  mode: restart
- id: '170112684169772'
  alias: Sports sensor update
  triggers:
  - trigger: time_pattern
    seconds: '59'
  condition:
  - condition: state
    entity_id: input_boolean.sports_updates
    state: 'on'
  action:
  - action: homeassistant.update_entity
    target:
      entity_id:
      - sensor.predators
      - sensor.atlanta_braves
      - sensor.saints
      - sensor.titans
  mode: single
- id: '170163035746544'
  alias: Notify of Camera channel importance
  trigger: []
  action:
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: Motion Detected
      data:
        channel: Cameras
        ledColor: red
- id: '384450173036339632'
  alias: Side Door Camera live view for wall mounted Nest
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.side_motion_sensor
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.camera_snapshots
    state: 'on'
  action:
  - action: google_assistant_sdk.send_text_command
    continue_on_error: true
    data:
      command: Show me the side door camera on entryway display
  - delay:
      minutes: 5
  mode: single
- id: '493724371155444526'
  alias: camera motion switch OFF after 3 mins
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.camera_motion_detected
    to: 'on'
  actions:
  - delay:
      minutes: 3
  - action: input_boolean.turn_off
    entity_id: input_boolean.camera_motion_detected
  mode: restart
  max_exceeded: silent
- id: '170223138270251'
  alias: '[Motion] Garage Motion Lights revised'
  description: Handles garage lighting brightness based on time of day using Group
    Sensor
  triggers:
  - trigger: state
    entity_id: binary_sensor.garage_occupied
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: time
        after: 09:00:00
        before: '21:30:00'
      sequence:
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id: light.garage_lights
        data:
          brightness_pct: 100
    default:
    - action: light.turn_on
      continue_on_error: true
      target:
        entity_id: light.garage_lights
      data:
        brightness_pct: 35
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.garage_occupied
      to: 'off'
      for:
        minutes: 10
    timeout: 01:00:00
    continue_on_timeout: false
  - action: light.turn_off
    continue_on_error: true
    target:
      entity_id: light.garage_lights
  mode: restart
  max_exceeded: silent
- id: '170233166895065'
  alias: Darren's Alarm Pixel 8 pro next alarm
  triggers:
  - trigger: template
    value_template: '{{ states(''sensor.date_time'') == (as_timestamp(states.sensor.pixel_8_pro_next_alarm.state,
      default=0) |int -1)| timestamp_custom(''%Y-%m-%d, %H:%M'', True) }}'
  conditions:
  - condition: state
    entity_id: input_boolean.darren_s_alarm_triggered_today
    state: 'off'
  - condition: state
    entity_id: person.darren
    state: home
  actions:
  - action: script.darrens_wake_up
  mode: single
- id: '1703172027074'
  alias: Donna's Alarm Pixel 5 next alarm
  triggers:
  - trigger: template
    value_template: '{{ states(''sensor.date_time'') == (as_timestamp(states.sensor.pixel_5_next_alarm.state,
      default=0) |int -1)| timestamp_custom(''%Y-%m-%d, %H:%M'', True) }}'
  conditions:
  - condition: state
    entity_id: input_boolean.donna_s_alarm_triggered_today
    state: 'off'
  - condition: state
    entity_id: person.donna
    state: home
  actions:
  - action: script.donnas_wake_up
  mode: single
- id: '170243184400922'
  alias: '[Motion] Guest Motion Lights'
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.guest_bt_motion
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.guest_motion
    from: 'off'
    to: 'on'
  conditions:
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  actions:
  - action: light.turn_on
    data: {}
    target:
      entity_id:
      - light.night_light_6
      - light.guest_night_lights
      - light.guest_ceiling_lights
  - wait_template: '{{ not is_state(''binary_sensor.guest_room_motion'', ''on'') }}'
  - delay:
      hours: 0
      minutes: 1
      seconds: 30
      milliseconds: 0
  - action: light.turn_off
    target:
      entity_id:
      - light.night_light_6
      - light.guest_night_lights
      - light.guest_ceiling_lights
  mode: restart
  max_exceeded: silent
- id: '17025318794468582'
  alias: '[Motion] Someone''s at the Table'
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_table_motion_sensors
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  action:
  - action: light.turn_on
    target:
      device_id: 760cfce120cdf3eedbaa7f35d36aa2db
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.kitchen_table_motion_sensors
      from: 'on'
      to: 'off'
  - delay:
      minutes: 15
  - action: light.turn_off
    target:
      device_id: 760cfce120cdf3eedbaa7f35d36aa2db
  mode: restart
  max_exceeded: silent
- id: '19317603288153054'
  alias: Patio LEDs ON at sunset
  mode: single
  triggers:
  - trigger: sun
    event: sunset
    offset: +00:20:00
  actions:
  - type: turn_on
    device_id: ea11a241127e97442fb1c99327e49b59
    entity_id: 914303f3da00efeb0ba5e45707be8974
    domain: switch
- id: '19936353603288153054'
  alias: Patio LEDs ON when Donna is awake
  triggers:
  - trigger: state
    entity_id: binary_sensor.donna_is_awake
    to: 'on'
  conditions:
  - condition: sun
    before: sunrise
    before_offset: 45
  actions:
  - type: turn_on
    device_id: ea11a241127e97442fb1c99327e49b59
    entity_id: 914303f3da00efeb0ba5e45707be8974
    domain: switch
  - wait_for_trigger:
    - trigger: state
      entity_id: person.donna
      to: not_home
  - type: turn_off
    device_id: ea11a241127e97442fb1c99327e49b59
    entity_id: 914303f3da00efeb0ba5e45707be8974
    domain: switch
  - action: switch.turn_on
    target:
      entity_id: switch.office_work_bench_zb
  mode: single
- id: '170343250676301455712'
  alias: Donna is awake
  triggers:
  - trigger: state
    entity_id:
    - light.bedroom_lights
    to: 'on'
  conditions:
  - condition: time
    before: '11:00:00'
    after: 05:00:00
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.bedroom_door
      to: 'on'
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.donna_is_awake
  - action: switch.turn_on
    target:
      entity_id: switch.office_work_bench_zb
  mode: restart
- id: '17034325444301455712'
  alias: Darren is awake
  triggers:
  - trigger: state
    entity_id:
    - light.office_lights
    to: 'on'
  conditions:
  - condition: time
    before: '11:00:00'
    after: 05:00:00
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.office_motion_sensors
      to: 'on'
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.darren_is_awake
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.naptime
  - action: switch.turn_on
    target:
      entity_id: switch.ha2_office_monitor
  - action: media_player.volume_set
    continue_on_error: true
    data:
      entity_id: media_player.office_display
      volume_level: 0.4
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: command_broadcast_intent
      data:
        intent_package_name: com.urbandroid.sleep
        intent_action: com.urbandroid.sleep.alarmclock.STOP_SLEEP_TRACK
        ttl: 0
        priority: high
  - delay:
      seconds: 5
  - device_id: a1e84293f3bbd9cb62393962d06c9783
    domain: select
    entity_id: 29d0aad0050f80c41f3da43c733a8404
    type: select_last
  - delay:
      seconds: 5
  - device_id: a1e84293f3bbd9cb62393962d06c9783
    domain: select
    entity_id: 5fc820debd0a25d6a51ae4d261fa391c
    type: select_first
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.door_announcements
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.radar_updates
  - action: switch.turn_on
    target:
      entity_id: switch.keurig_coffee_maker
  - action: switch.turn_on
    target:
      entity_id: switch.office_work_bench_zb
  mode: single
- id: '1703432544430144455712'
  alias: Everyone is awake
  mode: single
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.everyone_awake
    to: 'on'
  action:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.everyone_is_awake
  - action: media_player.volume_set
    target:
      entity_id: media_player.den_mini
    data:
      volume_level: 0.45
- id: '170883399227153856993332311'
  alias: Romance Time
  description: ''
  mode: single
  triggers:
  - trigger: device
    device_id: b91c3dd0f0e777342b0b6792efcb8dff
    domain: bthome
    type: button
    subtype: double_press
  - trigger: state
    entity_id:
    - input_boolean.romance_time
    to: 'on'
  - trigger: state
    entity_id:
    - input_boolean.romance_time_2
    to: 'on'
  action:
  - action: light.turn_off
    target:
      entity_id: light.bedroom_lights
  - action: light.turn_on
    target:
      entity_id: light.nightstand_lamps
    data:
      color_name: red
      brightness_pct: 4
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.romance_time
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.romance_time_2
- id: '1938466447855442387'
  alias: Office Occupancy Lights
  triggers:
  - trigger: state
    entity_id: binary_sensor.office_motion_sensors
    from: 'off'
    to: 'on'
  - type: occupied
    device_id: 66bf747d7602dd0c9f8320299e66f1df
    entity_id: 67cb3789db2356f8ed82959441d19e4e
    domain: binary_sensor
    trigger: device
  condition:
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  - condition: state
    entity_id: input_boolean.naptime
    state: 'off'
  action:
  - choose:
    - conditions:
      - condition: time
        before: '20:29:59'
        after: 09:00:01
      - condition: state
        entity_id: light.office_lights
        state: 'off'
      sequence:
      - action: light.turn_on
        data:
          brightness_pct: 30
        target:
          entity_id: light.office_lights
    - conditions:
      - condition: time
        before: '23:59:00'
        after: '20:30:00'
      - condition: state
        entity_id: light.office_lights
        state: 'off'
      sequence:
      - action: light.turn_on
        data:
          brightness_pct: 5
        target:
          entity_id: light.office_lights
    - conditions:
      - condition: time
        before: 09:00:00
        after: '23:59:01'
      sequence:
      - delay: 300
  - wait_for_trigger:
    - type: not_occupied
      device_id: 66bf747d7602dd0c9f8320299e66f1df
      entity_id: 67cb3789db2356f8ed82959441d19e4e
      domain: binary_sensor
      trigger: device
    timeout: 00:30:00
    continue_on_timeout: true
  - action: light.turn_off
    entity_id: light.office_lights
  mode: restart
  max_exceeded: silent
- id: '202946321485676354'
  alias: '[TIMER] Toothbrush Charger'
  triggers:
  - trigger: time
    at: 02:30:00
  action:
  - action: switch.turn_on
    target:
      entity_id: switch.bathroom_night_light_plug
  - delay:
      minutes: 20
  - action: switch.turn_off
    target:
      entity_id: switch.bathroom_night_light_plug
  initial_state: true
- id: '204446321485676354'
  alias: Sleep track announce
  description: ''
  mode: single
  use_blueprint:
    path: IATkachenko/full.yaml
    input:
      device: 11f7d4c43d0425242be095e2da738148
      person: person.darren
      sleep_tracking_started:
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: sleep tracking started
        target:
          device_id: c9ec3cc293f9997730f69821b949bae1
      sleep_tracking_stopped:
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: sleep tracking stopped, awake now
        target:
          entity_id: assist_satellite.home_assistant_voice_095e78_assist_satellite
- id: nws_persistent_notifications
  alias: NWS - Persistent Notifications
  triggers:
  - trigger: state
    entity_id: sensor.nws_alerts_alerts
  conditions:
  - condition: numeric_state
    entity_id: sensor.nws_alerts_alerts
    above: 0
  actions:
  - repeat:
      sequence:
      - action: script.nws_alerts_persistent_notification
        data:
          notification_id: NWS_{{ repeat.item.ID }}
          title: 'NWS Alert: {{ repeat.item.Event }}'
          message: '{{ repeat.item.Description }}'
      - delay:
          seconds: 5
      for_each: '{{ trigger.to_state.attributes.Alerts | reject(''in'', trigger.from_state.attributes.Alerts)
        | sort(attribute=''ID'') | list() }}'
  mode: queued
  initial_state: true
  max: 10
- alias: NWS - TTS Announcements
  id: nws_tts_announcements
  description: ''
  triggers:
  - trigger: state
    entity_id: sensor.nws_alerts_alerts
  condition:
  - condition: numeric_state
    entity_id: sensor.nws_alerts_alerts
    above: 0
  action:
  - repeat:
      sequence:
      - variables:
          alert: '{{ repeat.item }}'
      - if:
        - condition: template
          value_template: '{{ (''Tornado Warning'' in alert.Event) and (alert.Type
            == ''Alert'') }}'
        then:
        - action: script.turn_on
          entity_id: script.nws_alerts_announce_tornado_warning
        - delay:
            minutes: 1
      for_each: '{{ trigger.to_state.attributes.Alerts | reject(''in'', trigger.from_state.attributes.Alerts)
        | list() | sort(attribute=''ID'') }}'
  - repeat:
      sequence:
      - variables:
          alert: '{{ repeat.item }}'
      - if:
        - condition: template
          value_template: '{{ (''Hurricane Warning'' in alert.Event) and (alert.Type
            == ''Alert'') }}'
        then:
        - action: script.turn_on
          entity_id: script.nws_alerts_announce_hurricane_warning
        - delay:
            minutes: 1
      for_each: '{{ trigger.to_state.attributes.Alerts | reject(''in'', trigger.from_state.attributes.Alerts)
        | list() | sort(attribute=''ID'') }}'
  - repeat:
      sequence:
      - variables:
          alert: '{{ repeat.item }}'
      - if:
        - condition: template
          value_template: '{{ (''Severe Thunderstorm Warning'' in alert.Event) and
            (alert.Type == ''Alert'') }}'
        then:
        - action: script.turn_on
          entity_id: script.nws_alerts_announce_thunderstorm_warning
        - delay:
            minutes: 1
      for_each: '{{ trigger.to_state.attributes.Alerts | reject(''in'', trigger.from_state.attributes.Alerts)
        | list() | sort(attribute=''ID'') }}'
  mode: queued
  initial_state: true
  max: 10
- id: '17591923683508746'
  alias: Unavailable Entities 2-Hour Check
  description: Checks for unavailable entities every 2 hours and notifies if any are
    found.
  triggers:
  - trigger: time_pattern
    hours: /2
  conditions:
  - condition: numeric_state
    entity_id: sensor.unavailable_monitored_entities
    above: 0
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.unavailable_monitored_entities
        above: 1
      sequence:
      - action: notify.mobile_app_pixel_8_pro
        data:
          title: ⚠️ Multiple Entities Unavailable
          message: '{{ state_attr(''sensor.unavailable_monitored_entities'', ''unavailable'')
            }} are unresponsive.'
          data:
            color: '#2DF56D'
            timeout: 3600
            channel: alert
            group: alert
            sticky: true
            importance: high
            notification_icon: mdi:alert
    - conditions:
      - condition: numeric_state
        entity_id: sensor.unavailable_monitored_entities
        above: 0
      sequence:
      - action: notify.mobile_app_pixel_8_pro
        data:
          title: ⚠️ Entity Unavailable
          message: '{{ state_attr(''sensor.unavailable_monitored_entities'', ''unavailable'')
            }} is unresponsive.'
          data:
            color: '#2DF56D'
            timeout: 3600
            channel: alert
            group: alert
            sticky: true
            importance: high
            notification_icon: mdi:alert
  mode: restart
- id: '1759252390526'
  alias: Garage lights toggle
  description: toggle garage lights from inside switch
  triggers:
  - trigger: state
    entity_id: light.garage_lights_inside_switch_2
    to: 'on'
  conditions: []
  actions:
  - action: light.toggle
    target:
      entity_id: light.garage_lights
  - delay:
      milliseconds: 400
  - action: light.turn_off
    target:
      entity_id: light.garage_lights_inside_switch_2
  mode: single
- id: '1759522343255'
  alias: Ask to turn off Kitchen lights
  description: ''
  triggers:
  - device_id: 9f8903e6cdbcbc55cc414977469add59
    domain: media_player
    entity_id: 050c24fca8fc92011ebaf0f8b1503941
    type: turned_on
    trigger: device
  - type: turned_on
    device_id: bc73bb14e38e8396900015b6b0d86506
    entity_id: b095ef8167ec83b5d78ca9612c91671b
    domain: light
    trigger: device
  conditions: []
  actions:
  - action: script.ask_a_yes_no_question_turn_off_kitchen_lights
    data:
      preannounce: true
      voice_assistant: assist_satellite.home_assistant_voice_09c5e8_assist_satellite
  mode: single
- id: update_previous_unavailable_entity_helpers
  alias: Update Previous Unavailable Entity Helpers
  description: ''
  triggers:
  - entity_id: sensor.unavailable_monitored_entities
    trigger: state
  actions:
  - target:
      entity_id: input_text.previous_unavailable_count
    data:
      value: '{{ trigger.from_state.state }}'
    action: input_text.set_value
  - target:
      entity_id: input_text.previous_unavailable_list
    data:
      value: '{{ trigger.from_state.attributes.unavailable }}'
    action: input_text.set_value
- id: '1759810465021'
  alias: NWS - Mobile FLOOD notifications II
  description: ''
  triggers:
  - trigger: state
    entity_id: sensor.nws_alerts_alerts
  conditions:
  - condition: numeric_state
    entity_id: sensor.nws_alerts_alerts
    above: 0
  actions:
  - if:
    - condition: template
      value_template: '{{ "Flood Warning" in state_attr(''sensor.nws_alerts_alerts'',
        ''alerts'') | map(attribute=''event'') }}'
    then:
    - action: notify.mobile_app_pixel_8_pro
      data:
        title: ⚠️ Flood Warning Issued
        message: A Flood Warning has been issued for your area.
    - action: notify.mobile_app_pixel_8_pro
      data:
        message: TTS
        data:
          ttl: 0
          priority: high
          tts_text: attention!,,, a flood warning issued from the national weather
            service
  mode: single
- id: '1759876178314'
  alias: NWS - Mobile notifications III
  description: ''
  triggers:
  - entity_id: sensor.nws_alerts_alerts
    trigger: state
  conditions:
  - condition: numeric_state
    entity_id: sensor.nws_alerts_alerts
    above: 0
  actions:
  - repeat:
      for_each: '{{ trigger.to_state.attributes.Alerts | reject(''in'', trigger.from_state.attributes.Alerts)
        | sort(attribute=''ID'') | list() }}'
      sequence:
      - data:
          title: '⚠️Alert⚠️: {{ repeat.item.Event }}'
          message: '{{ repeat.item.Description }}'
          data:
            tag: NWS_{{ repeat.item.ID }}
            channel: alert
            group: alert
            sticky: true
            importance: high
            notification_icon: mdi:alert
            color: '#D32F2F'
            ttl: 0
            priority: high
            tts_text: attention!,,, {{ repeat.item.Event }} from the national weather
              service
            clickAction: /lovelace/weatheralert
        action: notify.mobile_app_pixel_8_pro
      - delay:
          seconds: 4
  mode: queued
  max: 10
- id: '1760065616426'
  alias: Zone Notification Donna's Work
  description: ''
  use_blueprint:
    path: homeassistant/notify_leaving_zone.yaml
    input:
      person_entity: person.donna
      zone_entity: zone.donna_s_work
      notify_device: 5402f427ac93601eeab00b7fc7d6f6da
- id: '1760117169977'
  alias: NWS Check for Multi Alerts
  description: NWS Check for Multi Alerts
  triggers:
  - trigger: state
    entity_id: sensor.nws_alerts_alerts
  conditions:
  - condition: template
    value_template: '{{ states(''sensor.nws_alerts_alerts'') | int > 0 }}'
  - condition: template
    value_template: '{{ trigger.to_state.state|int > trigger.from_state.state|int
      }}'
  actions:
  - action: tts.cloud_say
    data:
      entity_id: media_player.office_display
      message: '{{ (state_attr(''sensor.nws_alerts_alerts'', ''Description'') or '''').split(''
        - '')[0] }}'
  mode: single
- id: switch_den_fan_cycle_dynamic_state
  alias: '[SWITCH] Den Fan cycle (Dynamic with State)'
  description: Cycles den fan using helpers; restores original state on stop.
  triggers:
  - entity_id: input_boolean.den_fan_cycles
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.den_fan_cycles
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: fan.den_fan
            state: 'on'
          sequence:
          - target:
              entity_id: input_text.den_fan_cycle_initial_state
            data:
              value: 'on'
            action: input_text.set_value
        - conditions:
          - condition: state
            entity_id: fan.den_fan
            state: 'off'
          sequence:
          - target:
              entity_id: input_text.den_fan_cycle_initial_state
            data:
              value: 'off'
            action: input_text.set_value
          - entity_id: fan.den_fan
            action: fan.turn_on
      - repeat:
          while:
          - condition: state
            entity_id: input_boolean.den_fan_cycles
            state: 'on'
          sequence:
          - delay:
              seconds: '{{ states(''input_number.den_fan_cycle_on_time'') | int(180)
                }}'
          - entity_id: fan.den_fan
            action: fan.turn_off
          - delay:
              seconds: '{{ states(''input_number.den_fan_cycle_off_time'') | int(90)
                }}'
          - entity_id: fan.den_fan
            action: fan.turn_on
    default:
    - choose:
      - conditions:
        - condition: state
          entity_id: input_text.den_fan_cycle_initial_state
          state: 'on'
        sequence:
        - entity_id: fan.den_fan
          action: fan.turn_on
      - conditions:
        - condition: state
          entity_id: input_text.den_fan_cycle_initial_state
          state: 'off'
        sequence:
        - entity_id: fan.den_fan
          action: fan.turn_off
  mode: restart
- id: '1761438252145'
  alias: '[SWITCH] Office Fan cycle (Dynamic with State)'
  description: Cycles office fan using helpers; restores original state on stop.
  triggers:
  - entity_id: input_boolean.office_fan_cycles
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.office_fan_cycles
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: fan.office_fan
            state: 'on'
          sequence:
          - target:
              entity_id: input_text.office_fan_cycle_initial_state
            data:
              value: 'on'
            action: input_text.set_value
        - conditions:
          - condition: state
            entity_id: fan.office_fan
            state: 'off'
          sequence:
          - target:
              entity_id: input_text.office_fan_cycle_initial_state
            data:
              value: 'off'
            action: input_text.set_value
          - entity_id: fan.office_fan
            action: fan.turn_on
      - repeat:
          while:
          - condition: state
            entity_id: input_boolean.office_fan_cycles
            state: 'on'
          sequence:
          - delay:
              minutes: '{{ states(''input_number.office_fan_cycle_on_time'') | int(600)
                }}'
          - entity_id: fan.office_fan
            action: fan.turn_off
          - delay:
              minutes: '{{ states(''input_number.office_fan_cycle_off_time'') | int(4)
                }}'
          - entity_id: fan.office_fan
            action: fan.turn_on
    default:
    - choose:
      - conditions:
        - condition: state
          entity_id: input_text.office_fan_cycle_initial_state
          state: 'on'
        sequence:
        - entity_id: fan.office_fan
          action: fan.turn_on
      - conditions:
        - condition: state
          entity_id: input_text.office_fan_cycle_initial_state
          state: 'off'
        sequence:
        - entity_id: fan.office_fan
          action: fan.turn_off
  mode: restart
- id: '1761438361573'
  alias: '[SWITCH] Guest Fan cycle (Dynamic with State)'
  description: Cycles guest fan using helpers; restores original state on stop.
  triggers:
  - entity_id: input_boolean.guest_fan_cycles
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.guest_fan_cycles
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: fan.guest_fan
            state: 'on'
          sequence:
          - target:
              entity_id: input_text.guest_fan_cycle_initial_state
            data:
              value: 'on'
            action: input_text.set_value
        - conditions:
          - condition: state
            entity_id: fan.guest_fan
            state: 'off'
          sequence:
          - target:
              entity_id: input_text.guest_fan_cycle_initial_state
            data:
              value: 'off'
            action: input_text.set_value
          - entity_id: fan.guest_fan
            action: fan.turn_on
      - repeat:
          while:
          - condition: state
            entity_id: input_boolean.guest_fan_cycles
            state: 'on'
          sequence:
          - delay:
              minutes: '{{ states(''input_number.guest_fan_cycle_on_time'') | int(600)
                }}'
          - entity_id: fan.guest_fan
            action: fan.turn_off
          - delay:
              minutes: '{{ states(''input_number.guest_fan_cycle_off_time'') | int(5)
                }}'
          - entity_id: fan.guest_fan
            action: fan.turn_on
    default:
    - choose:
      - conditions:
        - condition: state
          entity_id: input_text.guest_fan_cycle_initial_state
          state: 'on'
        sequence:
        - entity_id: fan.guest_fan
          action: fan.turn_on
      - conditions:
        - condition: state
          entity_id: input_text.guest_fan_cycle_initial_state
          state: 'off'
        sequence:
        - entity_id: fan.guest_fan
          action: fan.turn_off
  mode: restart
- id: switch_patio_mister_control
  alias: '[SWITCH] Patio Mister Control (Cycle & Timer)'
  description: Cycles mister for 10s on / 50s off. Auto-off after 10 mins.
  triggers:
  - entity_id: input_boolean.patio_mister_switch
    to: 'on'
    id: turn_on
    trigger: state
  - entity_id: input_boolean.patio_mister_switch
    to: 'off'
    id: turn_off
    trigger: state
  - entity_id: input_boolean.patio_mister_switch
    to: 'on'
    for:
      minutes: 10
    id: timer_expired
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: turn_on
      sequence:
      - entity_id: fan.patio_fan
        action: fan.turn_on
      - repeat:
          while:
          - condition: state
            entity_id: input_boolean.patio_mister_switch
            state: 'on'
          sequence:
          - entity_id: switch.patio_mister_2
            action: switch.turn_on
          - delay:
              seconds: 10
          - entity_id: switch.patio_mister_2
            action: switch.turn_off
          - delay:
              seconds: 50
    - conditions:
      - condition: trigger
        id: timer_expired
      sequence:
      - entity_id: input_boolean.patio_mister_switch
        action: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id: turn_off
      sequence:
      - entity_id: fan.patio_fan
        action: fan.turn_off
      - entity_id: switch.patio_mister_2
        action: switch.turn_off
    default:
    - entity_id: fan.patio_fan
      action: fan.turn_off
    - entity_id: switch.patio_mister_2
      action: switch.turn_off
  mode: restart
- id: washer_state_manager_combined
  alias: Washer State Manager (Combined)
  description: Handles 'Washing', 'Idle', and 'Finished' notifications.
  triggers:
  - entity_id: sensor.washer_plug_zb_power
    above: 4
    for:
      minutes: 4
    id: started
    trigger: numeric_state
  - entity_id: sensor.washer_plug_zb_power
    below: 5
    for:
      minutes: 4
    id: stopped
    trigger: numeric_state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: started
      sequence:
      - if:
        - condition: template
          value_template: '{{ states(''sensor.washer_state'') != ''Washing'' }}'
        then:
        - data:
            topic: hass/state/washer
            payload: Washing
            retain: true
          action: mqtt.publish
    - conditions:
      - condition: trigger
        id: stopped
      sequence:
      - if:
        - condition: template
          value_template: '{{ states(''sensor.washer_state'') == ''Washing'' }}'
        then:
        - data:
            topic: hass/state/washer
            payload: Idle
            retain: true
          action: mqtt.publish
        - if:
          - condition: state
            entity_id: input_boolean.disable_laundry_notifications
            state: 'off'
          then:
          - data:
              entity_id: media_player.tv_speakers
              volume_level: 0.5
            action: media_player.volume_set
          - entity_id: media_player.tv_speakers
            data:
              message: Donna and Darren,,,Clothes ready,,,The washing machine has
                finished!
            action: tts.google_say
          - data:
              message: "Washing\U0001F455\U0001F457\U0001F456Finished {{ states('sensor.time_12_hour_am_pm')
                }}"
            action: notify.pixels_and_den_tv
        else:
        - data:
            topic: hass/state/washer
            payload: Idle
            retain: true
          action: mqtt.publish
- id: dryer_state_manager_combined
  alias: Dryer State Manager (Combined)
  description: Handles 'Drying', 'Idle', and 'Finished' notifications.
  triggers:
  - entity_id: sensor.dryer_energy_power
    above: 50
    for:
      minutes: 4
    id: started
    trigger: numeric_state
  - entity_id: sensor.dryer_energy_power
    below: 6
    for:
      minutes: 1
    id: stopped
    trigger: numeric_state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: started
      sequence:
      - data:
          topic: hass/state/dryer
          payload: Drying
          retain: true
        action: mqtt.publish
    - conditions:
      - condition: trigger
        id: stopped
      sequence:
      - if:
        - condition: template
          value_template: '{{ states(''sensor.dryer_state'') == ''Drying'' }}'
        then:
        - data:
            topic: hass/state/dryer
            payload: Idle
            retain: true
          action: mqtt.publish
        - if:
          - condition: state
            entity_id: input_boolean.disable_laundry_notifications
            state: 'off'
          then:
          - data:
              entity_id: media_player.tv_speakers
              volume_level: 0.5
            action: media_player.volume_set
          - entity_id: media_player.tv_speakers
            data:
              message: Donna and Darren,,,Clothes are ready,,,The dryer has finished!
            action: tts.google_say
          - data:
              message: "Drying\U0001F455\U0001F457\U0001F456Finished {{ states('sensor.time_12_hour_am_pm')
                }}"
            action: notify.pixels_and_den_tv
        else:
        - data:
            topic: hass/state/dryer
            payload: Idle
            retain: true
          action: mqtt.publish
- id: ensuite_motion_light_on_evening
  alias: '[Motion] Ensuite motion light on'
  description: Turns on ensuite lights & kiosk between 5 PM and 10 PM
  mode: restart
  max_exceeded: silent
  triggers:
  - entity_id: binary_sensor.ensuite_motion_sensors
    to: 'on'
    trigger: state
  conditions:
  - condition: time
    before: '22:00:00'
    after: '17:00:00'
  - condition: state
    entity_id: binary_sensor.night
    state: 'on'
  actions:
  - action: light.turn_on
    continue_on_error: true
    target:
      entity_id: light.jacuzzi_downlight
    data:
      brightness_pct: 10
  - action: light.turn_on
    continue_on_error: true
    target:
      entity_id: light.donnas_light
  - if:
    - condition: state
      entity_id: switch.ensuite_kiosk_screen
      state: 'off'
    then:
    - action: switch.turn_on
      continue_on_error: true
      target:
        entity_id: switch.ensuite_kiosk_screen
    - delay:
        seconds: 2
    else:
    - delay:
        seconds: 1
  - action: button.press
    continue_on_error: true
    target:
      entity_id: button.ensuite_kiosk_load_start_url
  - wait_for_trigger:
    - entity_id: binary_sensor.ensuite_motion_sensors
      from: 'on'
      to: 'off'
      trigger: state
    timeout:
      minutes: 120
    continue_on_timeout: true
  - delay:
      minutes: 60
  - action: light.turn_off
    continue_on_error: true
    target:
      entity_id: light.jacuzzi_downlight
  - action: switch.turn_off
    continue_on_error: true
    target:
      entity_id: switch.ensuite_kiosk_screen
- id: auto_ensuite_vent_manager_combined
  alias: '[Auto] Ensuite Vent Manager (Combined)'
  description: Manages fan based on humidity or a 15-minute timer.
  mode: single
  max_exceeded: silent
  triggers:
  - entity_id: sensor.ensuite_humidity_2
    above: 65
    id: humidity_high
    trigger: numeric_state
  - entity_id: sensor.ensuite_humidity_2
    below: 59
    id: humidity_low
    trigger: numeric_state
  - entity_id: fan.ensuite_vent_2
    to: 'on'
    for:
      minutes: 15
    id: timer_expired
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: humidity_high
      - condition: state
        entity_id: light.jacuzzi_downlight
        state: 'off'
      sequence:
      - action: fan.turn_on
        continue_on_error: true
        target:
          entity_id: fan.ensuite_vent_2
    - conditions:
      - condition: trigger
        id: humidity_low
      - condition: state
        entity_id: light.jacuzzi_downlight
        state: 'off'
      sequence:
      - action: fan.turn_off
        continue_on_error: true
        target:
          entity_id: fan.ensuite_vent_2
    - conditions:
      - condition: trigger
        id: timer_expired
      - condition: numeric_state
        entity_id: sensor.ensuite_humidity_2
        below: 59
      sequence:
      - action: fan.turn_off
        continue_on_error: true
        target:
          entity_id: fan.ensuite_vent_2
- id: combined_clocks_grandfather_cuckoo
  alias: Audible Clocks (Grandfather & Cuckoo)
  description: Plays clock chimes using Standard Service with Announce and Volume.
  triggers:
  - hours: '*'
    minutes: '0'
    trigger: time_pattern
  - minutes: '30'
    trigger: time_pattern
  conditions:
  - condition: time
    after: 09:29:00
    before: '21:30:00'
  - condition: state
    entity_id: light.tv_ambient_lights
    state: 'off'
  - condition: state
    entity_id: input_boolean.everyone_is_awake
    state: 'on'
  - condition: or
    conditions:
    - condition: state
      entity_id: input_boolean.grandfather_clock
      state: 'on'
    - condition: state
      entity_id: input_boolean.cuckoo_clock
      state: 'on'
  actions:
  - variables:
      is_half_hour: '{{ now().minute == 30 }}'
      current_hour: '{{ now().strftime(''%I'') }}'
      target_player: "{% if states('media_player.front_group') == 'playing' %}\n  media_player.front_group\n{%
        elif states('media_player.everywhere') == 'playing' %}\n  media_player.everywhere\n{%
        elif states('media_player.display_group') == 'playing' %}\n  media_player.display_group\n{%
        else %}\n  media_player.tv_speakers\n{% endif %}"
      chime_duration: '{{ 5 if is_half_hour else (5 + (current_hour | int * 1.9))
        }}'
  - variables:
      original_volume: '{{ state_attr(target_player, ''volume_level'') | float(0.3)
        }}'
  - action: media_player.volume_set
    target:
      entity_id: '{{ target_player }}'
    data:
      volume_level: 0.4
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.grandfather_clock
        state: 'on'
      - condition: state
        entity_id: remote.den_tv
        state: 'off'
      sequence:
      - action: media_player.play_media
        target:
          entity_id: '{{ target_player }}'
        data:
          announce: true
          media:
            media_content_id: "{% if is_half_hour %}\n  media-source://media_source/local/gf-hour-30.mp3\n{%
              else %}\n  media-source://media_source/local/gf-hour-{{ current_hour
              }}.mp3\n{% endif %}"
            media_content_type: music
            metadata: {}
      - if:
        - condition: state
          entity_id: input_boolean.cuckoo_clock
          state: 'on'
        then:
        - action: input_boolean.turn_off
          target:
            entity_id: input_boolean.cuckoo_clock
    - conditions:
      - condition: state
        entity_id: input_boolean.cuckoo_clock
        state: 'on'
      - condition: state
        entity_id: remote.den_tv
        state: 'off'
      sequence:
      - action: media_player.play_media
        target:
          entity_id: '{{ target_player }}'
        data:
          announce: true
          media:
            media_content_id: "{% if is_half_hour %}\n  media-source://media_source/local/cuckoo-clock-01.wav\n{%
              else %}\n  media-source://media_source/local/cuckoo-clock-{{ current_hour
              }}.wav\n{% endif %}"
            media_content_type: music
            metadata: {}
  - delay:
      seconds: '{{ chime_duration | int }}'
  - action: media_player.volume_set
    target:
      entity_id: '{{ target_player }}'
    data:
      volume_level: '{{ original_volume }}'
  mode: single
- id: critical_safety_alerts_detected
  alias: '[Notify] NEST Fire, Smoke, CO, & Heat Detected II'
  description: Handles all smoke, CO, and heat alerts with comprehensive safety actions.
  mode: queued
  max: 10
  triggers:
  - id: smoke
    entity_id:
    - binary_sensor.nest_protect_hallway_smoke_status
    - binary_sensor.nest_protect_kitchen_smoke_status
    - binary_sensor.nest_protect_garage_smoke_status
    - binary_sensor.laundry_smoke_detected
    - binary_sensor.bedroom_smoke_detected
    to: 'on'
    for:
      seconds: 3
    trigger: state
  - id: co
    entity_id:
    - binary_sensor.nest_protect_hallway_co_status
    - binary_sensor.nest_protect_kitchen_co_status
    - binary_sensor.nest_protect_garage_co_status
    - binary_sensor.laundry_co_detected
    - binary_sensor.bedroom_carbon_monoxide_detected
    to: 'on'
    for:
      seconds: 3
    trigger: state
  - id: heat
    entity_id:
    - binary_sensor.nest_protect_hallway_heat_status
    - binary_sensor.nest_protect_kitchen_heat_status
    - binary_sensor.nest_protect_garage_heat_status
    to: 'on'
    for:
      seconds: 3
    trigger: state
  actions:
  - variables:
      trigger_name: '{{ trigger.to_state.attributes.friendly_name | default(trigger.entity_id)
        }}'
      alert_title: "{% if trigger.id == 'smoke' %}\n  Smoke Alarm\n{% elif trigger.id
        == 'co' %}\n  Carbon Monoxide Alarm\n{% else %}\n  Heat Alarm\n{% endif %}"
      alert_message: "{% if trigger.id == 'smoke' %}\n  {{ trigger_name }} smoke detected
        \U0001F525\n{% elif trigger.id == 'co' %}\n  {{ trigger_name }} carbon monoxide
        detected ⚠️\n{% else %}\n  {{ trigger_name }} heat detected \U0001F525\n{%
        endif %}"
      alert_icon: "{% if trigger.id == 'smoke' %}\n  mdi:smoke-detector-variant-alert\n{%
        elif trigger.id == 'co' %}\n  mdi:molecule-co\n{% else %}\n  mdi:fire-alert\n{%
        endif %}"
  - if:
    - condition: template
      value_template: '{{ trigger.id in ["smoke", "co"] }}'
    then:
    - action: noonlight.create_alarm
      continue_on_error: true
      data:
        service: fire
    - action: logbook.log
      continue_on_error: true
      data:
        name: Noonlight
        entity_id: '{{ trigger.entity_id }}'
        message: Fire/CO alarm triggered from {{ trigger_name }}
  - parallel:
    - action: climate.turn_off
      continue_on_error: true
      target:
        entity_id: climate.den
    - action: switch.turn_off
      continue_on_error: true
      target:
        entity_id: switch.dryer_plug
    - action: lock.unlock
      continue_on_error: true
      target:
        entity_id:
        - lock.side_door
        - lock.back_door
    - action: cover.open_cover
      continue_on_error: true
      target:
        entity_id: cover.garage_door
    - action: siren.turn_on
      continue_on_error: true
      target:
        entity_id: siren.alarm_panel_siren
    - action: switch.turn_on
      continue_on_error: true
      target:
        entity_id: switch.konnected_da0e8a_siren
    - action: light.turn_on
      continue_on_error: true
      target:
        entity_id: light.every_light
      data:
        brightness_pct: 100
  - action: notify.notify_all
    continue_on_error: true
    data:
      title: '{{ alert_title }}'
      message: '{{ alert_message }}'
      data:
        channel: alert
        sticky: true
        importance: high
        notification_icon: '{{ alert_icon }}'
- id: safety_alerts_all_clear
  alias: '[Notify] Fire, Smoke, CO, & Heat All Clear None Detected'
  description: Resets systems and sends notification when ALL alerts clear.
  mode: restart
  triggers:
  - id: clear_smoke
    entity_id:
    - binary_sensor.nest_protect_hallway_smoke_status
    - binary_sensor.nest_protect_kitchen_smoke_status
    - binary_sensor.nest_protect_garage_smoke_status
    - binary_sensor.laundry_smoke_detected
    - binary_sensor.bedroom_smoke_detected
    to: 'off'
    for:
      seconds: 10
    trigger: state
  - id: clear_co
    entity_id:
    - binary_sensor.nest_protect_hallway_co_status
    - binary_sensor.nest_protect_kitchen_co_status
    - binary_sensor.nest_protect_garage_co_status
    - binary_sensor.laundry_co_detected
    - binary_sensor.bedroom_carbon_monoxide_detected
    to: 'off'
    for:
      seconds: 10
    trigger: state
  - id: clear_heat
    entity_id:
    - binary_sensor.nest_protect_hallway_heat_status
    - binary_sensor.nest_protect_kitchen_heat_status
    - binary_sensor.nest_protect_garage_heat_status
    to: 'off'
    for:
      seconds: 10
    trigger: state
  conditions:
  - condition: state
    entity_id:
    - binary_sensor.nest_protect_hallway_smoke_status
    - binary_sensor.nest_protect_kitchen_smoke_status
    - binary_sensor.nest_protect_garage_smoke_status
    - binary_sensor.laundry_smoke_detected
    - binary_sensor.bedroom_smoke_detected
    state: 'off'
  - condition: state
    entity_id:
    - binary_sensor.nest_protect_hallway_co_status
    - binary_sensor.nest_protect_kitchen_co_status
    - binary_sensor.nest_protect_garage_co_status
    - binary_sensor.laundry_co_detected
    - binary_sensor.bedroom_carbon_monoxide_detected
    state: 'off'
  - condition: state
    entity_id:
    - binary_sensor.nest_protect_hallway_heat_status
    - binary_sensor.nest_protect_kitchen_heat_status
    - binary_sensor.nest_protect_garage_heat_status
    state: 'off'
  actions:
  - variables:
      trigger_name: '{{ trigger.to_state.attributes.friendly_name | default(trigger.entity_id)
        }}'
      clear_title: All Clear
      clear_message: '{{ trigger_name }} alarm cleared - All systems safe ✅'
      clear_icon: mdi:check-circle-outline
  - parallel:
    - action: climate.turn_on
      continue_on_error: true
      target:
        entity_id: climate.den
    - action: switch.turn_on
      continue_on_error: true
      target:
        entity_id: switch.dryer_plug
    - action: siren.turn_off
      continue_on_error: true
      target:
        entity_id: siren.alarm_panel_siren
    - action: switch.turn_off
      continue_on_error: true
      target:
        entity_id: switch.konnected_da0e8a_siren
    - action: lock.lock
      continue_on_error: true
      target:
        entity_id:
        - lock.side_door
        - lock.back_door
    - action: cover.close_cover
      continue_on_error: true
      target:
        entity_id: cover.garage_door
    - action: light.turn_off
      continue_on_error: true
      target:
        entity_id: light.every_light
    - action: light.turn_on
      continue_on_error: true
      target:
        entity_id:
        - light.under_cabinet_lights
        - light.sofa_lamp
  - action: logbook.log
    continue_on_error: true
    data:
      name: Safety System
      entity_id: '{{ trigger.entity_id }}'
      message: All clear received from {{ trigger_name }}
  - action: notify.notify_all
    continue_on_error: true
    data:
      title: '{{ clear_title }}'
      message: '{{ clear_message }}'
      data:
        channel: alert
        importance: high
        notification_icon: '{{ clear_icon }}'
- id: auto_bathroom_vent_manager_combined
  alias: '[Auto] Bathroom Vent Manager (Combined)'
  description: Manages bathroom vent based on humidity or a 15-minute timer.
  mode: single
  max_exceeded: silent
  triggers:
  - entity_id: sensor.bathroom_humidity_2
    above: 65
    id: humidity_high
    trigger: numeric_state
  - entity_id: sensor.bathroom_humidity_2
    below: 59
    id: humidity_low
    trigger: numeric_state
  - entity_id: switch.bathroom_vent
    to: 'on'
    for:
      minutes: 15
    id: timer_expired
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: humidity_high
      sequence:
      - action: switch.turn_on
        continue_on_error: true
        target:
          entity_id: switch.bathroom_vent
    - conditions:
      - condition: trigger
        id: humidity_low
      sequence:
      - action: switch.turn_off
        continue_on_error: true
        target:
          entity_id: switch.bathroom_vent
    - conditions:
      - condition: trigger
        id: timer_expired
      - condition: numeric_state
        entity_id: sensor.bathroom_humidity_2
        below: 59
      sequence:
      - action: switch.turn_off
        continue_on_error: true
        target:
          entity_id: switch.bathroom_vent
- id: motion_hall_bathroom_lights_revised
  alias: '[Motion] Hall Bathroom Lights'
  description: Manages bathroom lighting based on motion and time of day.
  mode: restart
  max_exceeded: silent
  triggers:
  - entity_id: binary_sensor.bathroom_motion_motion
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  actions:
  - variables:
      current_hour: '{{ now().hour + now().minute / 60 }}'
      is_night_time: '{{ current_hour >= 22.5 or current_hour < 6 }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not is_night_time }}'
      sequence:
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id: light.bathroom_lights
    - conditions:
      - condition: template
        value_template: '{{ is_night_time }}'
      sequence:
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id: light.bathtub_light
  - wait_for_trigger:
    - entity_id: binary_sensor.bathroom_motion_motion
      to: 'off'
      trigger: state
    timeout:
      minutes: 30
    continue_on_timeout: true
  - delay:
      seconds: 80
  - if:
    - condition: state
      entity_id: binary_sensor.bathroom_door_bt
      state: 'on'
    then:
    - action: light.turn_off
      continue_on_error: true
      target:
        entity_id:
        - light.bathroom_lights
        - light.bathtub_light
- id: alarmo_master_control_combined_revised
  alias: '[Alarmo] Master Control'
  description: Handles all Alarmo state changes, triggers, and notifications.
  mode: restart
  triggers:
  - entity_id: alarm_control_panel.alarmo
    to: triggered
    id: triggered
    trigger: state
  - entity_id: alarm_control_panel.alarmo
    to: armed_home
    id: armed_home
    trigger: state
  - entity_id: alarm_control_panel.alarmo
    to: armed_away
    id: armed_away
    trigger: state
  - entity_id: alarm_control_panel.alarmo
    to: disarmed
    id: disarmed
    trigger: state
  - entity_id: input_boolean.alarm_arm_home_switch
    to: 'on'
    id: arm_home_switch
    trigger: state
  - entity_id: input_boolean.alarm_arm_away_switch
    to: 'on'
    id: arm_away_switch
    trigger: state
  - entity_id: input_boolean.alarm_disarm_switch
    to: 'on'
    id: disarm_switch
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: triggered
      sequence:
      - variables:
          triggered_sensors: '{{ dict((states|selectattr(''entity_id'', ''in'', state_attr(''group.monitored_contacts'',
            ''entity_id''))|list)|groupby(''state''))[''on'']|map(attribute=''name'')|list|join('',
            '') if dict((states|selectattr(''entity_id'', ''in'', state_attr(''group.monitored_contacts'',
            ''entity_id''))|list)|groupby(''state'')).get(''on'') else ''unknown sensors''
            }}'
          tts_msg: The alarm has been triggered by {{ triggered_sensors }}
      - action: notify.notify_all
        continue_on_error: true
        data:
          message: TTS
          target:
          - mobile_app_pixel_8_pro
          - mobile_app_pixel_5
          data:
            ttl: 0
            priority: high
            tts_text: '{{ tts_msg }}'
      - action: homeassistant.turn_on
        continue_on_error: true
        target:
          entity_id: group.alarm_sirens
      - action: noonlight.create_alarm
        continue_on_error: true
        data:
          action: police
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id:
          - light.every_light
          - light.outside_lights
      - action: media_player.volume_set
        continue_on_error: true
        target:
          entity_id: media_player.tv_speakers
        data:
          volume_level: 0.9
      - delay:
          seconds: 1
      - action: tts.cloud_say
        continue_on_error: true
        target:
          entity_id: media_player.tv_speakers
        data:
          message: Alarm triggered! Police has been notified! at {{ states('sensor.time_12_hour_am_pm')
            }}
    - conditions:
      - condition: trigger
        id: armed_home
      sequence:
      - action: notify.mobile_app_pixel_8_pro
        continue_on_error: true
        data:
          message: TTS
          data:
            ttl: 0
            priority: high
            tts_text: Security system activated.
    - conditions:
      - condition: trigger
        id: armed_away
      sequence:
      - action: notify.mobile_app_pixel_8_pro
        continue_on_error: true
        data:
          message: TTS
          data:
            ttl: 0
            priority: high
            tts_text: Security system armed. I will notify you of any activity while
              you are out.
      - action: tts.cloud_say
        continue_on_error: true
        target:
          entity_id: media_player.tv_speakers
        data:
          message: Motion sensors activated!
    - conditions:
      - condition: trigger
        id: disarmed
      sequence:
      - if:
        - condition: template
          value_template: '{{ trigger.from_state.state == ''triggered'' }}'
        then:
        - action: homeassistant.turn_off
          continue_on_error: true
          target:
            entity_id:
            - switch.noonlight_switch
            - group.alarm_sirens
        - action: light.turn_off
          continue_on_error: true
          target:
            entity_id:
            - light.every_light
            - light.outside_lights
        - action: notify.pixels_and_den_tv
          continue_on_error: true
          data:
            message: Alarm canceled at {{ states('sensor.time_12_hour_am_pm') }}
        - delay:
            seconds: 3
        - action: light.turn_on
          continue_on_error: true
          target:
            entity_id:
            - light.sofa_lamp
            - light.under_cabinet_lights
      - if:
        - condition: state
          entity_id: input_boolean.naptime
          state: 'off'
        then:
        - delay:
            seconds: 5
        - action: notify.mobile_app_pixel_8_pro
          continue_on_error: true
          data:
            message: TTS
            data:
              ttl: 0
              priority: high
              tts_text: Security system deactivated. Welcome home!
    - conditions:
      - condition: trigger
        id: arm_home_switch
      sequence:
      - action: alarm_control_panel.alarm_arm_home
        continue_on_error: true
        target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
      - action: input_boolean.turn_off
        continue_on_error: true
        target:
          entity_id: input_boolean.alarm_arm_home_switch
    - conditions:
      - condition: trigger
        id: arm_away_switch
      sequence:
      - action: alarm_control_panel.alarm_arm_away
        continue_on_error: true
        target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
      - action: input_boolean.turn_off
        continue_on_error: true
        target:
          entity_id: input_boolean.alarm_arm_away_switch
    - conditions:
      - condition: trigger
        id: disarm_switch
      sequence:
      - action: alarm_control_panel.alarm_disarm
        continue_on_error: true
        target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
      - action: input_boolean.turn_off
        continue_on_error: true
        target:
          entity_id: input_boolean.alarm_disarm_switch
- id: tv_ambient_lights_sync
  alias: TV Ambient Lights Sync with TV
  description: Turns ambient lights on/off based on TV remote state.
  triggers:
  - entity_id: remote.den_tv
    to:
    - 'on'
    - 'off'
    trigger: state
  actions:
  - target:
      device_id: bc73bb14e38e8396900015b6b0d86506
    action: homeassistant.turn_{{ trigger.to_state.state }}
  mode: single
- id: ups_status_notifications_combined
  alias: UPS Status Notifications
  description: Sends notifications for power off, fully charged, and NUT events.
  triggers:
  - entity_id: sensor.mainups_input_voltage
    below: 10
    id: power_off
    trigger: numeric_state
  - entity_id: sensor.mainups_battery_charge
    above: 99
    id: fully_charged
    trigger: numeric_state
  - event_type: nut.ups_event
    id: nut_event
    trigger: event
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: power_off
      sequence:
      - data:
          title: Smart Home Alert
          message: The Power went OFF at {{ states('sensor.time_12_hour_am_pm') }}
        action: notify.mobile_app_pixel_8_pro
    - conditions:
      - condition: trigger
        id: fully_charged
      - condition: numeric_state
        entity_id: sensor.mainups_input_voltage
        above: 120
      sequence:
      - data:
          title: Smart Home Alert
          message: UPS is online and fully charged at {{ states('sensor.time_12_hour_am_pm')
            }}
        action: notify.mobile_app_pixel_8_pro
    - conditions:
      - condition: trigger
        id: nut_event
      sequence:
      - data:
          title: UPS changed state
          message: '{{ trigger.event.data.notify_msg }}'
        action: notify.mobile_app_pixel_8_pro
  mode: single
- id: door_announcements_combined
  alias: Door Announcements (TTS)
  description: Announces open/close status for Front, Side, Back, and Garage doors.
  triggers:
  - entity_id:
    - binary_sensor.front_door
    - binary_sensor.side_door_bt
    - binary_sensor.back_door1
    - binary_sensor.backdoor_bt_sensor
    - binary_sensor.garage_door_sensor_zb
    to:
    - 'on'
    - 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.door_announcements
    state: 'on'
  - condition: template
    value_template: '{{ trigger.from_state.state != ''unavailable'' and trigger.from_state.state
      != ''unknown'' }}'
  actions:
  - target:
      entity_id: media_player.den_mini
    data:
      message: '{{ door_name }} {{ door_action }}'
    action: tts.google_say
  - action: notify.android_tv_fire_tv
    data_template:
      data:
        fontsize: large
        position: bottom-right
        duration: 3
        transparency: 25%
        color: grey
        interrupt: 1
      message: "{% if door_entity_id == 'binary_sensor.garage_door_sensor_zb' %}\n
        \ {% if door_action == 'opened' %}\n    {{ door_name }}⚠️opened⚠️ {{ states('sensor.time_12_hour_am_pm')
        }}\n  {% else %}\n    {{ door_name }} closed✅ {{ states('sensor.time_12_hour_am_pm')
        }}\n  {% endif %}\n{% elif door_entity_id == 'binary_sensor.side_door_bt'
        %}\n   ⚠️{{ door_name }}\U0001F6AA{{ door_action }} {{ states('sensor.time_12_hour_am_pm')
        }}\n{% else %}\n   {{ door_name }}\U0001F6AA{{ door_action }} {{ states('sensor.time_12_hour_am_pm')
        }}\n{% endif %}\n"
  mode: queued
  variables:
    door_entity_id: '{{ trigger.entity_id }}'
    door_state: '{{ trigger.to_state.state }}'
    door_action: '{{ ''opened'' if door_state == ''on'' else ''closed'' }}'
    door_name_map:
      binary_sensor.front_door: Front door
      binary_sensor.side_door_bt: Side door
      binary_sensor.back_door1: Back door
      binary_sensor.backdoor_bt_sensor: Back door
      binary_sensor.garage_door_sensor_zb: Garage door
    door_name: '{{ door_name_map.get(door_entity_id, trigger.to_state.attributes.friendly_name
      | default(''Unknown Door'')) }}'
- id: tablet_background_theme_manager
  alias: '[Tablet] Background and Theme Manager'
  description: Sets wallpaper playlists at specific times and cycles wallpaper/theme
    periodically.
  mode: restart
  variables:
    playlists:
      morning:
      - christian41.1
      - coffee1_11
      - coffee1_21
      - wallpaper7e
      - coffee1_31
      - coffee1_41
      - coffee1_51
      - coffee1_61
      - coffee1_71
      midday:
      - christian1.1
      - wallpaper13
      - wallpaper7e
      - wallpaper66
      - christian21
      - wallpaper141
      - wallpaper33
      - christian31
      - wallpaper21
      - christian41.1
      - christian5
      - christian61
      - christian7.1
      evening:
      - wallpaper141
      - wallpaper1
      - wallpaper13
      - wallpaper7e
      - wallpaper66
      - eye11
      - christian21
      - wallpaper121
      - ufo1
      - christian5
      - welcome4
      - christian1.1
      - wallpaper5
      night:
      - christian41.1
      - wallpaper13
      - moonFull
      - christian31
      - wallpaper7e
      - wallpaper141
      - moon2Blue
      - wallpaper66
      - wallpaper1
      - christian21
      - wallpaper21
      - moonLake
  triggers:
  - id: set_playlist
    trigger: time
    at:
    - 04:30:00
    - '10:00:00'
    - '16:00:00'
    - '19:00:00'
  - id: cycle
    trigger: time_pattern
    minutes: /7
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: set_playlist
      sequence:
      - action: input_select.set_options
        target:
          entity_id: input_select.wallpaper
        data:
          options: '{% set t = now().strftime(''%H:%M:%S'') %} {% set selected_playlist
            = playlists.night if t >= ''19:00:00'' else playlists.evening if t >=
            ''16:00:00'' else playlists.midday if t >= ''10:00:00'' else playlists.morning
            %} {{ (selected_playlist + [states(''input_select.wallpaper'')]) | unique
            | list }}

            '
      - action: input_select.select_first
        target:
          entity_id: input_select.wallpaper
      - action: input_select.set_options
        target:
          entity_id: input_select.wallpaper
        data:
          options: '{% set t = now().strftime(''%H:%M:%S'') %} {% if t >= ''19:00:00''
            %} {{ playlists.night }} {% elif t >= ''16:00:00'' %} {{ playlists.evening
            }} {% elif t >= ''10:00:00'' %} {{ playlists.midday }} {% else %} {{ playlists.morning
            }} {% endif %}

            '
    - conditions:
      - condition: trigger
        id: cycle
      sequence:
      - action: input_select.select_next
        target:
          entity_id: input_select.wallpaper
      - action: input_select.select_option
        target:
          entity_id: input_select.video_wallpaper
        data:
          option: '{{ state_attr(''input_select.video_wallpaper'', ''options'') |
            random }}'
      - action: input_select.select_option
        target:
          entity_id: input_select.mobilelayout
        data:
          option: mobile2
- id: auto_fan_control_away_mode
  alias: '[Auto] Fan Control (Away Mode)'
  description: Turns Office and Guest fans on/off based on temp when away.
  mode: queued
  max: 10
  triggers:
  - entity_id: sensor.office_temperature_2
    above: 75.5
    id: office_high
    trigger: numeric_state
  - entity_id: sensor.office_temperature_2
    below: 74
    id: office_low
    trigger: numeric_state
  - entity_id: sensor.guest_room_temperature
    above: 75.5
    id: guest_high
    trigger: numeric_state
  - entity_id: sensor.guest_room_temperature
    below: 74
    id: guest_low
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: group.person_group
    state: not_home
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: office_high
      sequence:
      - action: fan.turn_on
        continue_on_error: true
        target:
          entity_id: fan.office_fan
    - conditions:
      - condition: trigger
        id: office_low
      sequence:
      - action: fan.turn_off
        continue_on_error: true
        target:
          entity_id: fan.office_fan
    - conditions:
      - condition: trigger
        id: guest_high
      sequence:
      - action: input_boolean.turn_on
        continue_on_error: true
        target:
          entity_id: input_boolean.guest_ceiling_fan
      - action: google_assistant_sdk.send_text_command
        continue_on_error: true
        data:
          command: turn on guest ceiling fan
    - conditions:
      - condition: trigger
        id: guest_low
      sequence:
      - action: input_boolean.turn_off
        continue_on_error: true
        target:
          entity_id: input_boolean.guest_ceiling_fan
      - action: google_assistant_sdk.send_text_command
        continue_on_error: true
        data:
          command: turn off guest ceiling fan
- id: '1761876381224'
  alias: '[Motion] Bedroom Motion Lights'
  description: Manage bedroom lighting based on motion, time, and door state.
  triggers:
  - entity_id: binary_sensor.bedroom_motion_sensors
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.bedroom_door
    state: 'on'
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  actions:
  - variables:
      current_hour: '{{ now().hour + now().minute / 60 }}'
      target_lights: "{% if 9.5 <= current_hour < 18.5 %}\n  light.mood_lights,light.donnas_light,light.darrens_nightstand_light\n{%
        elif 18.5 <= current_hour < 20.5 %}\n  light.mood_lights,light.donnas_light,light.darrens_nightstand_light\n{%
        elif 20.5 <= current_hour < 21.5 %}\n  light.donnas_light,light.darrens_nightstand_light\n{%
        elif 21.5 <= current_hour <= 22.5 %}\n  light.donnas_light\n{% else %}\n  light.darrens_nightstand_light\n{%
        endif %}"
      brightness_level: "{% if 9.5 <= current_hour < 18.5 %}\n  45\n{% elif 18.5 <=
        current_hour < 20.5 %}\n  15\n{% elif 20.5 <= current_hour < 21.5 %}\n  5\n{%
        elif 21.5 <= current_hour <= 22.5 %}\n  5\n{% else %}\n  1\n{% endif %}"
      kiosk_on: "{% if current_hour >= 9.5 and current_hour <= 22.5 %}\n  true\n{%
        else %}\n  false\n{% endif %}"
  - action: light.turn_on
    continue_on_error: true
    target:
      entity_id: '{{ target_lights }}'
    data:
      brightness_pct: '{{ brightness_level }}'
  - if:
    - condition: template
      value_template: '{{ kiosk_on == "true" }}'
    then:
    - action: switch.turn_on
      continue_on_error: true
      target:
        entity_id: switch.ensuite_kiosk_screen
  - wait_for_trigger:
    - entity_id: binary_sensor.bedroom_motion_sensors
      from: 'on'
      to: 'off'
      trigger: state
      for:
        seconds: 10
  - if:
    - condition: state
      entity_id: binary_sensor.bedroom_door
      state: 'on'
    then:
    - delay: 300
    - action: light.turn_off
      target:
        entity_id: light.mood_lights
    - delay: 300
    - action: light.turn_off
      target:
        entity_id: light.darrens_nightstand_light
    - delay: 1800
    - action: light.turn_off
      target:
        entity_id: light.donnas_light
    - action: switch.turn_off
      target:
        entity_id: switch.ensuite_kiosk_screen
  mode: restart
- id: '1761877868563'
  alias: '[Presence] Darren Arrives - Office Actions'
  description: Actions when Darren arrives home and enters the office.
  triggers:
  - entity_id: person.darren
    from: not_home
    to: home
    trigger: state
  actions:
  - continue_on_error: true
    action: number.set_value
    target:
      entity_id: number.fmd_pixel8pro_update_interval
    data:
      value: 300
  - wait_for_trigger:
    - entity_id: binary_sensor.office_motion_sensors
      from: 'off'
      to: 'on'
      trigger: state
    timeout:
      minutes: 30
    continue_on_timeout: true
  - target:
      entity_id:
      - fan.hallway_fan
      - switch.ha2_office_monitor
      - light.office_lights
    continue_on_error: true
    action: homeassistant.turn_on
  - target:
      entity_id:
      - switch.fmd_pixel8pro_high_frequency_mode
    continue_on_error: true
    action: homeassistant.turn_off
  mode: single
- id: '1761878499879'
  alias: '[Remote] Patio Remote Control'
  description: Handles all 4 button presses for the patio remote.
  triggers:
  - device_id: 678ee59e9221d02b1ee09145dd4183f1
    domain: bthome
    type: button_1
    subtype: press
    id: patio_btn_1
    trigger: device
  - device_id: 678ee59e9221d02b1ee09145dd4183f1
    domain: bthome
    type: button_2
    subtype: press
    id: patio_btn_2
    trigger: device
  - device_id: 678ee59e9221d02b1ee09145dd4183f1
    domain: bthome
    type: button_3
    subtype: press
    id: patio_btn_3
    trigger: device
  - device_id: 678ee59e9221d02b1ee09145dd4183f1
    domain: bthome
    type: button_4
    subtype: press
    id: patio_btn_4
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: patio_btn_1
      sequence:
      - target:
          entity_id: light.patio_led_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: patio_btn_2
      sequence:
      - target:
          entity_id: switch.patio_fountain_plug
        action: switch.toggle
    - conditions:
      - condition: trigger
        id: patio_btn_3
      sequence:
      - target:
          entity_id: input_boolean.patio_mister_switch
        action: input_boolean.toggle
    - conditions:
      - condition: trigger
        id: patio_btn_4
      sequence:
      - target:
          entity_id: light.outside_lights
        action: light.toggle
    default: []
  mode: single
- id: '1761879094337'
  alias: '[Remote] Bedroom Remote Control'
  description: Handles all button presses for the bedroom remote.
  triggers:
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_1
    subtype: press
    id: bed_btn_1_press
    trigger: device
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_1
    subtype: long_press
    id: bed_btn_1_long
    trigger: device
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_1
    subtype: double_press
    id: bed_btn_1_double
    trigger: device
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_2
    subtype: press
    id: bed_btn_2_press
    trigger: device
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_3
    subtype: press
    id: bed_btn_3_press
    trigger: device
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_4
    subtype: press
    id: bed_btn_4_press
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: bed_btn_1_press
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        action: light.toggle
    - conditions:
      - condition: trigger
        id: bed_btn_1_long
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        data:
          rgb_color:
          - 255
          - 0
          - 0
          brightness_pct: 16
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: bed_btn_1_double
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        data:
          color_temp_kelvin: 3000
          brightness_pct: 15
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: bed_btn_2_press
      sequence:
      - target:
          entity_id: light.bedroom_ceiling
        action: light.toggle
    - conditions:
      - condition: trigger
        id: bed_btn_3_press
      sequence:
      - target:
          entity_id: light.mood_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: bed_btn_4_press
      sequence:
      - target:
          entity_id: light.bedroom_lights
        action: light.toggle
    default: []
  mode: single
- id: '1761879585763'
  alias: '[Remote] Den Remote Control'
  description: Handles all button presses for the den remote.
  triggers:
  - device_id: 8fcbe6652dc5f7737c49fda014896978
    domain: bthome
    type: button_1
    subtype: press
    id: den_btn_1_press
    trigger: device
  - device_id: 8fcbe6652dc5f7737c49fda014896978
    domain: bthome
    type: button_2
    subtype: press
    id: den_btn_2_press
    trigger: device
  - device_id: 8fcbe6652dc5f7737c49fda014896978
    domain: bthome
    type: button_3
    subtype: press
    id: den_btn_3_press
    trigger: device
  - device_id: 8fcbe6652dc5f7737c49fda014896978
    domain: bthome
    type: button_4
    subtype: press
    id: den_btn_4_press
    trigger: device
  - device_id: 8fcbe6652dc5f7737c49fda014896978
    domain: bthome
    type: button_4
    subtype: long_press
    id: den_btn_4_long
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: den_btn_1_press
      sequence:
      - target:
          entity_id: light.foyer_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: den_btn_2_press
      sequence:
      - target:
          entity_id: light.porch_light_mini
        action: light.toggle
    - conditions:
      - condition: trigger
        id: den_btn_3_press
      sequence:
      - target:
          entity_id: light.outside_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: den_btn_4_press
      sequence:
      - target:
          entity_id: light.den_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: den_btn_4_long
      sequence:
      - target:
          entity_id: light.every_light
        action: light.turn_off
      - delay:
          milliseconds: 500
      - target:
          entity_id: light.tv_ambient_lights
        action: light.turn_on
    default: []
  mode: single
- id: '1761881973438'
  alias: '[Remote] Kitchen Remote Control 2'
  description: Handles all button presses for kitchen remote 2.
  triggers:
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_1
    subtype: press
    id: kitch_1_btn_1_press
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_1
    subtype: double_press
    id: kitch_1_btn_1_double
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_1
    subtype: long_press
    id: kitch_1_btn_1_long
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_2
    subtype: press
    id: kitch_1_btn_2_press
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_3
    subtype: press
    id: kitch_1_btn_3_press
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_3
    subtype: long_press
    id: kitch_1_btn_3_long
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_4
    subtype: long_press
    id: kitch_1_btn_4_long
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: kitch_1_btn_1_press
      sequence:
      - target:
          entity_id: light.kitchen_ceiling_lights_3
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_1_btn_1_double
      sequence:
      - target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 25
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: kitch_1_btn_1_long
      sequence:
      - target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 100
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: kitch_1_btn_2_press
      sequence:
      - target:
          entity_id: light.under_cabinet_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_1_btn_3_press
      sequence:
      - target:
          entity_id: light.table_light
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_1_btn_3_long
      sequence:
      - target:
          entity_id: input_boolean.romance_time
        action: input_boolean.turn_on
    - conditions:
      - condition: trigger
        id: kitch_1_btn_4_long
      sequence:
      - target:
          entity_id: light.every_light
        action: light.turn_off
      - delay:
          milliseconds: 500
      - target:
          entity_id: light.tv_ambient_lights
        action: light.turn_on
    default: []
  mode: single
- id: '1761882426306'
  alias: '[Remote] Kitchen Remote Control 1'
  description: Handles all button presses for the main kitchen remote 1.
  triggers:
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_1
    subtype: press
    id: kitch_btn_1_press
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_1
    subtype: long_press
    id: kitch_btn_1_long
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_1
    subtype: double_press
    id: kitch_btn_1_double
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_2
    subtype: press
    id: kitch_btn_2_press
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_2
    subtype: long_press
    id: kitch_btn_2_long
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_3
    subtype: press
    id: kitch_btn_3_press
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_4
    subtype: press
    id: kitch_btn_4_press
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_4
    subtype: long_press
    id: kitch_btn_4_long
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: kitch_btn_1_press
      sequence:
      - target:
          entity_id: light.kitchen_ceiling_lights_3
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_btn_1_long
      sequence:
      - target:
          entity_id: light.sofa_lamp
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_btn_1_double
      sequence:
      - target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 25
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: kitch_btn_2_press
      sequence:
      - target:
          entity_id: light.under_cabinet_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_btn_2_long
      sequence:
      - target:
          entity_id: light.fireplace_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_btn_3_press
      sequence:
      - target:
          entity_id: light.table_light
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_btn_4_press
      sequence:
      - target:
          entity_id: light.kitchen_lights
        action: light.turn_off
    - conditions:
      - condition: trigger
        id: kitch_btn_4_long
      sequence:
      - target:
          entity_id: light.every_light
        action: light.turn_off
      - delay:
          milliseconds: 500
      - target:
          entity_id: light.tv_ambient_lights
        action: light.turn_on
    default: []
  mode: single
- id: '1761882949117'
  alias: '[Remote] Ensuite Remote Control'
  description: Handles all button presses for the ensuite remote.
  triggers:
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_1
    subtype: press
    id: ensuite_btn_1_press
    trigger: device
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_1
    subtype: double_press
    id: ensuite_btn_1_double
    trigger: device
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_1
    subtype: long_press
    id: ensuite_btn_1_long
    trigger: device
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_2
    subtype: press
    id: ensuite_btn_2_press
    trigger: device
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_3
    subtype: press
    id: ensuite_btn_3_press
    trigger: device
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_4
    subtype: press
    id: ensuite_btn_4_press
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: ensuite_btn_1_press
      sequence:
      - target:
          entity_id: light.jacuzzi_downlight
        action: light.toggle
    - conditions:
      - condition: trigger
        id: ensuite_btn_1_double
      sequence:
      - target:
          entity_id: light.jacuzzi_downlight
        data:
          color_temp_kelvin: 3600
          brightness_pct: 10
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: ensuite_btn_1_long
      sequence:
      - target:
          entity_id: light.jacuzzi_downlight
        data:
          brightness_pct: 100
          color_temp_kelvin: 3600
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: ensuite_btn_2_press
      sequence:
      - target:
          entity_id: light.jacuzzi_downlight
        data:
          color_temp_kelvin: 3600
          brightness_pct: 10
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: ensuite_btn_3_press
      sequence:
      - target:
          entity_id: light.jacuzzi_downlight
        data:
          brightness_pct: 50
          color_name: deeppink
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: ensuite_btn_4_press
      sequence:
      - target:
          entity_id: light.jacuzzi_downlight
        data:
          brightness_pct: 50
          color_name: darkviolet
        action: light.turn_on
    default: []
  mode: single
- id: '1761883452271'
  alias: '[Remote] Nightstand Remote Control'
  description: Handles all 4 button presses for nightstand remote.
  triggers:
  - device_id: 78ff2e94b80783ed2058499a305889b0
    domain: zha
    type: remote_button_short_press
    subtype: button_1
    id: nightstand_btn_1_press
    trigger: device
  - device_id: 78ff2e94b80783ed2058499a305889b0
    domain: zha
    type: remote_button_short_press
    subtype: button_2
    id: nightstand_btn_2_press
    trigger: device
  - device_id: 78ff2e94b80783ed2058499a305889b0
    domain: zha
    type: remote_button_short_press
    subtype: button_3
    id: nightstand_btn_3_press
    trigger: device
  - device_id: 78ff2e94b80783ed2058499a305889b0
    domain: zha
    type: remote_button_short_press
    subtype: button_4
    id: nightstand_btn_4_press
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: nightstand_btn_1_press
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        data:
          transition: 3
        action: light.toggle
    - conditions:
      - condition: trigger
        id: nightstand_btn_2_press
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        data:
          brightness_pct: 1
          color_temp_kelvin: 2496
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: nightstand_btn_3_press
      sequence:
      - target:
          entity_id: light.bedroom_lights
        data:
          transition: 3
        action: light.turn_off
      - target:
          entity_id: light.wiz_rgbww_tunable_82d732
        data:
          transition: 5
        action: light.turn_off
    - conditions:
      - condition: trigger
        id: nightstand_btn_4_press
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        data:
          brightness_pct: 1
          color_name: red
        action: light.turn_on
      - target:
          entity_id: light.wiz_rgbww_tunable_82d732
        data:
          brightness_pct: 30
          color_name: red
        action: light.turn_on
      - action: media_player.volume_set
        metadata: {}
        target:
          entity_id: media_player.bedroom_stereo_3
        data:
          volume_level: 0.35
      - action: media_player.play_media
        metadata: {}
        target:
          entity_id: media_player.bedroom_stereo_3
        data:
          media:
            media_content_id: library://playlist/138
            media_content_type: music
            metadata:
              title: Lovely Nights
              thumbnail: https://cdn-images.dzcdn.net/images/cover/4da0c791bef5a1a3fc42506d413cb773-9711b3c62b19c9e1d23e6789dd819ef1-d15d476764e117d2c58cafae72e151cd-d81f340086d43567c26635a6732844ce/500x500-000000-80-0-0.jpg
              media_class: playlist
              children_media_class:
              navigateIds:
              - {}
              - media_content_type: music_assistant
                media_content_id: playlists
              browse_entity_id: media_player.bedroom_stereo_3
    default: []
  mode: single
- id: '1761884965420'
  alias: '[Control] HVAC Mister'
  description: Turns the HVAC mister on when cooling (if warm/dry) and off when idle.
  triggers:
  - entity_id: sensor.hvac_mode
    to: cooling
    id: turn_on
    trigger: state
  - entity_id: sensor.hvac_mode
    to: idle
    for:
      seconds: 60
    id: turn_off
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: turn_on
      - condition: state
        entity_id: binary_sensor.night
        state: 'off'
      - condition: not
        conditions:
        - condition: state
          entity_id: weather.home
          state: rainy
      - condition: numeric_state
        entity_id: sensor.outside_recent_temperature
        above: 77
      sequence:
      - target:
          entity_id: switch.hvac_mister_2
        action: switch.turn_on
    - conditions:
      - condition: trigger
        id: turn_off
      - condition: state
        entity_id: switch.hvac_mister_2
        state: 'on'
      sequence:
      - target:
          entity_id: switch.hvac_mister_2
        action: switch.turn_off
    default: []
  mode: single
- id: '1761928278535'
  alias: '[Presence] Last Person Leaves - Away actions'
  description: Runs the 'away' script when the last person has left.
  triggers:
  - entity_id:
    - input_boolean.darren_home
    from:
    - 'on'
    to:
    - 'off'
    id: darren_left
    trigger: state
    for:
      minutes: 6
  - entity_id:
    - input_boolean.donna_home
    from:
    - 'on'
    to:
    - 'off'
    id: donna_left
    trigger: state
    for:
      minutes: 6
  conditions:
  - condition: template
    value_template: "{{ (trigger.id == 'darren_left' and is_state('input_boolean.donna_home',
      'off')) or\n   (trigger.id == 'donna_left' and is_state('input_boolean.darren_home',
      'off')) }}"
  actions:
  - continue_on_error: true
    target:
      entity_id: alarm_control_panel.alarmo
    data:
      code: '{{ states(''input_text.secure_code'') }}'
    action: alarm_control_panel.alarm_arm_away
  - continue_on_error: true
    target:
      entity_id: switch.main_kiosk_screen
    action: switch.turn_off
  - continue_on_error: true
    target:
      entity_id:
      - input_boolean.people_home_boolean
      - light.every_light
      - input_boolean.auto_tablet
      - input_boolean.auto_cameras
      - input_boolean.disable_popups
      - input_boolean.disable_cabinet_auto_lights
      - input_boolean.disable_patio_motion
      - input_boolean.disable_garage_auto_lights
      - input_boolean.auto_backgroundz
      - switch.night_switches
      - switch.den_nightlight_plugs
      - switch.office_work_bench_zb
    action: homeassistant.turn_off
  - delay:
      seconds: 3
  - continue_on_error: true
    data:
      command: turn off kitchen water heater
    action: google_assistant_sdk.send_text_command
  - continue_on_error: true
    target:
      entity_id:
      - input_boolean.door_announcements
      - input_boolean.camera_snapshots
      - input_boolean.patio_garage_alerts
      - light.sofa_lamp
      - light.under_cabinet_lights
      - input_boolean.motion_lights
    action: homeassistant.turn_on
  - continue_on_error: true
    action: script.nest_set_away
  - delay:
      seconds: 10
  - continue_on_error: true
    target:
      entity_id: media_player.kitchen_speakers_2
    data:
      volume_level: 0.5
    action: media_player.volume_set
  - delay:
      seconds: 5
  - continue_on_error: true
    target:
      entity_id: media_player.kitchen_speakers_2
    data:
      media_content_id: library://radio/3
      media_content_type: music
    action: media_player.play_media
  - delay:
      seconds: 3
  - continue_on_error: true
    data:
      command: turn off den tv
    action: google_assistant_sdk.send_text_command
  - delay:
      seconds: 3
  - continue_on_error: true
    target:
      entity_id:
      - lock.side_door
      - lock.back_door
    action: lock.lock
  mode: single
- id: '1761947757593'
  alias: Report state on start-up
  description: Publishes to MQTT, reloads kiosks, and sets theme on startup
  triggers:
  - event: start
    trigger: homeassistant
  actions:
  - data:
      topic: shellies/command
      payload: announce
    action: mqtt.publish
  - delay:
      seconds: 2
  - continue_on_error: true
    target:
      entity_id:
      - button.main_kiosk_load_start_url
      - button.ensuite_kiosk_load_start_url
    action: button.press
  - delay:
      seconds: 2
  - data:
      name: Blue-Nightz
    action: frontend.set_theme
  mode: single
- id: '1761965575144'
  alias: '[Presence] First Person Arrives - Welcome actions'
  description: Runs 'welcome home' script when the first person arrives.
  triggers:
  - entity_id: input_boolean.darren_home
    from: 'off'
    to: 'on'
    id: darren
    trigger: state
  - entity_id: input_boolean.donna_home
    from: 'off'
    to: 'on'
    id: donna
    trigger: state
  conditions:
  - condition: template
    value_template: "{{ (trigger.id == 'darren' and is_state('input_boolean.donna_home',
      'off')) or\n   (trigger.id == 'donna' and is_state('input_boolean.darren_home',
      'off')) }}"
  actions:
  - continue_on_error: true
    target:
      entity_id:
      - input_boolean.people_home_boolean
      - input_boolean.camera_snapshots
      - input_boolean.disable_popups
      - input_boolean.auto_tablet
      - input_boolean.auto_backgroundz
      - input_boolean.disable_inside_popups
      - switch.main_kiosk_screen
      - switch.den_nightlight_plugs
      - switch.office_work_bench_zb
    action: homeassistant.turn_on
  - continue_on_error: true
    data:
      command: turn on kitchen water heater
    action: google_assistant_sdk.send_text_command
  - continue_on_error: true
    target:
      entity_id:
      - input_boolean.notifications
      - input_boolean.motion_lights
      - input_boolean.patio_garage_alerts
    action: homeassistant.turn_off
  - continue_on_error: true
    data:
      entity_id: media_player.kitchen_speakers_2
      volume_level: 0.4
    action: media_player.volume_set
  - if:
    - condition: state
      entity_id: media_player.kitchen_speakers_2
      state: playing
    then:
    - continue_on_error: true
      target:
        entity_id: media_player.kitchen_speakers_2
      action: media_player.media_stop
  - continue_on_error: true
    action: script.nest_set_home
  - delay:
      minutes: 3
  - continue_on_error: true
    target:
      entity_id:
      - switch.main_kiosk_screen
      - switch.ensuite_kiosk_screen
    action: switch.turn_on
  - delay:
      seconds: 5
  - continue_on_error: true
    target:
      entity_id:
      - light.main_kiosk_screen
    action: light.turn_on
  - continue_on_error: true
    data:
      path: /lovelace/newtab
      browser_id:
      - 22de4b5bc46885f8fafdf89c6db80a28
      - 8ee04fb979f15f78deb7840ab3ca3242
    action: browser_mod.navigate
  - choose:
    - conditions:
      - condition: state
        entity_id: light.outside_lights
        state: 'off'
      sequence:
      - stop: Outside lights are already off
    - conditions:
      - condition: time
        after: '22:00:00'
        before: 07:00:00
      sequence:
      - delay:
          minutes: 4
      - continue_on_error: true
        target:
          entity_id: light.outside_lights
        action: light.turn_off
    - conditions:
      - condition: time
        after: 07:00:01
        before: '21:59:59'
      sequence:
      - delay:
          minutes: 10
      - continue_on_error: true
        target:
          entity_id: light.outside_lights
        action: light.turn_off
  mode: single
- id: '1761977564662'
  alias: '[Presence] Master Presence Control'
  description: Handles person-based presence for arrivals and departures.
  triggers:
  - entity_id: person.darren
    from: not_home
    to: home
    id: darren
    trigger: state
    for:
      seconds: 8
  - entity_id: person.darren
    from: home
    to: not_home
    id: darren
    trigger: state
  - entity_id: person.donna
    from: not_home
    to: home
    id: donna
    trigger: state
  - entity_id: person.donna
    from: home
    to: not_home
    id: donna
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ is_arriving }}'
      sequence:
      - continue_on_error: true
        target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
        action: alarm_control_panel.alarm_disarm
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.night
            state: 'on'
          sequence:
          - continue_on_error: true
            target:
              entity_id: light.outside_lights
            action: light.turn_on
        - conditions:
          - condition: state
            entity_id: binary_sensor.night
            state: 'off'
          sequence:
          - continue_on_error: true
            target:
              entity_id:
              - light.entryway_ceiling_dimmer
              - light.laundry_room_dimmer
            action: light.turn_on
      - choose:
        - conditions:
          - condition: state
            entity_id: cover.garage_door
            state: closed
          sequence:
          - continue_on_error: true
            target:
              entity_id: cover.garage_door
            action: cover.open_cover
        - conditions:
          - condition: state
            entity_id: cover.garage_door
            state: open
          sequence:
          - continue_on_error: true
            target:
              entity_id: light.garage_lights
            action: light.turn_on
      - choose:
        - conditions:
          - condition: trigger
            id: darren
          sequence:
          - continue_on_error: true
            target:
              entity_id: input_boolean.darren_home
            action: input_boolean.turn_on
          - continue_on_error: true
            target:
              entity_id:
              - input_boolean.patio_garage_alerts
              - input_boolean.naptime
            action: input_boolean.turn_off
        - conditions:
          - condition: trigger
            id: donna
          sequence:
          - continue_on_error: true
            target:
              entity_id: input_boolean.donna_home
            action: input_boolean.turn_on
          - continue_on_error: true
            target:
              entity_id: input_boolean.patio_garage_alerts
            action: input_boolean.turn_off
    - conditions:
      - condition: template
        value_template: '{{ not is_arriving }}'
      sequence:
      - choose:
        - conditions:
          - condition: trigger
            id: darren
          sequence:
          - continue_on_error: true
            target:
              entity_id:
              - input_boolean.camera_snapshots
              - switch.fmd_pixel8pro_high_frequency_mode
            action: homeassistant.turn_on
          - continue_on_error: true
            target:
              entity_id:
              - input_boolean.darren_home
              - light.office_lights
              - switch.ha2_office_monitor
              - fan.hallway_fan
              - switch.keurig_coffee_maker
            action: homeassistant.turn_off
        - conditions:
          - condition: trigger
            id: donna
          sequence:
          - continue_on_error: true
            target:
              entity_id: input_boolean.donna_home
            action: input_boolean.turn_off
          - continue_on_error: true
            target:
              entity_id: input_boolean.patio_garage_alerts
            action: input_boolean.turn_on
  mode: parallel
  max_exceeded: silent
  variables:
    is_arriving: '{{ trigger.to_state.state == ''home'' }}'
- id: '1762015911681'
  alias: Mailbox Opened Notification
  description: ''
  triggers:
  - device_id: 36598d5759f923c08a41bacff5b869ac
    domain: binary_sensor
    entity_id: e8b3607933bd162bd10ead26edd60570
    type: opened
    trigger: device
  actions:
  - data:
      volume_level: 0
    target:
      entity_id: media_player.den_mini
    action: media_player.volume_set
  - target:
      entity_id: media_player.den_mini
    action: media_player.turn_on
  - delay:
      seconds: 1
  - data:
      volume_level: 0.7
    target:
      entity_id: media_player.den_mini
    action: media_player.volume_set
  - delay:
      seconds: 1
  - target:
      entity_id: media_player.den_mini
    data:
      media:
        media_content_id: media-source://media_source/local/youve-got-mail-sound.mp3
        media_content_type: audio/mpeg
        metadata: {}
    action: media_player.play_media
  - if:
    - condition: state
      entity_id: sensor.pixel_8_pro_ringer_mode
      state: normal
    - condition: state
      entity_id: sensor.pixel_8_pro_do_not_disturb_sensor
      state: 'off'
    then:
    - data:
        message: TTS
        data:
          tts_text: You've got mail!!!
          media_stream: alarm_stream_max
      action: notify.mobile_app_pixel_8_pro
  - data:
      message: Mailbox opened at {{ states('sensor.time_12_hour_am_pm') }}
      data:
        notification_icon: mdi:mailbox
        visibility: public
    action: notify.mobile_app_pixel_8_pro
  - delay:
      seconds: 4
  - data:
      volume_level: 0.4
    target:
      entity_id: media_player.den_mini
    action: media_player.volume_set
  mode: queued
- id: '1762303469591'
  alias: '[Notify] Critical Water Leak Alert'
  description: Handles all critical water leak alerts, closes valves/plugs, and sends
    alerts.
  triggers:
  - trigger: state
    entity_id: binary_sensor.water_heater_leak_sensor
    to: 'on'
    id: water_heater
  - trigger: state
    entity_id: binary_sensor.washer_leak_sensor
    to: 'on'
    id: washer
  actions:
  - variables:
      tts_message: "{% if trigger.id == 'water_heater' %}\n  Water heater is Leaking!\n{%
        else %}\n  Washing machine is Leaking!\n{% endif %}\n"
  - choose:
    - conditions:
      - condition: trigger
        id: water_heater
      sequence:
      - action: valve.close_valve
        continue_on_error: true
        target:
          entity_id: valve.main_water_valve
    - conditions:
      - condition: trigger
        id: washer
      sequence:
      - action: homeassistant.turn_off
        continue_on_error: true
        target:
          entity_id: switch.washer_plug_zb
      - action: valve.close_valve
        continue_on_error: true
        target:
          entity_id: valve.main_water_valve
  - action: notify.mobile_app_pixel_8_pro
    continue_on_error: true
    data:
      message: TTS
      data:
        tts_text: '{{ tts_message }}'
        media_stream: alarm_stream_max
  - action: notify.mobile_app_pixel_5
    continue_on_error: true
    data:
      message: TTS
      data:
        tts_text: '{{ tts_message }}'
        media_stream: alarm_stream_max
  - action: notify.notify_all
    continue_on_error: true
    data:
      message: '{{ tts_message }} at {{ states(''sensor.time_12_hour_am_pm'') }}'
      data:
        notification_icon: mdi:water
        visibility: public
  - action: media_player.turn_on
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
  - action: media_player.volume_set
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      volume_level: 0.8
  - delay:
      seconds: 2
  - action: tts.google_say
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      message: '{{ tts_message }}'
  - delay:
      seconds: 10
  - action: tts.google_say
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      message: '{{ tts_message }}'
  - delay:
      seconds: 10
  - action: media_player.volume_set
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      volume_level: 0.3
  initial_state: true
  mode: queued
- id: '1762304006685'
  alias: '[Notify] HVAC Water Leak (remixed)'
  description: ''
  triggers:
  - trigger: state
    entity_id: binary_sensor.hvac_leak_sensor
    to: 'on'
  actions:
  - action: climate.turn_off
    continue_on_error: true
    target:
      entity_id: climate.den
  - action: notify.mobile_app_pixel_8_pro
    continue_on_error: true
    data:
      message: TTS
      data:
        tts_text: Air conditioner is leaking!!!
        media_stream: alarm_stream_max
  - action: notify.mobile_app_pixel_5
    continue_on_error: true
    data:
      message: TTS
      data:
        tts_text: Air conditioner is leaking!!!
        media_stream: alarm_stream_max
  - action: notify.notify_all
    continue_on_error: true
    data:
      message: Air conditioner leaking {{ states('sensor.time_12_hour_am_pm') }}
      data:
        notification_icon: mdi:water
        visibility: public
  - action: media_player.turn_on
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
  - action: media_player.volume_set
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      volume_level: 0.8
  - delay:
      seconds: 2
  - action: tts.google_say
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      message: Air conditioner is Leaking!
  - delay:
      seconds: 10
  - action: tts.google_say
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      message: Air conditioner is Leaking!
  - delay:
      seconds: 10
  - action: media_player.volume_set
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      volume_level: 0.3
  initial_state: true
  mode: queued
- id: '1762304880858'
  alias: '[Notify] Water Leak All Clear'
  description: Resets systems and sends notification when ALL water leak alerts are
    clear.
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.hvac_leak_sensor
    - binary_sensor.water_heater_leak_sensor
    - binary_sensor.washer_leak_sensor
    to: 'off'
    for: 00:03:00
    id: clear_water_leak
  conditions:
  - condition: template
    value_template: '{{ trigger.from_state.state == ''on'' }}'
  - condition: state
    entity_id: binary_sensor.hvac_leak_sensor
    state: 'off'
  - condition: state
    entity_id: binary_sensor.water_heater_leak_sensor
    state: 'off'
  - condition: state
    entity_id: binary_sensor.washer_leak_sensor
    state: 'off'
  actions:
  - variables:
      trigger_name: '{{ trigger.to_state.attributes.friendly_name | default(trigger.entity_id)
        }}'
      clear_title: WATER LEAK ALL CLEAR
      clear_message: All water leak sensors are now clear. {{ trigger_name }} was
        the last to clear. ✅
      clear_icon: mdi:check-circle-outline
  - action: valve.open_valve
    continue_on_error: true
    target:
      entity_id: valve.main_water_valve
  - action: switch.turn_on
    continue_on_error: true
    target:
      entity_id: switch.washer_plug_zb
  - action: climate.turn_on
    continue_on_error: true
    target:
      entity_id: climate.den
  - action: logbook.log
    continue_on_error: true
    data:
      name: Water Leak System
      entity_id: '{{ trigger.entity_id }}'
      message: All clear received from {{ trigger_name }}
  - action: notify.notify_all
    continue_on_error: true
    data:
      title: '{{ clear_title }}'
      message: '{{ clear_message }}'
      data:
        channel: alert
        importance: high
        notification_icon: '{{ clear_icon }}'
  - action: media_player.volume_set
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      volume_level: 0.6
  - delay:
      seconds: 2
  - action: tts.google_say
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      message: All water leak sensors are now clear. Resuming normal operation.
  mode: restart
- id: '1762316796747'
  alias: '[Notify] Secondary Water Leak Alert'
  description: Handles non-critical water leak alerts and sends notifications.
  triggers:
  - trigger: state
    entity_id: binary_sensor.bathroom_leak_sensor_moisture
    to: 'on'
    id: bathroom_leak
  - trigger: state
    entity_id: binary_sensor.donnas_sink_leak_sensor
    to: 'on'
    id: donnas_sink_leak
  - trigger: state
    entity_id: binary_sensor.kitchen_sink_leaking
    to: 'on'
    id: kitchen_sink_leak
  actions:
  - variables:
      tts_message: "{% if trigger.id == 'bathroom_leak' %}\n  Water leak detected
        in the bathroom!\n{% elif trigger.id == 'donnas_sink_leak' %}\n  Water leak
        detected at Donna's sink!\n{% elif trigger.id == 'kitchen_sink_leak' %}\n
        \ Water leak detected at the kitchen sink!\n{% else %}\n  An unknown water
        leak has been detected!\n{% endif %}\n"
  - if:
    - condition: state
      entity_id: input_boolean.people_home_boolean
      state: 'off'
    then:
    - action: valve.close_valve
      continue_on_error: true
      target:
        entity_id: valve.main_water_valve
  - action: notify.mobile_app_pixel_8_pro
    continue_on_error: true
    data:
      message: TTS
      data:
        tts_text: '{{ tts_message }}'
        media_stream: alarm_stream_max
  - action: notify.mobile_app_pixel_5
    continue_on_error: true
    data:
      message: TTS
      data:
        tts_text: '{{ tts_message }}'
        media_stream: alarm_stream_max
  - action: notify.notify_all
    continue_on_error: true
    data:
      message: '{{ tts_message }} at {{ states(''sensor.time_12_hour_am_pm'') }}'
      data:
        notification_icon: mdi:water
        visibility: public
  - action: media_player.turn_on
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
  - action: media_player.volume_set
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      volume_level: 0.8
  - delay:
      seconds: 2
  - action: tts.google_say
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      message: '{{ tts_message }}'
  - delay:
      seconds: 10
  - action: tts.google_say
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      message: '{{ tts_message }}'
  - delay:
      seconds: 10
  - action: media_player.volume_set
    continue_on_error: true
    target:
      entity_id: media_player.everywhere_3
    data:
      volume_level: 0.3
  initial_state: true
  mode: queued
- id: '1762316898965'
  alias: '[Notify] Secondary Water Leak All Clear'
  description: Resets systems when secondary water leak alerts are clear.
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.bathroom_leak_sensor_moisture
    - binary_sensor.donnas_sink_leak_sensor
    - binary_sensor.kitchen_sink_leaking
    to: 'off'
    for: 00:03:00
  conditions:
  - condition: template
    value_template: '{{ trigger.from_state.state == ''on'' }}'
  - condition: state
    entity_id: binary_sensor.bathroom_leak_sensor_moisture
    state: 'off'
  - condition: state
    entity_id: binary_sensor.donnas_sink_leak_sensor
    state: 'off'
  - condition: state
    entity_id: binary_sensor.kitchen_sink_leaking
    state: 'off'
  actions:
  - variables:
      clear_title: WATER LEAK ALL CLEAR
      clear_message: All water leak sensors are now clear. ✅
      clear_icon: mdi:check-circle-outline
  - action: valve.open_valve
    continue_on_error: true
    target:
      entity_id: valve.main_water_valve
  - action: logbook.log
    data:
      name: Water Leak System
      message: All clear received from secondary water leak sensors.
  - action: notify.notify_all
    data:
      title: '{{ clear_title }}'
      message: '{{ clear_message }}'
      data:
        channel: alert
        importance: high
        notification_icon: '{{ clear_icon }}'
  - action: media_player.volume_set
    continue_on_error: true
    data:
      entity_id: media_player.everywhere_3
      volume_level: 0.6
  - delay:
      seconds: 2
  - action: tts.google_say
    continue_on_error: true
    data_template:
      entity_id: media_player.everywhere_3
      message: All secondary water leak sensors are now clear.
  mode: restart
- id: '1762641698376'
  alias: '[Alert] Send Garage Door Notification'
  description: Sends the garage door alert with an acknowledge button.
  triggers:
  - trigger: event
    event_type: alert.fired
    event_data:
      entity_id: alert.garage_door
  actions:
  - action: notify.notify_all
    data:
      message: '{{ state_attr(''alert.garage_door'', ''message'') }}'
      data:
        tag: garage-open-alert
        actions:
        - action: ACK_GARAGE
          title: SILENCE ALERT
  mode: single
- id: '1762641751876'
  alias: '[Alert] Handle Garage Door Acknowledge'
  description: Acknowledges the garage alert when the notification button is pressed.
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: ACK_GARAGE
  conditions: []
  actions:
  - action: alert.turn_off
    entity_id: alert.garage_door
  mode: single
- id: '1763075334333'
  alias: '[Tablet] Theme Match for Video Wallpaper V18'
  description: Sets browser theme AND mobile wallpaper options based on selected video.
  mode: restart
  triggers:
  - trigger: state
    entity_id: input_select.video_wallpaper
  variables:
    video_theme_map:
      fish:
      - blue
      - - mobile6
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      fish2:
      - red
      - - mobile22
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      fish3:
      - ocean
      - - mobile1
        - mobile23
        - mobile3
        - mobile4
        - mobile51
        - mobile6
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile11
        - mobile121
        - mobile14
        - mobile15
        - mobile16
        - mobile171
        - mobile18
      fish4:
      - yellow
      - - mobile23
        - mobile14
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      fish5:
      - green
      - - mobile23
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      fishy2:
      - ocean
      - - mobile1
        - mobile23
        - mobile3
        - mobile4
        - mobile51
        - mobile6
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile11
        - mobile121
        - mobile14
        - mobile15
        - mobile16
        - mobile171
        - mobile18
      fishyRed:
      - pink
      - - mobile52
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      fishNew2:
      - blue
      - - mobile6
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      nightClouds:
      - ocean
      - - mobile1
        - mobile23
        - mobile3
        - mobile4
        - mobile51
        - mobile6
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile11
        - mobile121
        - mobile14
        - mobile15
        - mobile16
        - mobile171
        - mobile18
      moonRising:
      - orange
      - - mobile121
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      fullMoon:
      - orange
      - - mobile121
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      darkskyMoon:
      - magenta
      - - mobile6
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      spookyMoon:
      - grey
      - - mobile14
        - mobile23
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      cloudyMoon:
      - blue
      - - mobile6
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      veniceNight:
      - orange
      - - mobile121
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      stormyNight:
      - geaux
      - - mobile51
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
      space:
      - blue
      - - mobile6
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      mars:
      - blue
      - - mobile6
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      fireworks:
      - red
      - - mobile22
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      greenNeon:
      - lime
      - - mobile171
        - mobile172
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      berry:
      - purple
      - - mobile20
        - mobile21
        - mobile1
        - mobile19
        - mobile3
        - mobile51
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile11
        - mobile13
        - mobile14
        - mobile15
        - mobile16
        - mobile18
      inferno:
      - orange
      - - mobile121
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      fire:
      - orange
      - - mobile121
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      tunnel:
      - blue
      - - mobile6
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      bubbling:
      - pink
      - - mobile52
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      blackBubbles:
      - pink
      - - mobile52
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      smoked:
      - geaux
      - - mobile51
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
      island:
      - yellow
      - - mobile23
        - mobile14
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      waves:
      - geaux
      - - mobile51
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
      orangeSunset:
      - orange
      - - mobile121
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
      beachyWaves:
      - orange
      - - mobile121
        - mobile11
        - mobile18
        - mobile7
        - mobile8
        - mobile9
        - mobile10
        - mobile3
        - mobile13
        - mobile1
        - mobile15
        - mobile16
        - mobile51
    default_theme_data:
    - lime
    - - mobile171
      - mobile172
      - mobile18
      - mobile7
      - mobile8
      - mobile9
      - mobile10
      - mobile3
      - mobile13
      - mobile1
      - mobile15
      - mobile16
      - mobile51
    selected_video: '{{ trigger.to_state.state }}'
    theme_data: '{{ video_theme_map.get(selected_video, default_theme_data) }}'
    theme_suffix: '{{ theme_data[0] }}'
    mobile_options: '{{ theme_data[1] }}'
    theme_name: '{{ theme_suffix | capitalize }}-Nightz'
  actions:
  - delay: 6
  - action: frontend.set_theme
    data:
      name: '{{ theme_name }}'
  - action: browser_mod.set_theme
    data:
      browser_id:
      - browser_ac9b7f58_cfbfe785
      theme: '{{ theme_name }}'
  - action: input_select.set_options
    target:
      entity_id: input_select.mobile_wallpaper
    data:
      options: '{{ (mobile_options + [states(''input_select.mobile_wallpaper'')])
        | unique | list }}'
  - action: input_select.select_option
    target:
      entity_id: input_select.mobile_wallpaper
    data:
      option: '{{ mobile_options | random }}'
  - action: input_select.set_options
    target:
      entity_id: input_select.mobile_wallpaper
    data:
      options: '{{ mobile_options }}'
- id: '1763612062470'
  alias: '[FMD] Turn ON High Frequency Mode on Departure'
  description: Automatically enables FMD High Frequency Mode when Darren leaves ANY
    zone.
  triggers:
  - entity_id: person.darren
    to: not_home
    trigger: state
  conditions:
  - condition: template
    value_template: '{{ trigger.from_state.state != ''not_home'' }}'
  actions:
  - target:
      entity_id: switch.fmd_pixel8pro_high_frequency_mode
    action: switch.turn_on
    continue_on_error: true
  - delay:
      seconds: 6
  - continue_on_error: true
    action: number.set_value
    target:
      entity_id: number.fmd_pixel8pro_update_interval
    data:
      value: 30
  mode: single
- id: '1763612151397'
  alias: '[FMD] Prompt for Normal Frequency on Arrival'
  description: Asks to turn OFF High Frequency Mode when Darren arrives at a zone
    (except home).
  triggers:
  - entity_id: person.darren
    from: not_home
    to:
    trigger: state
  - entity_id: switch.fmd_pixel8pro_high_frequency_mode
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: switch.fmd_pixel8pro_high_frequency_mode
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: person.darren
      state: home
  actions:
  - data:
      message: You have arrived at {{ trigger.to_state.state }}. Turn OFF High Frequency
        Mode to save battery?
      title: FMD Battery Saver
      data:
        tag: fmd_normal_freq_prompt
        persistent: true
        sticky: true
        color: '#2196F3'
        actions:
        - action: TURN_OFF_FMD_HF
          title: Turn OFF (Save Battery)
    action: notify.mobile_app_pixel_8_pro
  mode: single
- id: '1763612230991'
  alias: '[FMD] Handle Normal Frequency Response'
  description: Turns OFF FMD High Frequency switch.
  triggers:
  - event_type: mobile_app_notification_action
    event_data:
      action: TURN_OFF_FMD_HF
    trigger: event
  actions:
  - target:
      entity_id: switch.fmd_pixel8pro_high_frequency_mode
    continue_on_error: true
    action: switch.turn_off
  - data:
      message: clear_notification
      data:
        tag: fmd_normal_freq_prompt
    action: notify.mobile_app_pixel_8_pro
  mode: single
- id: '1767328462451'
  alias: High Tide Alert
  description: ''
  triggers:
  - trigger: template
    value_template: '{% set tide = states(''sensor.tchefuncta_river_lake_pontchartrain_la_next_high_tide'')
      | as_datetime %} {{ tide is not none and 0 < (tide - now()).total_seconds()
      < 1800 }}'
  actions:
  - action: notify.mobile_app_pixel_8_pro
    continue_on_error: true
    data:
      title: High Tide Soon!
      message: 'High tide in 30 minutes. Height: {{ state_attr(''sensor.tchefuncta_river_lake_pontchartrain_la_next_high_tide'',
        ''height'') }}'
      data:
        clickAction: /dashboard-test/tides
- id: '1767464025010'
  alias: 'Watchdog: Stale Sensor Check'
  description: Checks if battery sensors have stopped reporting data
  triggers:
  - minutes: '0'
    trigger: time_pattern
  actions:
  - variables:
      stale_sensors: "{% set ns = namespace(stale=[]) %} {% for entity in sensors_to_check
        %}\n  {% if states(entity) not in ['unavailable', 'unknown'] %}\n     {% set
        last_updated = as_timestamp(states[entity].last_updated) %}\n     {% if (as_timestamp(now())
        - last_updated) > stale_seconds %}\n       {% set ns.stale = ns.stale + [state_attr(entity,
        'friendly_name') or entity] %}\n     {% endif %}\n  {% endif %}\n{% endfor
        %} {{ ns.stale }}\n"
  - if:
    - condition: template
      value_template: '{{ stale_sensors | length > 0 }}'
    then:
    - action: notify.mobile_app_pixel_8_pro
      continue_on_error: true
      data:
        title: ⚠️ Stale Sensors Detected
        message: 'The following sensors haven''t updated in 2 hours: {{ stale_sensors
          | join('', '') }}

          Check batteries or connections.

          '
        data:
          tag: stale_sensors
          clickAction: /config/dashboard
    - action: persistent_notification.create
      continue_on_error: true
      data:
        title: ⚠️ Stale Sensors Detected
        message: 'The following sensors haven''t updated in 2 hours: {{ stale_sensors
          | join('', '') }}

          Check batteries or connections.

          '
        notification_id: stale_sensor_alert
  mode: single
  variables:
    sensors_to_check:
    - sensor.patio_temperature_2
    - sensor.office_temperature_2
    - sensor.bedroom_temperature_2
    - sensor.guest_room_temperature
    - sensor.den_temperature
    - sensor.kitchen_temperature_2
    - sensor.bathroom_temperature_2
    - sensor.ensuite_temperature_2
    - sensor.xtra_motion_sensor_temperature
    - sensor.kitchen_fridge_temperature
    - sensor.garage_fridge_voltage_3
    - sensor.work_bench_energy_voltage
    - sensor.dryer_energy_voltage
    - sensor.washer_plug_zb_voltage
    - sensor.office_work_bench_zb_voltage
    - sensor.keurig_coffee_electric_consumption_v
    - sensor.air_cleaner_electric_consumption_v
    - sensor.ensuite_fan_voltage
    - sensor.hallway_fan_voltage
    - sensor.patio_fan_light_patio_fan_light_power
    - sensor.slim_multi_sensor_pir_door_temperature_illumination_illuminance
    - sensor.xtra_motion_sensor_luminosity
    - sensor.bathroom_motion_illuminance
    - sensor.kitchen_bt_motion_illuminance
    - sensor.office_bt_illuminance
    - sensor.bedroom_illuminance
    stale_seconds: 7200
- id: '1767986533726'
  alias: NWS - Weather Alerts (Combined)
  description: Mobile and Persistent notifications for new NWS alerts
  triggers:
  - entity_id: sensor.nws_alerts_alerts
    trigger: state
  conditions:
  - condition: numeric_state
    entity_id: sensor.nws_alerts_alerts
    above: 0
  actions:
  - repeat:
      for_each: "{{ trigger.to_state.attributes.Alerts \n   | reject('in', trigger.from_state.attributes.Alerts)
        \n   | sort(attribute='ID') \n   | list() }}"
      sequence:
      - action: notify.mobile_app_pixel_8_pro
        continue_on_error: true
        data:
          title: ⚠️ {{ repeat.item.Event }}
          message: '{{ repeat.item.Description }}'
          data:
            tag: NWS_{{ repeat.item.ID }}
            channel: alert
            group: weather_alerts
            sticky: true
            importance: high
            color: '#D32F2F'
            notification_icon: mdi:weather-alert
            ttl: 0
            priority: high
            tts_text: Attention! {{ repeat.item.Event }} issued for your area.
            clickAction: /lovelace/weatheralert
      - action: persistent_notification.create
        continue_on_error: true
        data:
          notification_id: NWS_{{ repeat.item.ID }}
          title: 'NWS Alert: {{ repeat.item.Event }}'
          message: '{{ repeat.item.Description }}'
      - delay:
          seconds: 2
  mode: queued
  max: 10
- id: '255990513186892'
  alias: 'Lighting: Front Porch Automation'
  description: Handles all front porch motion (Nest, Reolink, Sensor) and door events.
  triggers:
  - trigger: state
    entity_id: binary_sensor.front_porch_motion
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.front_door
    to: open
  - trigger: device
    domain: nest
    device_id: 011d22447a45c26939459e4d099889cb
    type: camera_person
  - trigger: device
    domain: binary_sensor
    device_id: 65ffc57afcd59b6ced1b3c6b83255f9b
    entity_id: 5a82940c665069df453de06251fe1250
    type: turned_on
  conditions:
  - condition: or
    conditions:
    - condition: sun
      after: sunset
      after_offset: 00:45:00
    - condition: sun
      before: sunrise
      before_offset: 00:45:00
  actions:
  - action: light.turn_on
    continue_on_error: true
    target:
      entity_id:
      - light.porch_light_mini
      - light.front_yard_cam_floodlight
      - light.front_door_floodlight
    data:
      brightness: 255
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.front_porch_motion
      to: 'off'
    timeout:
      minutes: 30
    continue_on_timeout: true
  - delay:
      minutes: 5
  - action: light.turn_off
    continue_on_error: true
    target:
      entity_id:
      - light.porch_light_mini
      - light.front_yard_cam_floodlight
      - light.front_door_floodlight
  mode: restart
  max_exceeded: silent
- id: '3383270780838229'
  alias: '[Notify] Front Door Person Detected (Unified)'
  description: Triggers on Nest or Reolink person detection. Sends snapshot to Pixel
    & Fire TV.
  triggers:
  - trigger: device
    domain: nest
    device_id: 011d22447a45c26939459e4d099889cb
    type: camera_person
  - trigger: device
    domain: binary_sensor
    device_id: 65ffc57afcd59b6ced1b3c6b83255f9b
    entity_id: 5a82940c665069df453de06251fe1250
    type: turned_on
  conditions: []
  actions:
  - variables:
      base_url: http://192.168.1.134:8123
      filename: reolink_snapshot_{{ now().strftime('%Y%m%d-%H%M%S') }}.jpg
      local_path: /config/www/tmp/{{ filename }}
      http_url: '{{ base_url }}/local/tmp/{{ filename }}'
  - action: camera.snapshot
    continue_on_error: true
    target:
      entity_id: camera.go2rtc_streams_front_door
    data:
      filename: '{{ local_path }}'
  - action: notify.android_tv_fire_tv
    continue_on_error: true
    data:
      title: Front Door
      message: Person Detected
      data:
        duration: 12
        position: top-right
        fontsize: large
        transparency: 25%
        color: grey
        interrupt: 1
        image:
          url: '{{ http_url }}'
  - action: notify.mobile_app_pixel_8_pro
    continue_on_error: true
    data:
      title: Person Detected at Front Door
      message: Tap to view live stream
      data:
        image: '{{ http_url }}'
        tag: front_door_person
        clickAction: /dashboard-test/streams
        actions:
        - action: URI
          title: View Live Stream
          uri: /dashboard-cast/porch
  mode: single
  max_exceeded: silent
- id: '1770781464519'
  alias: Maintenance - Cleanup Old Snapshots
  description: Deletes camera snapshots older than 2 days from the www/tmp folder.
  triggers:
  - at: 03:30:00
    trigger: time
  conditions: []
  actions:
  - data: {}
    action: shell_command.delete_old_snapshots
  mode: single
- id: driveway_motion
  alias: 'Camera Alert: Driveway Motion'
  description: Handles Driveway triggers, UI casting, triage, and audio routing.
  triggers:
  - trigger: state
    entity_id: binary_sensor.side_motion_sensor
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.camera_snapshots
    state:
    - 'on'
  actions:
  - continue_on_error: true
    action: browser_mod.navigate
    data:
      path: /dashboard-cast/driveway
  - action: input_boolean.turn_on
    continue_on_error: true
    target:
      entity_id: input_boolean.camera_motion_detected
  - action: camera.snapshot
    continue_on_error: true
    target:
      entity_id: camera.driveway_cam_0
    data:
      filename: /config/www/tmp/last_snapshot_driveway.jpg
  - action: camera.snapshot
    continue_on_error: true
    target:
      entity_id: camera.driveway_cam_0
    data:
      filename: /config/media/last_snapshot_driveway.jpg
  - action: ai_task.generate_data
    continue_on_error: true
    data:
      entity_id: ai_task.google_ai_task
      task_name: Driveway Triage
      instructions: 'Classify the security event in this image. Choose exactly one
        option: "passive" (no people/vehicles), "time-sensitive" (person/vehicle visible),
        or "critical" (highly suspicious/burglary). Respond ONLY with the exact word.'
      attachments:
      - media_content_id: media-source://media_source/local/last_snapshot_driveway.jpg
        media_content_type: image/jpeg
    response_variable: triage_response
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ triage_response is defined and triage_response.data is
          defined and triage_response.data | lower | trim != ''passive'' }}'
      sequence:
      - alias: Initial fast notification
        continue_on_error: true
        action: notify.mobile_app_pixel_8_pro
        data:
          title: 'Driveway: {{ triage_response.data | title }} Motion'
          message: Recording video for deep analysis...
          data:
            notification_icon: mdi:cctv
            image: /local/tmp/last_snapshot_driveway.jpg
            persistent: true
            color: red
            channel: Cameras
            tag: driveway_motion
            actions:
            - action: URI
              title: Click to Open Cameras
              uri: /dashboard-cast/driveway
      - alias: Fire TV Snapshot Overlay
        continue_on_error: true
        action: notify.android_tv_fire_tv
        data:
          title: 'Driveway: {{ triage_response.data | title }}'
          message: Motion Detected. AI Analyzing...
          data:
            duration: 12
            position: top-right
            fontsize: large
            transparency: 25%
            color: grey
            interrupt: 1
            image:
              url: http://192.168.1.134:8123/local/tmp/last_snapshot_driveway.jpg
      - choose:
        - conditions:
          - condition: time
            after: '22:00:00'
            before: 07:00:00
          sequence:
          - continue_on_error: true
            action: media_player.volume_set
            data:
              entity_id: media_player.office_display
              volume_level: 0.3
          - continue_on_error: true
            action: tts.google_say
            data:
              cache: true
              entity_id: media_player.office_display
              message: Motion in driveway
          - continue_on_error: true
            action: google_assistant_sdk.send_text_command
            data:
              command: stream driveway camera on office display
        - conditions:
          - condition: time
            after: 07:00:00
            before: '22:00:00'
          sequence:
          - continue_on_error: true
            action: media_player.volume_set
            data:
              entity_id: media_player.tv_speakers
              volume_level: 0.6
          - continue_on_error: true
            action: tts.google_say
            data:
              cache: true
              entity_id: media_player.tv_speakers
              message: Motion in driveway
      - action: script.turn_on
        continue_on_error: true
        target:
          entity_id: script.driveway_video_processing
      - delay:
          minutes: 4
      - action: input_boolean.turn_off
        continue_on_error: true
        target:
          entity_id: input_boolean.camera_motion_detected
      - continue_on_error: true
        action: browser_mod.javascript
        data:
          code: history.back()
    default:
    - action: input_boolean.turn_off
      continue_on_error: true
      target:
        entity_id: input_boolean.camera_motion_detected
    - continue_on_error: true
      action: browser_mod.javascript
      data:
        code: history.back()
  mode: single
  max_exceeded: silent
- id: front_porch_motion
  alias: 'Camera Alert: Front Porch Motion'
  description: Handles Porch triggers, UI casting, triage, and audio routing.
  mode: single
  max_exceeded: silent
  triggers:
  - trigger: device
    domain: nest
    device_id: 011d22447a45c26939459e4d099889cb
    type: camera_person
  - trigger: device
    domain: binary_sensor
    device_id: 65ffc57afcd59b6ced1b3c6b83255f9b
    entity_id: 5a82940c665069df453de06251fe1250
    type: turned_on
  conditions:
  - condition: state
    entity_id: input_boolean.camera_snapshots
    state: 'on'
  actions:
  - continue_on_error: true
    action: browser_mod.navigate
    data:
      path: /dashboard-cast/porch
  - continue_on_error: true
    action: input_boolean.turn_on
    target:
      entity_id: input_boolean.camera_motion_detected
  - continue_on_error: true
    action: camera.snapshot
    target:
      entity_id: camera.go2rtc_streams_front_door
    data:
      filename: /config/www/tmp/last_snapshot_porch.jpg
  - continue_on_error: true
    action: camera.snapshot
    target:
      entity_id: camera.go2rtc_streams_front_door
    data:
      filename: /config/media/last_snapshot_porch.jpg
  - continue_on_error: true
    action: ai_task.generate_data
    data:
      entity_id: ai_task.google_ai_task
      task_name: Porch Triage
      instructions: 'Classify the security event in this image. Choose exactly one
        option: "passive" (no people/vehicles), "time-sensitive" (person/vehicle visible),
        or "critical" (highly suspicious/burglary). Respond ONLY with the exact word.'
      attachments:
      - media_content_id: media-source://media_source/local/last_snapshot_porch.jpg
        media_content_type: image/jpeg
    response_variable: triage_response
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ triage_response is defined and triage_response.data is
          defined and triage_response.data | lower | trim != ''passive'' }}'
      sequence:
      - alias: Initial fast notification
        continue_on_error: true
        action: notify.mobile_app_pixel_8_pro
        data:
          title: 'Porch: {{ triage_response.data | title }} Motion'
          message: Recording video for deep analysis...
          data:
            notification_icon: mdi:cctv
            image: /local/tmp/last_snapshot_porch.jpg
            persistent: true
            color: red
            channel: Cameras
            tag: porch_motion
            clickAction: /dashboard-test/streams
            actions:
            - action: URI
              title: View Live Stream
              uri: /dashboard-cast/porch
      - alias: Fire TV Snapshot Overlay
        continue_on_error: true
        action: notify.android_tv_fire_tv
        data:
          title: 'Porch: {{ triage_response.data | title }}'
          message: Motion Detected. AI Analyzing...
          data:
            duration: 12
            position: top-right
            fontsize: large
            transparency: 25%
            color: grey
            interrupt: 1
            image:
              url: http://192.168.1.134:8123/local/tmp/last_snapshot_porch.jpg
      - choose:
        - conditions:
          - condition: time
            after: '22:00:00'
            before: 07:00:00
          sequence:
          - continue_on_error: true
            action: media_player.volume_set
            data:
              entity_id: media_player.office_display
              volume_level: 0.3
          - continue_on_error: true
            action: tts.google_say
            data:
              cache: true
              entity_id: media_player.office_display
              message: Motion at front porch
          - continue_on_error: true
            action: google_assistant_sdk.send_text_command
            data:
              command: stream front door camera on office display
        - conditions:
          - condition: time
            after: 07:00:00
            before: '22:00:00'
          sequence:
          - continue_on_error: true
            action: media_player.volume_set
            data:
              entity_id: media_player.tv_speakers
              volume_level: 0.6
          - continue_on_error: true
            action: tts.google_say
            data:
              cache: true
              entity_id: media_player.tv_speakers
              message: Motion at front porch
      - continue_on_error: true
        action: script.turn_on
        target:
          entity_id: script.porch_video_processing
      - delay:
          minutes: 4
      - continue_on_error: true
        action: input_boolean.turn_off
        target:
          entity_id: input_boolean.camera_motion_detected
      - continue_on_error: true
        action: browser_mod.javascript
        data:
          code: history.back()
    default:
    - continue_on_error: true
      action: input_boolean.turn_off
      target:
        entity_id: input_boolean.camera_motion_detected
    - continue_on_error: true
      action: browser_mod.javascript
      data:
        code: history.back()
- id: patio_motion
  alias: 'Camera Alert: Patio Motion'
  description: Handles Patio triggers, UI casting, triage, and audio routing.
  mode: single
  max_exceeded: silent
  triggers:
  - trigger: state
    entity_id: binary_sensor.back_motion
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.patio_garage_alerts
    state: 'on'
  actions:
  - continue_on_error: true
    action: browser_mod.navigate
    data:
      path: /dashboard-cast/patio
  - continue_on_error: true
    action: input_boolean.turn_on
    target:
      entity_id: input_boolean.camera_motion_detected
  - continue_on_error: true
    action: camera.snapshot
    target:
      entity_id: camera.patio_cam_0
    data:
      filename: /config/www/tmp/last_snapshot_patio.jpg
  - continue_on_error: true
    action: camera.snapshot
    target:
      entity_id: camera.patio_cam_0
    data:
      filename: /config/media/last_snapshot_patio.jpg
  - continue_on_error: true
    action: ai_task.generate_data
    data:
      entity_id: ai_task.google_ai_task
      task_name: Patio Triage
      instructions: 'Classify the security event in this image. Choose exactly one
        option: "passive" (no people/vehicles), "time-sensitive" (person/vehicle visible),
        or "critical" (highly suspicious/burglary). Respond ONLY with the exact word.'
      attachments:
      - media_content_id: media-source://media_source/local/last_snapshot_patio.jpg
        media_content_type: image/jpeg
    response_variable: triage_response
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ triage_response is defined and triage_response.data is
          defined and triage_response.data | lower | trim != ''passive'' }}'
      sequence:
      - alias: Initial fast notification
        continue_on_error: true
        action: notify.mobile_app_pixel_8_pro
        data:
          title: 'Patio: {{ triage_response.data | title }} Motion'
          message: Recording video for deep analysis...
          data:
            notification_icon: mdi:cctv
            image: /local/tmp/last_snapshot_patio.jpg
            persistent: true
            color: red
            channel: Cameras
            tag: patio_motion
            clickAction: /dashboard-cast/patio
            actions:
            - action: URI
              title: View Live Stream
              uri: /dashboard-cast/patio
      - alias: Fire TV Snapshot Overlay
        continue_on_error: true
        action: notify.android_tv_fire_tv
        data:
          title: 'Patio: {{ triage_response.data | title }}'
          message: Motion Detected. AI Analyzing...
          data:
            duration: 12
            position: top-right
            fontsize: large
            transparency: 25%
            color: grey
            interrupt: 1
            image:
              url: http://192.168.1.134:8123/local/tmp/last_snapshot_patio.jpg
      - choose:
        - conditions:
          - condition: time
            after: '22:00:00'
            before: 07:00:00
          sequence:
          - continue_on_error: true
            action: media_player.volume_set
            data:
              entity_id: media_player.office_display
              volume_level: 0.3
          - continue_on_error: true
            action: tts.google_say
            data:
              cache: true
              entity_id: media_player.office_display
              message: Motion at the patio
          - continue_on_error: true
            action: google_assistant_sdk.send_text_command
            data:
              command: stream patio camera on office display
        - conditions:
          - condition: time
            after: 07:00:00
            before: '22:00:00'
          sequence:
          - continue_on_error: true
            action: media_player.volume_set
            data:
              entity_id: media_player.tv_speakers
              volume_level: 0.6
          - continue_on_error: true
            action: tts.google_say
            data:
              cache: true
              entity_id: media_player.tv_speakers
              message: Motion at the patio
      - continue_on_error: true
        action: script.turn_on
        target:
          entity_id: script.patio_video_processing
      - delay:
          minutes: 4
      - continue_on_error: true
        action: input_boolean.turn_off
        target:
          entity_id: input_boolean.camera_motion_detected
      - continue_on_error: true
        action: browser_mod.javascript
        data:
          code: history.back()
    default:
    - continue_on_error: true
      action: input_boolean.turn_off
      target:
        entity_id: input_boolean.camera_motion_detected
    - continue_on_error: true
      action: browser_mod.javascript
      data:
        code: history.back()
- id: garage_motion
  alias: 'Camera Alert: Garage Motion'
  description: Handles Garage triggers, UI casting, triage, and audio routing.
  mode: single
  max_exceeded: silent
  triggers:
  - trigger: state
    entity_id: binary_sensor.garage_motion_sensors
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.patio_garage_alerts
    state: 'on'
  actions:
  - continue_on_error: true
    action: browser_mod.navigate
    data:
      path: /dashboard-cast/garage
  - continue_on_error: true
    action: input_boolean.turn_on
    target:
      entity_id: input_boolean.camera_motion_detected
  - continue_on_error: true
    action: camera.snapshot
    target:
      entity_id: camera.garage_cam_0
    data:
      filename: /config/www/tmp/last_snapshot_garage.jpg
  - continue_on_error: true
    action: camera.snapshot
    target:
      entity_id: camera.garage_cam_0
    data:
      filename: /config/media/last_snapshot_garage.jpg
  - continue_on_error: true
    action: ai_task.generate_data
    data:
      entity_id: ai_task.google_ai_task
      task_name: Garage Triage
      instructions: 'Classify the security event in this image. Choose exactly one
        option: "passive" (no people/vehicles), "time-sensitive" (person/vehicle visible),
        or "critical" (highly suspicious/burglary). Respond ONLY with the exact word.'
      attachments:
      - media_content_id: media-source://media_source/local/last_snapshot_garage.jpg
        media_content_type: image/jpeg
    response_variable: triage_response
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ triage_response is defined and triage_response.data is
          defined and triage_response.data | lower | trim != ''passive'' }}'
      sequence:
      - alias: Initial fast notification
        continue_on_error: true
        action: notify.mobile_app_pixel_8_pro
        data:
          title: 'Garage: {{ triage_response.data | title }} Motion'
          message: Recording video for deep analysis...
          data:
            notification_icon: mdi:cctv
            image: /local/tmp/last_snapshot_garage.jpg
            persistent: true
            color: red
            channel: Cameras
            tag: garage_motion
            clickAction: /dashboard-cast/garage
            actions:
            - action: URI
              title: View Live Stream
              uri: /dashboard-cast/garage
      - alias: Fire TV Snapshot Overlay
        continue_on_error: true
        action: notify.android_tv_fire_tv
        data:
          title: 'Garage: {{ triage_response.data | title }}'
          message: Motion Detected. AI Analyzing...
          data:
            duration: 12
            position: top-right
            fontsize: large
            transparency: 25%
            color: grey
            interrupt: 1
            image:
              url: http://192.168.1.134:8123/local/tmp/last_snapshot_garage.jpg
      - choose:
        - conditions:
          - condition: time
            after: '22:00:00'
            before: 07:00:00
          sequence:
          - continue_on_error: true
            action: media_player.volume_set
            data:
              entity_id: media_player.office_display
              volume_level: 0.3
          - continue_on_error: true
            action: tts.google_say
            data:
              cache: true
              entity_id: media_player.office_display
              message: Motion in the garage
          - continue_on_error: true
            action: google_assistant_sdk.send_text_command
            data:
              command: stream garage camera on office display
        - conditions:
          - condition: time
            after: 07:00:00
            before: '22:00:00'
          sequence:
          - continue_on_error: true
            action: media_player.volume_set
            data:
              entity_id: media_player.tv_speakers
              volume_level: 0.6
          - continue_on_error: true
            action: tts.google_say
            data:
              cache: true
              entity_id: media_player.tv_speakers
              message: Motion in the garage
      - continue_on_error: true
        action: script.turn_on
        target:
          entity_id: script.garage_video_processing
      - delay:
          minutes: 4
      - continue_on_error: true
        action: input_boolean.turn_off
        target:
          entity_id: input_boolean.camera_motion_detected
      - continue_on_error: true
        action: browser_mod.javascript
        data:
          code: history.back()
    default:
    - continue_on_error: true
      action: input_boolean.turn_off
      target:
        entity_id: input_boolean.camera_motion_detected
    - continue_on_error: true
      action: browser_mod.javascript
      data:
        code: history.back()
