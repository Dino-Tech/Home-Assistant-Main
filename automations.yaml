## automations# /config/automations.yaml
#########################################################
## make Sonoffs report on start up
- alias: "Sonoff state on HA start-up"
  hide_entity: true
  initial_state: 'on'
  trigger:
    platform: homeassistant
    event: start
  action:
    - service: mqtt.publish
      data:
        topic: "cmnd/sonoffs/backlog"
        payload: "status 2;power1 ;power2 ;power3 ;power4 ;power5 "
############################################################
##  Darren's alarm
- alias: 'Darrens wake up alarm'
  hide_entity: true
  initial_state: 'on'
  trigger:
    platform: template
    value_template: "{{ states('sensor.time') == (states.input_datetime.time_darrens_alarm.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  action:
    - service: script.darrens_wake_up
##############################################################
##  Donna's alarm
- alias: 'Donnas wake up alarm'
  hide_entity: true
  initial_state: 'on'
  trigger:
    platform: template
    value_template: "{{ states('sensor.time') == (states.input_datetime.time_donnas_alarm.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  condition:
    - condition: state
      entity_id: input_boolean.donnas_work_alarm
      state: 'on'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
  action:
    - service: script.donnas_wake_up
#########################################################
## Sets morning background image
- alias: '[Tablet] Morning Background'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: sun.sun
      from: 'below_horizon'
      to: 'above_horizon'
  action:
    - service: script.morning_screen
## Sets evening Sunset background image
- alias: '[Tablet] Evening Background'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'
  action:
    - service: script.star_screen
#########################################################
- alias: '[Tablet] camera background select'
  hide_entity: true
  initial_state: 'on'
  trigger:
    platform: time_pattern
    seconds: '/45'
  condition:
    - condition: state
      entity_id: input_boolean.auto_cameras
      state: 'on'
  action:
    - service: input_select.select_next
      entity_id: input_select.auto_camera
#########################################################
- alias: '[Auto] camera image select'
  hide_entity: true
  initial_state: 'on'
  trigger:
    platform: time_pattern
    minutes: '/1'
  condition:
    - condition: state
      entity_id: input_boolean.auto_camera_image
      state: 'on'
  action:
    - service: input_select.select_next
      entity_id: input_select.auto_select_camera
#########################################################
- alias: '[Tablet] background select'
  hide_entity: true
  initial_state: 'on'
  trigger:
    platform: time_pattern
    minutes: '/5'
  condition:
    - condition: state
      entity_id: input_boolean.auto_backgroundz
      state: 'on'
  action:
    - service: input_select.select_next
      entity_id: input_select.wallpaper
#########################################################
- alias: '[Mobile] background select'
  hide_entity: true
  initial_state: 'on'
  trigger:
    platform: time_pattern
    minutes: '/1'
  condition:
    - condition: state
      entity_id: input_boolean.auto_backgroundz
      state: 'on'
  action:
    - service: input_select.select_next
      entity_id: input_select.mobile_wallpaper
#########################################################
- alias: '[Tablet] motion_ON'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.hall_motion, binary_sensor.hallway_motion
      to: 'on'
  condition:
    - condition: state
      entity_id: light.hallway_night_light
      state: 'off'
    - condition: time
      after: '06:30:00'
      before: '23:00:00'
    - condition: state
      entity_id: input_boolean.auto_tablet
      state: 'on'
  action:
    - service: input_select.select_next
      entity_id: input_select.random_views
    - delay: '00:00:01'
    - service: script.wake_tablet
#########################################################
- alias: '[Tablet] motion_OFF_night'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: light.hallway_night_light
      to: 'off'
      for:
        minutes: 4
  condition:
    - condition: time
      after: '21:30:01'
      before: '09:30:00'
    - condition: state
      entity_id: input_boolean.auto_tablet
      state: 'on'
  action:
    - service: script.off_screen ## BLACK SCREEN/ALERT BORDERS
#########################################################
- alias: '[Tablet] motion_OFF_day'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: light.hallway_night_light
      to: 'off'
      for:
        minutes: 4
  condition:
    - condition: time
      after: '09:30:01'
      before: '21:30:00'
    - condition: state
      entity_id: input_boolean.auto_tablet
      state: 'on'
  action:
    - service: script.sleep_tablet ## CLOCK SCREENSAVER
#########################################################
- alias: '[Browser] switch_browser_home'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: input_boolean.browser_home
      to: 'on'
  action:
    - service: script.browser_home
#########################################################
- alias: '[Browser] switch_browser_refresh'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: input_boolean.browser_refresh
      to: 'on'
  action:
    - service: script.browser_refresh
#########################################################
- alias: '[Auto] Reload Lovelace'
  hide_entity: true
  initial_state: 'on'
  trigger:
    platform: time_pattern
    minutes: '/20'
  action:
    - service: script.browser_refresh
#########################################################
- alias: '[Browser] popup_front_door'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.front_motion
      from: 'off'
      to: 'on'
  action:
#    - service: script.front_motion_tv          # for camera stream via chromecast
    - service: script.browser_popup_1
    - service: script.front_notify
    - service: script.front_light
    - delay: '00:02:00'
    - service: media_player.volume_set
      data:
        entity_id: media_player.foyer_speaker
        volume_level: '0.35'
#    - service: media_player.stop               # for camera stream via chromecast
#      entity_id: media_player.living_room_tv   # for camera stream via chromecast
#########################################################
- alias: '[Browser] popup_patio'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.back_motion
      to: 'on'
  action:
    - service: script.browser_popup_6
    - service: script.patio_motion
    - service: script.patio_light
    - delay: '00:02:10'
    - service: media_player.volume_set
      data:
        entity_id: media_player.living_room_google
        volume_level: '0.35'
#########################################################
- alias: '[Browser] popup_driveway'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.driveway_motion
      to: 'on'
  action:
    - service: script.browser_popup_7
    - service: script.driveway_notify
    - service: script.driveway_light
    - delay: '00:02:00'
    - service: media_player.volume_set
      data:
        entity_id: media_player.living_room_google
        volume_level: '0.35'
#########################################################
- alias: '[Browser] popup_garage'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: switch.garage_door, binary_sensor.garage_door, binary_sensor.garage_motion
      to: 'on'
  action:
#    - service: script.garage_motion_tv         # for camera stream via chromecast
    - service: script.browser_popup_3
    - service: script.garage_notify # google TTS
    - delay: '00:02:00'
    - service: media_player.volume_set
      data:
        entity_id: media_player.living_room_google
        volume_level: '0.35'
#    - service: media_player.stop               # for camera stream via chromecast
#      entity_id: media_player.living_room_tv   # for camera stream via chromecast
#########################################################
- alias: '[Browser] popup_entry_hall'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.entry_hall_motion, binary_sensor.side_door_k, binary_sensor.garage_entry_door_k
      from: 'off'
      to: 'on'
  action:
    - service: script.browser_popup_2
#########################################################
- alias: '[Browser] popup_den'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.hall_motion, binary_sensor.front_door
      to: 'on'
  action:
    - service: script.browser_popup_4
#########################################################
- alias: '[Browser] popup_kitchen'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.kitchen_motion
      to: 'on'
  action:
    - service: script.browser_popup_5
#########################################################
- alias: '[Browser] test_popup_office'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.office_motion
      to: 'on'
  condition:
    - condition: state
      entity_id: input_boolean.disable_inside_popups
      state: 'off'
  action:
    - service: script.browser_popup_8
#########################################################
- alias: '[Browser] popup_Low Battery'
  initial_state: true
  trigger:
    - platform: numeric_state
      entity_id:
        - sensor.pixel2statusbatt
        - sensor.donna_iphone_battery_level
        - sensor.garage_smoke_battery
        - sensor.laundry_room_battery
        - sensor.laundry_smoke_battery
        - sensor.office_smoke_battery
        - sensor.outside_ht_battery
        - sensor.spare_room_battery
      below: 20
  action:
    - service: script.low_battery_popup
#########################################################
- alias: '[Auto] card background select'
  hide_entity: true
  initial_state: 'on'
  trigger:
    platform: time_pattern
#    minutes: '/01'
    seconds: '/04'
  condition:
    - condition: state
      entity_id: input_boolean.auto_card_backz
      state: 'on'
  action:
    - service: input_select.select_next
      entity_id: input_select.auto_cardz
#######################################################
- alias: '[Notify] Coffee Maker ON'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: switch.coffee_maker
      to: 'on'
  condition:
    - condition: state
      entity_id: input_boolean.cfe_off
      state: 'off'
  action:
    - service: switch.turn_on
      entity_id: switch.coffee_light
    - service: notify.darren
      data:
        title: "New Life Alert"
        message: "Coffee Maker ON!"
#########################################################
## Darren AWAY
- alias: '[Presence] Darren Away'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: person.darren
      to: 'not_home'
  action:
    - service: script.darren_away
#########################################################
## Darren HOME
- alias: '[Presence] Darren Home'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: person.darren
      to: 'home'
  action:
    - service: script.darren_home
###########################################################
## Donna AWAY
- alias: '[Presence] Donna Away'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: group.donna_presence
      to: 'not_home'
      for:
        minutes: 03
  condition:
    - condition: state
      entity_id: input_boolean.donna_home
      state: 'on'
  action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.donna_home
    - service: notify.darren_pixel_2xl_dinopixel2xl
      data_template:
        message: >
          Donna changed from {{ trigger.from_state.state }}
          to {{ trigger.to_state.state }}
###########################################################
## Donna HOME
- alias: '[Presence] Donna Home'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: group.donna_presence
      to: 'home'
  condition:
    - condition: state
      entity_id: input_boolean.donna_home
      state: 'off'
  action:
    - service: input_boolean.turn_on
      entity_id: input_boolean.donna_home
    - service: notify.darren_pixel_2xl_dinopixel2xl
      data_template:
        message: >
          Donna changed from {{ trigger.from_state.state }}
          to {{ trigger.to_state.state }}
###########################################################
## Tristan AWAY/HOME
###########################################################
- alias: '[Presence] Tristan Away'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: group.tristan_presence
      to: 'not_home'
      for:
        minutes: 07
  condition:
    - condition: state
      entity_id: input_boolean.tristan_home
      state: 'on'
  action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.tristan_home
###########################################################
- alias: '[Presence] Tristan Home'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: group.tristan_presence
      to: 'home'
  condition:
    - condition: state
      entity_id: input_boolean.tristan_home
      state: 'off'
  action:
    - service: input_boolean.turn_on
      entity_id: input_boolean.tristan_home
###########################################################
##  Presence Tracker
###########################################################
- alias: '[Notify] People Away Group'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: group.person_group
      to: 'not_home'
  action:
    - service: script.alarm_arm
    - service: script.people_away
    - service: script.off_screen
    - service: script.nest_set_away
###########################################################
- alias: '[Notify] People Home Group'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: group.person_group
      to: 'home' 
  action:
    - service: script.alarm_disarm
    - service: script.people_home
    - service: script.wake_tablet
    - service: script.nest_set_home
###########################################################
# Bedroom Lamp switch OFF-ON
- alias: '[Switch] Bedroom Lamps'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: input_boolean.bedroom_lamps
  action:
    - service_template: "homeassistant.turn_{{- trigger.to_state.state -}}"
      data:
        entity_id: group.bedroom_lamps
##############################################################
- alias: '[TIMER] Fountain'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: time
      at: '20:00'
  action:
    - service: script.fountain_timer
##############################################################
##  Side Door Light on After Sunset
##############################################################
- alias: '[SUNSET] Side Light After'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: sun
      event: 'sunset'
      offset: "00:30:00"
  action:
    - service: script.side_light_timer
##############################################################
##  Turn On Cabinet Lights at 6:35
##############################################################
- alias: '[TIMER] Turn On Cabinet Lights at 6:35'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: time
      at: '06:35'
  condition:
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: input_boolean.disable_interior_auto_lights
      state: 'off'
  action:
    - service: switch.turn_on
      entity_id: switch.cabinet_sw1
    - delay: '00:30:00'
    - service: switch.turn_off
      entity_id: switch.cabinet_sw1
#############################################################
##  Entry Hall Auto Light
#############################################################
- alias: '[Auto Off] Entry Hall Light'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.entry_hall_motion
      from: 'on'
      to: 'off'
      for:
        minutes: 4
  action:
    - service: switch.turn_off
      entity_id: switch.hall_light
#############################################################
- alias: '[Auto On] Entry Hall Light'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.entry_hall_motion
      to: 'on'
  condition:
    - condition: state
      entity_id: switch.hall_light
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_interior_auto_lights
      state: 'off'
  action:
    - service: switch.turn_on
      entity_id: switch.hall_light
#############################################################
#  [Notify] Motion Office Light ON/OFF
#############################################################
- alias: '[Notify] Motion Office'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.office_motion
      from: 'off'
      to: 'on'
  condition:
    - condition: state
      entity_id: input_boolean.darren_home
      state: 'off'
  action:
    - service: script.motion_office
#####################################################
##  Door Auto Lights/Notify
#####################################################
- alias: '[Notify/Light] Back Door'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.back_door_k
      to: 'on'
  action:
    - service: script.back_door_light
    - service: script.back_door_notify
    - delay: '00:02:00'
    - service: media_player.volume_set
      data:
        entity_id: media_player.living_room_google
        volume_level: '0.30'
######################################################
- alias: '[Notify] Side door'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.side_door_k
      to: 'on'
  action:
    - service: script.side_door_open
    - service: script.side_door_voice
    - delay: '00:02:00'
    - service: media_player.volume_set
      data:
        entity_id: media_player.living_room_google
        volume_level: '0.30'
######################################################
- alias: '[Notify/Light] Front door'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.front_door
      to: 'on'
  action:
    - service: script.front_door_notify
    - service: script.front_door_light
    - delay: '00:02:00'
    - service: media_player.volume_set
      data:
        entity_id: media_player.foyer_speaker
        volume_level: '0.30'
######################################################
- alias: '[Notify/Light] Garage Entry door'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.garage_entry_door_k
      to: 'on'
  action:
    - service: script.garage_entry_light
    - service: script.garage_entry_door_open
    - service: script.garage_entry_voice
    - delay: '00:02:00'
    - service: media_player.volume_set
      data:
        entity_id: media_player.living_room_google
        volume_level: '0.30'
#####################################################
- alias: '[Notify] Garage Door'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: switch.garage_door, binary_sensor.garage_door
      to: 'on'
  action:
    - service: script.garage_door_notify # text
#####################################################
- alias: '[Notify] Auto Notifications ON'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: time
      at: '23:00:00'
  action:
    - service: script.notifications_auto_on
######################################################
###          Washer  & Dryer Automations           ###
######################################################
- alias: 'Washer State - Start'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.washer_watts
      above: 5
      for:
        seconds: 4
  condition:
    - condition: template
      value_template: "{{ states.sensor.washer_state.state != 'Washing' }}"
  action:
    - service: mqtt.publish
      data:
        topic: hass/state/washer
        payload: 'Washing'
        retain: 'true'
- alias: 'Washer State - Idle'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.washer_watts
      below: 5
      for:
        minutes: 5
  action:
    - service: mqtt.publish
      data:
        topic: hass/state/washer
        payload: 'Idle'
        retain: 'true'
- alias: 'Washer Finished'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: sensor.washer_state
      from: 'Washing'
      to: 'Idle'
  condition:
    - condition: state
      entity_id: input_boolean.laundry_notify
      state: 'on'
  action:
    - service: media_player.volume_set
      data:
        entity_id: media_player.living_room_google
        volume_level: '0.50'
    - service: tts.google_say
      entity_id: media_player.living_room_google
      data_template:
        message: "Donna or Darren.. Clothes ready..  The washing machine has finished!"
#- alias: 'Dryer State - Door'
#  trigger:
#    platform: numeric_state
#    entity_id: sensor.dryer_watts
#    above: 7
#    below: 20
#    for:
#      seconds: 2
#  action:
#    - service: mqtt.publish
#      data:
#        topic: hass/state/dryer
#        payload: 'Door Open'
#        retain: 'true'
- alias: 'Dryer State - Drying'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.dryer_watts
      above: 50
      for:
        seconds: 2
  action:
    - service: mqtt.publish
      data:
        topic: hass/state/dryer
        payload: 'Drying'
        retain: 'true'
- alias: 'Dryer State - Idle'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.dryer_watts
      below: 6
      for:
        seconds: 2
  action:
    - service: mqtt.publish
      data:
        topic: hass/state/dryer
        payload: 'Idle'
        retain: 'true'
- alias: 'Dryer Finished'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: sensor.dryer_state
      from: 'Drying'
      to: 'Idle'
  condition:
    - condition: state
      entity_id: input_boolean.laundry_notify
      state: 'on'
  action:
    - service: media_player.volume_set
      data:
        entity_id: media_player.living_room_google
        volume_level: '0.50'
    - service: tts.google_say
      entity_id: media_player.living_room_google
      data_template:
        message: "Donna or Darren.. Clothes ready..  The dryer has finished!"
######################################################
- alias: '[Notify] Smoke Detected'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.garage_smoke_detected, binary_sensor.laundry_smoke_detected, binary_sensor.office_smoke_detected
      to: 'on'
  action:
    - service: notify.darren
      data_template:
        message: '{{ trigger.to_state.attributes.friendly_name }} smoke alarm'
      data:
        title: 'SMOKE DETECTED'
    - service: notify.ios_donnas_iphone
      data_template:
        message: '{{ trigger.to_state.attributes.friendly_name }} smoke alarm'
      data:
        title: 'SMOKE DETECTED'
    - service: script.smoke_popup
######################################################
- alias: '[Notify] Water Heater Leak'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.water_heater
      to: 'on'
  action:
    - service: script.water_heater_leak
######################################################
- alias: '[Notify] Washing Machine Leak'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: binary_sensor.washer_leak
      to: 'on'
  action:
    - service: script.washer_leak
#########################################################
#                TEMPLATE SENSOR UPDATE                 #
- alias: 'Update Template Sensors'
  initial_state: true  
  trigger:
      platform: time_pattern
      minutes: '/59'
  action:
    - service: homeassistant.update_entity
      entity_id:
        - sensor.tracker_count
        - sensor.lights_count
        - sensor.binary_sensor_count
        - sensor.switch_count
        - sensor.automation_count
        - sensor.script_count
        - sensor.sensor_count
#########################################################
#                   SENSOR BATTERY LOW                  #
- alias: 'Sensor Low Battery'
  initial_state: true
  trigger:
    - platform: numeric_state
      entity_id:
        - sensor.pixel2statusbatt
        - sensor.donna_s_iphone_battery_level
        - sensor.garage_smoke_battery
        - sensor.laundry_room_battery
        - sensor.laundry_smoke_battery
        - sensor.office_smoke_battery
        - sensor.outside_ht_battery
        - sensor.spare_room_battery
      below: 20
  action:
    service: notify.darren
    data_template:
      title: "Home Assistant Device Battery Low"
      message: " The battery for {{ trigger.to_state.attributes.friendly_name }} is below 20 percent."
#########################################################
#              DARREN'S BATTERY IS LOW                  #
- alias: 'Darren Low Battery'
  initial_state: true
  trigger:
    - platform: numeric_state
      entity_id:
        - sensor.pixel2statusbatt
      below: 20
  action:
    service: notify.darren
    data_template:
      title: "Your Pixel 2 XL Battery Is Low"
      message: " {{ trigger.to_state.attributes.friendly_name }} is below 20 percent."
#########################################################
#              DONNA'S BATTERY IS LOW                  #
- alias: 'Donna Low Battery'
  initial_state: true
  trigger:
    - platform: numeric_state
      entity_id:
        - sensor.donna_s_iphone_battery_level
      below: 20
  action:
    service: notify.ios_donnas_iphone
    data_template:
      title: "Your iPhone Battery Is Low"
      message: " {{ trigger.to_state.attributes.friendly_name }} is below 20 percent."
#########################################################
#                CUSTOM UPDATE AVAIlABLE                #
- alias: 'Custom Update Available'
  initial_state: true
  trigger:
    - platform: numeric_state
      entity_id:
        - sensor.custom_card_tracker
        - sensor.custom_component_tracker
      above: 0
  action:
    service: notify.darren
    data_template:
      title: "HA Custom Card Update Available"
      message: " {{ trigger.to_state.attributes.friendly_name }} says there is a card update available!"
######################################################
#                ALARM   AUTOMATIONS                 #
- alias: '[Alarm] Trigger Alarm Home Mode'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: group.all_windows
      to: 'on'
    - platform: state
      entity_id: binary_sensor.side_door_k, binary_sensor.back_door_k, binary_sensor.front_door # , binary_sensor.garage_door
      to: 'on'
  condition:
    - condition: state
      entity_id: alarm_control_panel.ha_alarm
      state: armed_home
  action:
    - service: script.home_mode_trigger
######################################################
- alias: '[Alarm] Trigger Alarm Away Mode'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: group.all_windows
      to: 'on'
    - platform: state
      entity_id: binary_sensor.living_room_motion, binary_sensor.bedroom_motion, binary_sensor.office_motion
      to: 'on'
    - platform: state
      entity_id: binary_sensor.side_door_k, binary_sensor.back_door_k, binary_sensor.front_door, binary_sensor.garage_entry_door_k
      to: 'on'
  condition:
    - condition: state
      entity_id: alarm_control_panel.ha_alarm
      state: armed_away
  action:
    - service: script.away_mode_trigger
######################################################
#   alarm light flash on
- alias: '[Alarm] Triggered Flash'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: alarm_control_panel.ha_alarm
      to: triggered
  action:
    - service: script.alarm_panel_popup
    - service: script.triggered_flash
######################################################
#   alarm disarm
- alias: '[Alarm] Disarmed Off'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: alarm_control_panel.ha_alarm
      to: disarmed
  action:
    - service: script.alarm_disarm
#####################################################
- alias: '[Alarm] System Arming'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: alarm_control_panel.ha_alarm
      to: pending
  action:
    - service: script.system_arming
#####################################################
- alias: '[Alarm] Away Mode Armed'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: alarm_control_panel.ha_alarm
      to: armed_away
  action:
    - service: script.away_mode_armed
######################################################
- alias: '[Alarm] Home Mode Armed'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: alarm_control_panel.ha_alarm
      to: armed_home
  action:
    - service: script.home_mode_armed
######################################################
- alias: '[Alarm] Remote Disarm'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: input_boolean.alarm_disarm_switch
      to: 'on'
  action:
    - service: script.alarm_disarm
######################################################
- alias: '[Alarm] Remote Arm Away'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: input_boolean.alarm_arm_away_switch
      to: 'on'
  condition:
    - condition: state
      entity_id: alarm_control_panel.ha_alarm
      state: disarmed
    - condition: state
      entity_id: input_boolean.people_home_boolean
      state: 'off'
  action:
    - service: script.alarm_arm
######################################################
- alias: '[Alarm] Remote Arm Home'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: input_boolean.alarm_arm_home_switch
      to: 'on'
  condition:
    - condition: state
      entity_id: alarm_control_panel.ha_alarm
      state: disarmed
  action:
    - service: script.alarm_arm_home
######################################################
- alias: '[Alarm] Auto Night Arm'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: time
      at: '23:59:00'
  condition:
    - condition: state
      entity_id: alarm_control_panel.ha_alarm
      state: disarmed
  action:
    - service: script.alarm_arm_home
#####################################################
- alias: '[Alarm] Disarm in the morning'
  hide_entity: true
  initial_state: 'on'
  trigger:
    - platform: time
      at: '06:30:00'
  condition:
    - condition: state
      entity_id: group.all_devices
      state: home
  action:
    - service: script.alarm_disarm
#####################################################
- alias: 'Weekly Dropbox backup'
  hide_entity: true
  initial_state: 'on'
  trigger:
    platform: time
    at: '2:00:00'
  condition:
    - condition: time
      weekday:
        - mon
  action:
    - service: hassio.snapshot_full
      data_template:
        name: Automated Backup {{ now().strftime('%Y-%m-%d') }}
    - delay: '01:00:00'
    - service: hassio.addon_stdin
      data_template:
        addon: "7be23ff5_dropbox_sync"
        input: {"command":"upload"}
    - delay: '00:05:00'
    - service: notify.darren_pixel_2xl_dinopixel2xl
      data:
        message: "Check DropBox Upload"
##############################################################
- alias: 'snapshots_went_stale'
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.snapshots_stale
    from: 'False'
    to: 'True'
  action:
  - service: notify.darren
    data:
      title: 'Snapshots are Stale'
      message: 'Please visit the Hass.io Google Drive Backup add-on status page for details.'
  - service: script.stale_snapshot_popup
##############################################################
## IOS AUTOMATIONS
- alias: '[IOS] Camera Motion Front'
  initial_state: true
  trigger:
    platform: state
    entity_id: binary_sensor.front_motion
    from: 'off'
    to: 'on'
  action:
    service: notify.ios_donnas_iphone
    data:
      title: ALERT
      message: Someone is at the Front Door
      data:
        attachment:
          content-type: jpeg
        push:
          category: camera
        entity_id: camera.front_door
- alias: '[IOS] trigger the alarm'
  initial_state: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: TRIGGER_ALARM
  action:
    service: script.home_mode_trigger
- alias: '[IOS] turn on front lights'
  initial_state: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: FRONT_LIGHTS
  action:
  - service: homeassistant.turn_on
    data:
      entity_id: group.backyard
- alias: '[IOS] turn on backyard lights'
  initial_state: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: BACK_LIGHTS
  action:
  - service: homeassistant.turn_on
    data:
      entity_id: group.backyard
- alias: '[IOS] notification TTS button'
  initial_state: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: TTS_MESSAGE
  action:
  - service: media_player.volume_set
    data:
      entity_id: media_player.foyer_speaker
      volume_level: '0.60'
  - service: tts.google_say
    entity_id: media_player.foyer_speaker
    data_template:
      message: '{{ trigger.event.data["textInput"] }}'
##############################################################
##  Donna's wake up
##############################################################
#- alias: '[TIMER] Turn On Donnas Lamp at 5:50'
#  hide_entity: true
#  initial_state: 'on'
#  trigger:
#    - platform: time
#      at: '05:50'
#  condition:
#    - condition: time
#      weekday:
#        - mon
#        - tue
#        - wed
#        - thu
#        - fri
#    - condition: state
#      entity_id: input_boolean.disable_donnas_lamp_auto
#      state: 'off'
#  action:
#    - service: script.donnas_wake_up
#########################################################
#- alias: '[Notify] Donna Status'
#  hide_entity: true
#  initial_state: 'on'
#  trigger:
#    platform: state
#    entity_id: person.donna
#  action:
#    service: notify.darren_pixel_2xl_dinopixel2xl
#    data_template:
#      message: >
#        Donna person just changed from {{ trigger.from_state.state }}
#        to {{ trigger.to_state.state }}