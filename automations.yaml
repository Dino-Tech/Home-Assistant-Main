- id: '1735793299155456532216'
  alias: Integration Watchdog
  description: This automation watches entities to ensure the integration is functioning;
    if not, it will restart it.
  triggers:
  - trigger: state
    entity_id:
    - camera.driveway_cam_0
    - camera.garage_cam_0
    - camera.den_cam_0
    - camera.patio_cam_0
    - camera.porch_cam_0
    - camera.go2rtc_streams_rambo_cam_0
    to: unavailable
    for:
      minutes: 2
  actions:
  - action: homeassistant.reload_config_entry
    target:
      entity_id: '{{ trigger.entity_id }}'
  mode: single
  initial_state: true
- id: '17055772299155456532'
  mode: single
  alias: Start Voice assistant initiated Timer When Duration Set and notify when completed
  triggers:
  - trigger: numeric_state
    entity_id:
    - input_number.timer_minutes
    - input_number.timer_seconds
    above: 0
  action:
  - delay: 1
  - action: timer.set_duration
    target:
      entity_id: timer.voice_timer
    data_template:
      duration: 00:{{ states('input_number.timer_minutes') | int }}:{{ states('input_number.timer_seconds')
        | int }}
  - delay: 1
  - action: timer.start
    entity_id: timer.voice_timer
  - wait_for_trigger:
      trigger: state
      entity_id: timer.voice_timer
      from: active
      to: idle
  - action: notify.mobile_app_pixel_8_pro
    data_template:
      title: Timer Finished
      message: '{{ state_attr(''timer.voice_timer'', ''duration'') }} timer has finished'
  - delay: 1
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: TTS
      data:
        ttl: 0
        priority: high
        tts_text: The timer has finished
  - action: input_number.set_value
    data:
      value: 0
    target:
      entity_id:
      - input_number.timer_seconds
      - input_number.timer_minutes
- id: '18011577229915545231'
  alias: Turn ON backyard lights when door opened
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.back_door1
    - binary_sensor.backdoor_bt_sensor
    - binary_sensor.back_motion
    to: 'on'
  conditions:
  - condition: state
    entity_id: light.backyard_lights
    state: 'off'
  - condition: or
    conditions:
    - condition: sun
      after: sunset
      after_offset: 00:15:00
    - condition: sun
      before: sunrise
      before_offset: 00:15:00
  actions:
  - action: light.turn_on
    target:
      entity_id: light.backyard_lights
  - delay:
      minutes: 10
  - action: light.turn_off
    target:
      entity_id: light.backyard_lights
  mode: restart
- id: '1705577229915545'
  alias: Reload kiosk when lovelace is updated
  triggers:
  - trigger: event
    event_type: lovelace_updated
  condition:
  - condition: state
    entity_id: input_boolean.kiosk_auto_refresh
    state: 'on'
  action:
  - action: lovelace.reload_resources
  - delay: 6
  - choose:
    - conditions:
      - condition: state
        entity_id: switch.main_kiosk_screen
        state: 'off'
      sequence:
      - action: switch.turn_on
        entity_id: switch.main_kiosk_screen
      - delay: 2
      - action: button.press
        target:
          entity_id: button.main_kiosk_load_start_url
    - conditions:
      - condition: state
        entity_id: switch.main_kiosk_screen
        state: 'on'
      sequence:
      - delay: 2
      - action: button.press
        target:
          entity_id: button.main_kiosk_load_start_url
  - choose:
    - conditions:
      - condition: state
        entity_id: switch.ensuite_kiosk_screen
        state: 'off'
      sequence:
      - action: switch.turn_on
        entity_id: switch.ensuite_kiosk_screen
      - delay: 2
      - action: button.press
        target:
          entity_id: button.ensuite_kiosk_load_start_url
    - conditions:
      - condition: state
        entity_id: switch.ensuite_kiosk_screen
        state: 'on'
      sequence:
      - delay: 2
      - action: button.press
        target:
          entity_id: button.ensuite_kiosk_load_start_url
  mode: single
- id: '17016739887151444'
  alias: Reboot Kiosk
  triggers:
  - trigger: device
    type: turned_off
    device_id: 17f117e87ed2ea44630be8afa72f7334
    entity_id: switch.main_kiosk_screen
    domain: switch
  - trigger: state
    entity_id:
    - light.main_kiosk_screen
    to: 'off'
  conditions:
  - condition: time
    after: 05:00:00
    before: '23:59:01'
  actions:
  - delay:
      minutes: 1
  - action: switch.turn_on
    target:
      entity_id: switch.main_kiosk_screen
  - delay:
      seconds: 3
  - action: light.turn_on
    target:
      entity_id: light.main_kiosk_screen
  - delay:
      seconds: 3
  - action: button.press
    target:
      entity_id: button.main_kiosk_load_start_url
  mode: restart
- id: '1773719935299957'
  alias: '[Notify] HVAC Water Leak'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: binary_sensor.hvac_leak_sensor
    to: 'on'
  action:
  - action: notify.mobile_app_pixel_8_pro
    continue_on_error: true
    data:
      message: TTS
      data:
        tts_text: Air conditioner is leaking!!!
        media_stream: alarm_stream_max
  - action: notify.mobile_app_pixel_5
    continue_on_error: true
    data:
      message: TTS
      data:
        tts_text: Air conditioner is leaking!!!
        media_stream: alarm_stream_max
  - action: notify.notify_all
    continue_on_error: true
    data:
      message: Air conditioner leaking {{ states('sensor.time_12_hour_am_pm') }}
      data:
        notification_icon: mdi:water
        visibility: public
  - action: climate.turn_off
    continue_on_error: true
  - action: script.hvac_water_leak
- id: '17019999999957'
  alias: '[Notify] Water Heater Leak'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: binary_sensor.water_heater_leak_sensor
    to: 'on'
  action:
  - action: notify.mobile_app_pixel_8_pro
    continue_on_error: true
    data:
      message: TTS
      data:
        tts_text: Water heater is leaking!!!
        media_stream: alarm_stream_max
  - action: notify.mobile_app_pixel_5
    continue_on_error: true
    data:
      message: TTS
      data:
        tts_text: Water heater is leaking!!!
        media_stream: alarm_stream_max
  - action: notify.notify_all
    continue_on_error: true
    data:
      message: Water heater leaking {{ states('sensor.time_12_hour_am_pm') }}
      data:
        notification_icon: mdi:water
        visibility: public
  - action: script.water_heater_leak
- id: notify_washing_machine_leak
  alias: '[Notify] Washing Machine Leaking'
  description: Turns off washer and sends critical alert when leak is detected.
  triggers:
  - entity_id: binary_sensor.washer_leak_sensor
    to: 'on'
    trigger: state
  actions:
  - entity_id: switch.washer_plug_zb
    action: homeassistant.turn_off
  - entity_id: media_player.everywhere_3
    data:
      volume_level: 0.8
    action: media_player.volume_set
  - delay: 00:00:02
  - entity_id: media_player.everywhere_3
    data:
      message: Washing machine is Leaking!
    action: tts.google_say
  - delay: 00:00:10
  - entity_id: media_player.everywhere_3
    data:
      message: Washing machine is Leaking!
    action: tts.google_say
  - delay: 00:00:10
  - data:
      entity_id: media_player.everywhere_3
      volume_level: 0.3
    action: media_player.volume_set
  initial_state: true
- id: '1754999377123967'
  alias: '[Notify] Garage Fridge OFF'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: switch.kitchen_fridge
    to: 'off'
    for:
      minutes: 2
  action:
  - action: notify.mobile_app_pixel_8_pro
    data_template:
      message: 'Garage fridge turned off at ''{{ now().strftime(''%I:%M %p'') }}'' '
  - delay: 00:15:00
  - action: homeassistant.turn_on
    entity_id: switch.kitchen_fridge
  - action: notify.mobile_app_pixel_8_pro
    data_template:
      message: 'Garage fridge turned back on at ''{{ now().strftime(''%I:%M %p'')
        }}'' '
- id: '421345566532245565054'
  alias: '[Motion] Nightlights and KIOSK'
  triggers:
  - trigger: state
    entity_id: binary_sensor.den_night_light_motion
    to: 'on'
  action:
  - choose:
    - conditions:
      - condition: time
        after: '23:00:01'
        before: 05:30:00
      sequence:
      - action: light.turn_on
        data_template:
          hs_color:
          - '{{ range(360)|random }}'
          - '{{ range(80,101)|random }}'
          brightness_pct: 30
        target:
          entity_id: light.den_night_lights_zb
    - conditions:
      - condition: time
        after: 05:30:01
        before: '23:00:00'
      - condition: state
        entity_id: input_boolean.camera_motion_detected
        state: 'off'
      sequence:
      - action: light.turn_on
        data_template:
          hs_color:
          - '{{ range(360)|random }}'
          - '{{ range(80,101)|random }}'
          brightness_pct: 100
        target:
          entity_id: light.den_night_lights_zb
      - action: switch.turn_on
        data:
          entity_id: switch.main_kiosk_screen
      - action: light.turn_on
        data:
          entity_id: light.main_kiosk_screen
      - action: browser_mod.navigate
        data:
          path: /lovelace/newtab
          browser_id:
          - 22de4b5bc46885f8fafdf89c6db80a28
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.den_night_light_motion
      to: 'off'
      for:
        seconds: 90
  - action: light.turn_off
    entity_id: light.den_night_lights_zb
  - choose:
    - conditions:
      - condition: time
        after: 05:30:01
        before: '23:00:00'
      sequence:
      - action: browser_mod.navigate
        data:
          path: /lovelace/screen
          browser_id:
          - 22de4b5bc46885f8fafdf89c6db80a28
    - conditions:
      - condition: time
        after: '22:30:01'
        before: 05:30:00
      sequence:
      - delay: 15
      - action: light.turn_off
        data:
          entity_id: light.main_kiosk_screen
  initial_state: true
  mode: restart
  max_exceeded: silent
- id: '17099299999977'
  alias: '[Tablet] Toggle tablet icons color'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: input_boolean.tablet_icons_color
  action:
  - action: homeassistant.turn_{{- trigger.to_state.state -}}
    data:
      entity_id: group.tablet_icons
- id: '17099939999933322'
  alias: '[Motion] Porch Motion Lights after Dark'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: binary_sensor.front_porch_motion
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.front_door
    to: open
  - trigger: device
    device_id: 011d22447a45c26939459e4d099889cb
    domain: nest
    type: camera_person
  condition:
  - condition: or
    conditions:
    - condition: sun
      after: sunset
      after_offset: 45
    - condition: sun
      before: sunrise
      before_offset: 45
  action:
  - action: light.turn_on
    entity_id:
    - light.porch_light_mini
    - light.front_yard_cam_floodlight
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.front_porch_motion
      from: 'on'
      to: 'off'
  - delay: 600
  - action: light.turn_off
    entity_id:
    - light.porch_light_mini
    - light.front_yard_cam_floodlight
  mode: restart
  max_exceeded: silent
- id: '302170975645999164'
  alias: '[Timer] 15 minute HVAC Fan timer'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: input_button.hvac_15_fan_timer
  action:
  - action: climate.set_fan_mode
    data:
      fan_mode: 'on'
    target:
      entity_id: climate.den
  - delay:
      minutes: 15
  - action: climate.set_fan_mode
    data:
      fan_mode: 'off'
    target:
      entity_id: climate.den
- id: '312170975645999164'
  alias: '[Timer] 30 minute HVAC Fan timer'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: input_button.hvac_30_fan_timer
  action:
  - action: climate.set_fan_mode
    data:
      fan_mode: 'on'
    target:
      entity_id: climate.den
  - delay:
      minutes: 30
  - action: climate.set_fan_mode
    data:
      fan_mode: 'off'
    target:
      entity_id: climate.den
- id: '17099999919856349'
  alias: '[Notify] Coffee Maker ON'
  initial_state: true
  triggers:
  - trigger: state
    entity_id: switch.coffee_maker
    to: 'on'
  action:
  - action: homeassistant.turn_on
    entity_id: light.coffee_light
  - action: notify.mobile_app_pixel_8_pro
    data_template:
      title: ⚠️Coffee☕️ Maker ON
      message: ' at {{ states(''sensor.time_12_hour_am_pm'') }}'
- id: '170999999299876354'
  alias: '[TIMER] Fountain'
  triggers:
  - trigger: time
    at: '20:00:00'
  action:
  - action: switch.turn_on
    target:
      entity_id: switch.patio_fountain_plug
  - delay: 600
  - action: switch.turn_off
    target:
      entity_id: switch.patio_fountain_plug
  initial_state: true
- id: '170999999799168'
  alias: '[Motion] Kitchen Motion Lights'
  triggers:
  - trigger: state
    entity_id: binary_sensor.kitchen_bt_motion
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.kitchen_bt_motion_2
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.kitchen_bt_motion_3
    from: 'off'
    to: 'on'
  - type: occupied
    device_id: 11ae90ced5ee1712eecfff81dc93849c
    entity_id: 4cee93a6bdbf5e7c5eadbf7db0533093
    domain: binary_sensor
    trigger: device
  - type: occupied
    device_id: 4375f563aa247e4c2b721de05710a219
    entity_id: 5127d146841319d4f08e18845430f13a
    domain: binary_sensor
    trigger: device
  condition:
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  action:
  - choose:
    - conditions:
      - condition: time
        after: '23:00:01'
        before: 05:30:00
      sequence:
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id:
          - light.under_cabinet_lights
    - conditions:
      - condition: time
        after: 05:30:01
        before: 08:00:00
      sequence:
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id:
          - light.under_cabinet_lights
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 70
    - conditions:
      - condition: time
        after: 08:00:01
        before: '20:00:00'
      sequence:
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id:
          - light.under_cabinet_lights
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 90
    - conditions:
      - condition: time
        after: '20:00:01'
        before: '23:00:00'
      sequence:
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id:
          - light.under_cabinet_lights
      - action: light.turn_on
        continue_on_error: true
        target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 45
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.kitchen_occupancy_sensors
      to: 'off'
      for:
        seconds: 35
  - action: light.turn_off
    continue_on_error: true
    entity_id: light.kitchen_ceiling_lights_3
  - action: light.turn_off
    continue_on_error: true
    entity_id: light.table_light
  - delay: 900
  - action: light.turn_off
    continue_on_error: true
    target:
      entity_id:
      - light.under_cabinet_lights
  mode: restart
  max_exceeded: silent
  initial_state: true
- id: '1701618177497534'
  alias: '[Motion] Entryway Motion Lights'
  description: ''
  triggers:
  - trigger: state
    entity_id: binary_sensor.entryway_motion
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  action:
  - action: light.turn_on
    continue_on_error: true
    target:
      entity_id:
      - light.entryway_ceiling_dimmer
      - light.laundry_room_dimmer
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.entryway_motion
      from: 'on'
      to: 'off'
  - delay: 30
  - action: light.turn_off
    continue_on_error: true
    target:
      entity_id:
      - light.entryway_ceiling_dimmer
      - light.laundry_room_dimmer
  mode: restart
  max_exceeded: silent
  initial_state: true
- id: '179161817217497534'
  alias: '[Motion] Foyer Motion Lights'
  description: ''
  triggers:
  - trigger: state
    entity_id: binary_sensor.foyer_motion_sensors
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  action:
  - action: light.turn_on
    entity_id: light.foyer_lights
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.foyer_motion_sensors
      from: 'on'
      to: 'off'
  - delay: 90
  - action: light.turn_off
    entity_id: light.foyer_lights
  mode: restart
  max_exceeded: silent
- id: '17016185774975347'
  alias: '[Notify] Auto Notifications ON'
  triggers:
  - trigger: time
    at: '23:00:00'
  action:
  - action: input_boolean.turn_on
    entity_id:
    - input_boolean.camera_snapshots
    - input_boolean.patio_garage_alerts
    - input_boolean.door_announcements
    - input_boolean.disable_laundry_notifications
  - action: input_boolean.turn_off
    entity_id:
    - input_boolean.motion_lights
    - input_boolean.disable_popups
    - input_boolean.auto_tablet
    - input_boolean.auto_backgroundz
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: "⚠️️Notifications\U0001F4E2 turned ON"
  initial_state: true
  mode: single
- id: '17016161677497534'
  alias: '[Alarmo] Auto Night Arm'
  triggers:
  - trigger: time
    at: '23:56:00'
  conditions:
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: disarmed
  actions:
  - choose:
    - conditions:
      - condition: time
        weekday:
        - fri
        - sat
      sequence:
      - action: notify.mobile_app_pixel_8_pro
        continue_on_error: true
        data:
          message: TTS
          data:
            ttl: 0
            priority: high
            tts_text: The alarm will be activated in three minutes.
      - delay: 180
      - target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
        action: alarm_control_panel.alarm_arm_home
    - conditions:
      - condition: time
        weekday:
        - sun
        - mon
        - tue
        - wed
        - thu
      sequence:
      - delay: 180
      - target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
        action: alarm_control_panel.alarm_arm_home
  initial_state: true
- id: '17071774947534873644'
  alias: '[Alarmo] Someone''s awake run Morning script & Disarm alarm'
  triggers:
  - trigger: state
    entity_id: input_boolean.darren_is_awake
    to: 'on'
  - trigger: state
    entity_id: input_boolean.donna_is_awake
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.morning_triggered_today
    state: 'off'
  - condition: time
    after: 06:00:00
    before: '11:00:00'
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: device
        device_id: 796b669c1f2c31677ae6e0a838928d34
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: is_armed_home
      - condition: device
        device_id: 796b669c1f2c31677ae6e0a838928d34
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: is_armed_night
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.den_main_motion1
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id:
      - binary_sensor.kitchen_motion_sensors
      from: 'off'
      to: 'on'
  - action: script.morning
  mode: single
  initial_state: true
- id: '17016181157497534'
  alias: Notify us when the garage door opens and no one home
  triggers:
  - trigger: state
    entity_id: group.person_group
    to: not_home
    for:
      minutes: 2
  condition:
  - condition: state
    entity_id: cover.garage_door
    state: open
  action:
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: TTS
      data:
        ttl: 0
        priority: high
        tts_text: The garage is open.
  - delay: 5
  - action: notify.notify_all
    data:
      message: The garage is open and no one is home!!!
      data:
        color: red
        actions:
        - action: close_garage
          title: Close Garage Door
      title: GARAGE IS OPEN
- id: '17016181274497534'
  alias: Close the garage when notification action is tapped
  trigger:
    trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: close_garage
  action:
    action: cover.close_cover
    entity_id: cover.garage_door
- id: '17016181237497534'
  alias: Notify when desk light goes off
  triggers:
  - trigger: state
    entity_id:
    - light.desk_light
    to: 'off'
  condition:
  - condition: state
    entity_id: person.darren
    state: not_home
  action:
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: Desk light off
      data:
        color: red
        actions:
        - action: turn_on
          title: Turn light on
- id: '17016181474697534'
  alias: Turn desk light on when notification action is tapped
  trigger:
    trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: turn_on
  action:
    action: light.turn_on
    entity_id: light.desk_light
- id: '17016181374977534434343'
  alias: Notify when AC unit goes off
  triggers:
  - trigger: state
    entity_id:
    - climate.den
    to: 'off'
    for:
      minutes: 1
  action:
  - action: notify.notify_all
    data:
      message: A/C Unit is off
      data:
        color: red
        actions:
        - action: turn_on_ac
          title: Turn AC on
- id: '17016181474947534545454'
  alias: Turn AC unit on when notification action is tapped
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: turn_on_ac
  action:
  - delay: 00:05:00
  - action: homeassistant.turn_on
    entity_id: climate.den
- id: '17016499927893058'
  alias: Update notifications
  use_blueprint:
    path: mdegat01/update_notifications.yaml
    input:
      reminder_hours: '3'
      update_entities:
      - update.docker_wyze_bridge_update
      - update.home_assistant_core_update
      - update.home_assistant_google_drive_backup_update
      - update.home_assistant_operating_system_update
      - update.home_assistant_supervisor_update
      - update.zerotier_one_update
      - update.mariadb_update
      - update.network_ups_tools_update
      - update.mosquitto_broker_update
      - update.nginx_home_assistant_ssl_proxy_update
      - update.silicon_labs_multiprotocol_update
      - update.studio_code_server_update
      mobile_app_device: 5402f427ac93601eeab00b7fc7d6f6da
      send_to_ha: true
      take_backup: false
      only_before: '23:00:00'
      only_after: 07:00:00
      run_config_check: false
      mobile_app_device_2: fcffc10d5913eb61a8616787b322450e
- id: '17016473051966192'
  alias: Person Detected at Doorbell
  description: ''
  triggers:
  - trigger: device
    device_id: 011d22447a45c26939459e4d099889cb
    domain: nest
    type: camera_person
  actions:
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: Person Detected at Front door
      title: Someone is at Front door
      data:
        image: /api/nest/event_media/{{ trigger.event.data.device_id }}/{{ trigger.event.data.nest_event_id
          }}/thumbnail
  - action: notify.android_tv_fire_tv
    data:
      message: Person Detected at Front door
      title: Someone is at Front door
- id: '17091227643669'
  alias: '[AUTO] Bathroom vent when door opened'
  trigger:
  - type: opened
    trigger: device
    device_id: ddfdaa597a6f3d5253692718365c95a1
    entity_id: 7d7ea576c802654a8876e7ae82d10add
    domain: binary_sensor
  action:
  - action: switch.turn_on
    target:
      entity_id: switch.bathroom_vent
  - delay:
      minutes: 3
  - action: switch.turn_off
    target:
      entity_id: switch.bathroom_vent
  mode: restart
- id: '170112684169772'
  alias: Sports sensor update
  triggers:
  - trigger: time_pattern
    seconds: '59'
  condition:
  - condition: state
    entity_id: input_boolean.sports_updates
    state: 'on'
  action:
  - action: homeassistant.update_entity
    target:
      entity_id:
      - sensor.predators
      - sensor.atlanta_braves
      - sensor.saints
      - sensor.titans
  mode: single
- id: '170163035746544'
  alias: Notify of Camera channel importance
  trigger: []
  action:
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: Motion Detected
      data:
        channel: Cameras
        ledColor: red
- id: '384450173036339632'
  alias: Side Door Camera live view for wall mounted Nest
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.side_motion_sensor
    to: 'on'
  condition: []
  action:
  - action: google_assistant_sdk.send_text_command
    continue_on_error: true
    data:
      command: stream driveway camera on entryway display
- id: '493724371155444526'
  alias: camera motion switch OFF after 3 mins
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.camera_motion_detected
    to: 'on'
  actions:
  - delay:
      minutes: 3
  - action: input_boolean.turn_off
    entity_id: input_boolean.camera_motion_detected
  mode: restart
  max_exceeded: silent
- id: '170203097871969'
  alias: '[Motion] Side Motion Lights after Dark'
  triggers:
  - trigger: state
    entity_id: binary_sensor.side_motion_sensor
    from: 'off'
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: sun
      after: sunset
      after_offset: 45
    - condition: sun
      before: sunrise
      before_offset: 45
  action:
  - action: light.turn_on
    entity_id: light.front_yard_lights
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.side_motion_sensor
      from: 'on'
      to: 'off'
  - delay: 300
  - action: light.turn_off
    entity_id: light.front_yard_lights
  mode: restart
  max_exceeded: silent
- id: '170223138270251'
  alias: '[Motion] Garage Motion Lights'
  triggers:
  - trigger: state
    entity_id: binary_sensor.garage_occupied
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.garage_motion_sensors
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  action:
  - choose:
    - conditions:
      - condition: time
        before: '21:29:59'
        after: 09:00:01
      sequence:
      - action: light.turn_on
        continue_on_error: true
        data:
          brightness_pct: 100
        target:
          entity_id: light.garage_lights
    - conditions:
      - condition: time
        before: 09:00:00
        after: '21:30:00'
      sequence:
      - action: light.turn_on
        continue_on_error: true
        data:
          brightness_pct: 35
        target:
          entity_id: light.garage_lights
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.garage_occupied
      from: 'on'
      to: 'off'
      for:
        minutes: 10
  - action: light.turn_off
    continue_on_error: true
    data:
      entity_id: light.garage_lights
  mode: restart
  max_exceeded: silent
- id: '170233166895065'
  alias: Darren's Alarm Pixel 8 pro next alarm
  triggers:
  - trigger: template
    value_template: '{{ states(''sensor.date_time'') == (as_timestamp(states.sensor.pixel_8_pro_next_alarm.state,
      default=0) |int -1)| timestamp_custom(''%Y-%m-%d, %H:%M'', True) }}'
  conditions:
  - condition: state
    entity_id: input_boolean.darren_s_alarm_triggered_today
    state: 'off'
  - condition: state
    entity_id: person.darren
    state: home
  actions:
  - action: script.darrens_wake_up
  mode: single
- id: '1703172027074'
  alias: Donna's Alarm Pixel 5 next alarm
  triggers:
  - trigger: template
    value_template: '{{ states(''sensor.date_time'') == (as_timestamp(states.sensor.pixel_5_next_alarm.state,
      default=0) |int -1)| timestamp_custom(''%Y-%m-%d, %H:%M'', True) }}'
  conditions:
  - condition: state
    entity_id: input_boolean.donna_s_alarm_triggered_today
    state: 'off'
  - condition: state
    entity_id: person.donna
    state: home
  actions:
  - action: script.donnas_wake_up
  mode: single
- id: '170243184400922'
  alias: '[Motion] Guest Motion Lights'
  triggers:
  - trigger: state
    entity_id: binary_sensor.guest_room_motion
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  action:
  - action: light.turn_on
    entity_id: light.night_light_6, light.guest_night_lights
  mode: single
  max_exceeded: silent
- id: '17025318794468582'
  alias: '[Motion] Someone''s at the Table'
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.kitchen_table_motion_sensors
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  action:
  - action: light.turn_on
    target:
      device_id: 760cfce120cdf3eedbaa7f35d36aa2db
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.kitchen_table_motion_sensors
      from: 'on'
      to: 'off'
  - delay:
      minutes: 15
  - action: light.turn_off
    target:
      device_id: 760cfce120cdf3eedbaa7f35d36aa2db
  mode: restart
  max_exceeded: silent
- id: '19317603288153054'
  alias: Patio LEDs ON at sunset
  mode: single
  triggers:
  - trigger: sun
    event: sunset
    offset: +00:20:00
  actions:
  - type: turn_on
    device_id: ea11a241127e97442fb1c99327e49b59
    entity_id: 914303f3da00efeb0ba5e45707be8974
    domain: switch
- id: '19936353603288153054'
  alias: Patio LEDs ON when Donna is awake
  mode: single
  triggers:
  - trigger: state
    entity_id: binary_sensor.donna_is_awake
    to: 'on'
  condition:
  - condition: sun
    before: sunrise
    before_offset: 45
  actions:
  - type: turn_on
    device_id: ea11a241127e97442fb1c99327e49b59
    entity_id: 914303f3da00efeb0ba5e45707be8974
    domain: switch
  - wait_for_trigger:
    - trigger: state
      entity_id: person.donna
      to: not_home
  - type: turn_off
    device_id: ea11a241127e97442fb1c99327e49b59
    entity_id: 914303f3da00efeb0ba5e45707be8974
    domain: switch
- id: '170343250676301455712'
  alias: Donna is awake
  mode: restart
  triggers:
  - trigger: state
    entity_id:
    - light.bedroom_lights
    to: 'on'
  condition:
  - condition: time
    before: '11:00:00'
    after: 05:00:00
  action:
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.bedroom_door
      to: 'on'
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.donna_is_awake
- id: '17034325444301455712'
  alias: Darren is awake
  mode: single
  triggers:
  - trigger: state
    entity_id:
    - light.office_lights
    to: 'on'
  condition:
  - condition: time
    before: '11:00:00'
    after: 05:00:00
  action:
  - wait_for_trigger:
    - trigger: state
      entity_id: binary_sensor.office_motion_sensors
      to: 'on'
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.darren_is_awake
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.naptime
  - action: switch.turn_on
    target:
      entity_id: switch.ha2_office_monitor
  - action: media_player.volume_set
    continue_on_error: true
    data:
      entity_id: media_player.office_display
      volume_level: 0.4
  - action: notify.mobile_app_pixel_8_pro
    data:
      message: command_broadcast_intent
      data:
        intent_package_name: com.urbandroid.sleep
        intent_action: com.urbandroid.sleep.alarmclock.STOP_SLEEP_TRACK
        ttl: 0
        priority: high
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.door_announcements
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.radar_updates
  - action: switch.turn_on
    target:
      entity_id: switch.keurig_coffee_maker
- id: '1703432544430144455712'
  alias: Everyone is awake
  mode: single
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.everyone_awake
    to: 'on'
  action:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.everyone_is_awake
  - action: media_player.volume_set
    target:
      entity_id: media_player.living_room_google
    data:
      volume_level: 0.45
- id: '170883399227153856993332311'
  alias: Romance Time
  description: ''
  mode: single
  triggers:
  - trigger: device
    device_id: b91c3dd0f0e777342b0b6792efcb8dff
    domain: bthome
    type: button
    subtype: double_press
  - trigger: state
    entity_id:
    - input_boolean.romance_time
    to: 'on'
  - trigger: state
    entity_id:
    - input_boolean.romance_time_2
    to: 'on'
  action:
  - action: light.turn_off
    target:
      entity_id: light.bedroom_lights
  - action: light.turn_on
    target:
      entity_id: light.nightstand_lamps
    data:
      color_name: red
      brightness_pct: 4
  - action: media_player.play_media
    target:
      entity_id: media_player.bedroom_stereo
    data:
      media_content_id: spotify://track/1gyHbU6CPUp1OkdoElP3Fo
      media_content_type: music
    metadata:
      title: Passionista - Tease Her Until She Explodes
      thumbnail: https://i.scdn.co/image/ab67616d0000b27327ede73f025d18dd8a083b37
      media_class: track
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: music_assistant
        media_content_id: playlists
      - media_content_type: music
        media_content_id: library://playlist/15
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.romance_time
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.romance_time_2
- id: '1938466447855442387'
  alias: Office Occupancy Lights
  triggers:
  - trigger: state
    entity_id: binary_sensor.office_motion_sensors
    from: 'off'
    to: 'on'
  - type: occupied
    device_id: 66bf747d7602dd0c9f8320299e66f1df
    entity_id: 67cb3789db2356f8ed82959441d19e4e
    domain: binary_sensor
    trigger: device
  condition:
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  - condition: state
    entity_id: input_boolean.naptime
    state: 'off'
  action:
  - choose:
    - conditions:
      - condition: time
        before: '20:29:59'
        after: 09:00:01
      - condition: state
        entity_id: light.office_lights
        state: 'off'
      sequence:
      - action: light.turn_on
        data:
          brightness_pct: 30
        target:
          entity_id: light.office_lights
    - conditions:
      - condition: time
        before: '23:59:00'
        after: '20:30:00'
      - condition: state
        entity_id: light.office_lights
        state: 'off'
      sequence:
      - action: light.turn_on
        data:
          brightness_pct: 5
        target:
          entity_id: light.office_lights
    - conditions:
      - condition: time
        before: 09:00:00
        after: '23:59:01'
      sequence:
      - delay: 300
  - wait_for_trigger:
    - type: not_occupied
      device_id: 66bf747d7602dd0c9f8320299e66f1df
      entity_id: 67cb3789db2356f8ed82959441d19e4e
      domain: binary_sensor
      trigger: device
    timeout: 00:30:00
    continue_on_timeout: true
  - action: light.turn_off
    entity_id: light.office_lights
  mode: restart
  max_exceeded: silent
- id: '202946321485676354'
  alias: '[TIMER] Toothbrush Charger'
  triggers:
  - trigger: time
    at: 02:30:00
  action:
  - action: switch.turn_on
    target:
      entity_id: switch.bathroom_night_light_plug
  - delay:
      minutes: 20
  - action: switch.turn_off
    target:
      entity_id: switch.bathroom_night_light_plug
  initial_state: true
- id: '204446321485676354'
  alias: Sleep track announce
  description: ''
  mode: single
  use_blueprint:
    path: IATkachenko/full.yaml
    input:
      device: 11f7d4c43d0425242be095e2da738148
      person: person.darren
      sleep_tracking_started:
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: sleep tracking started
        target:
          device_id: c9ec3cc293f9997730f69821b949bae1
      sleep_tracking_stopped:
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: sleep tracking stopped, awake now
        target:
          entity_id: assist_satellite.home_assistant_voice_095e78_assist_satellite
- id: nws_persistent_notifications
  alias: NWS - Persistent Notifications
  triggers:
  - trigger: state
    entity_id: sensor.nws_alerts_alerts
  conditions:
  - condition: numeric_state
    entity_id: sensor.nws_alerts_alerts
    above: 0
  actions:
  - repeat:
      sequence:
      - action: script.nws_alerts_persistent_notification
        data:
          notification_id: NWS_{{ repeat.item.ID }}
          title: 'NWS Alert: {{ repeat.item.Event }}'
          message: '{{ repeat.item.Description }}'
      - delay:
          seconds: 5
      for_each: '{{ trigger.to_state.attributes.Alerts | reject(''in'', trigger.from_state.attributes.Alerts)
        | sort(attribute=''ID'') | list() }}'
  mode: queued
  initial_state: true
  max: 10
- alias: NWS - TTS Announcements
  id: nws_tts_announcements
  description: ''
  triggers:
  - trigger: state
    entity_id: sensor.nws_alerts_alerts
  condition:
  - condition: numeric_state
    entity_id: sensor.nws_alerts_alerts
    above: 0
  action:
  - repeat:
      sequence:
      - variables:
          alert: '{{ repeat.item }}'
      - if:
        - condition: template
          value_template: '{{ (''Tornado Warning'' in alert.Event) and (alert.Type
            == ''Alert'') }}'
        then:
        - action: script.turn_on
          entity_id: script.nws_alerts_announce_tornado_warning
        - delay:
            minutes: 1
      for_each: '{{ trigger.to_state.attributes.Alerts | reject(''in'', trigger.from_state.attributes.Alerts)
        | list() | sort(attribute=''ID'') }}'
  - repeat:
      sequence:
      - variables:
          alert: '{{ repeat.item }}'
      - if:
        - condition: template
          value_template: '{{ (''Hurricane Warning'' in alert.Event) and (alert.Type
            == ''Alert'') }}'
        then:
        - action: script.turn_on
          entity_id: script.nws_alerts_announce_hurricane_warning
        - delay:
            minutes: 1
      for_each: '{{ trigger.to_state.attributes.Alerts | reject(''in'', trigger.from_state.attributes.Alerts)
        | list() | sort(attribute=''ID'') }}'
  - repeat:
      sequence:
      - variables:
          alert: '{{ repeat.item }}'
      - if:
        - condition: template
          value_template: '{{ (''Severe Thunderstorm Warning'' in alert.Event) and
            (alert.Type == ''Alert'') }}'
        then:
        - action: script.turn_on
          entity_id: script.nws_alerts_announce_thunderstorm_warning
        - delay:
            minutes: 1
      for_each: '{{ trigger.to_state.attributes.Alerts | reject(''in'', trigger.from_state.attributes.Alerts)
        | list() | sort(attribute=''ID'') }}'
  mode: queued
  initial_state: true
  max: 10
- id: '17591923683508746'
  alias: Unavailable Entities Conditional
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.unavailable_monitored_entities
  - trigger: template
    value_template: '{{ states(''sensor.date_time'') == (as_timestamp(states.sensor.pixel_8_pro_next_alarm.state)
      |int -1)| timestamp_custom(''%Y-%m-%d, %H:%M'', True) }} '
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.unavailable_monitored_entities
        above: 1
      sequence:
      - action: notify.mobile_app_pixel_8_pro
        data:
          title: ⚠️Unavailable Entities Detected
          message: '{{states.sensor.unavailable_monitored_entities.attributes.unavailable}}
            are unresponsive.'
          data:
            color: '#2DF56D'
            timeout: 3600
            channel: alert
            group: alert
            sticky: true
            importance: high
            notification_icon: mdi:alert
    - conditions:
      - condition: numeric_state
        entity_id: sensor.unavailable_monitored_entities
        above: 0
      sequence:
      - action: notify.mobile_app_pixel_8_pro
        data:
          title: ⚠️Unavailable Entity Detected
          message: '{{states.sensor.unavailable_monitored_entities.attributes.unavailable}}
            is unresponsive.'
          data:
            color: '#2DF56D'
            timeout: 3600
            channel: alert
            group: alert
            sticky: true
            importance: high
            notification_icon: mdi:alert
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.unavailable_monitored_entities'') | int(0)
          == 0 }}'
      sequence:
      - action: notify.mobile_app_pixel_8_pro
        data:
          title: ✅ All Entities Responding
          message: All monitored entities are responding.
          data:
            color: '#2DF56D'
            channel: alert
            group: alert
            sticky: true
            importance: high
            notification_icon: mdi:check-circle-outline
  initial_state: true
  mode: single
- id: '1759252390526'
  alias: Garage lights toggle
  description: toggle garage lights from inside switch
  triggers:
  - trigger: state
    entity_id: light.garage_lights_inside_switch_2
    to: 'on'
  conditions: []
  actions:
  - action: light.toggle
    target:
      entity_id: light.garage_lights
  - delay:
      milliseconds: 400
  - action: light.turn_off
    target:
      entity_id: light.garage_lights_inside_switch_2
  mode: single
- id: '1759522343255'
  alias: Ask to turn off Kitchen lights
  description: ''
  triggers:
  - device_id: 9f8903e6cdbcbc55cc414977469add59
    domain: media_player
    entity_id: 050c24fca8fc92011ebaf0f8b1503941
    type: turned_on
    trigger: device
  - type: turned_on
    device_id: bc73bb14e38e8396900015b6b0d86506
    entity_id: b095ef8167ec83b5d78ca9612c91671b
    domain: light
    trigger: device
  conditions: []
  actions:
  - action: script.ask_a_yes_no_question_turn_off_kitchen_lights
    data:
      preannounce: true
      voice_assistant: assist_satellite.home_assistant_voice_09c5e8_assist_satellite
  mode: single
- id: update_previous_unavailable_entity_helpers
  alias: Update Previous Unavailable Entity Helpers
  description: ''
  triggers:
  - entity_id: sensor.unavailable_monitored_entities
    trigger: state
  actions:
  - target:
      entity_id: input_text.previous_unavailable_count
    data:
      value: '{{ trigger.from_state.state }}'
    action: input_text.set_value
  - target:
      entity_id: input_text.previous_unavailable_list
    data:
      value: '{{ trigger.from_state.attributes.unavailable }}'
    action: input_text.set_value
- id: '1759810465021'
  alias: NWS - Mobile FLOOD notifications II
  description: ''
  triggers:
  - trigger: state
    entity_id: sensor.nws_alerts_alerts
  conditions:
  - condition: numeric_state
    entity_id: sensor.nws_alerts_alerts
    above: 0
  actions:
  - if:
    - condition: template
      value_template: '{{ "Flood Warning" in state_attr(''sensor.nws_alerts_alerts'',
        ''alerts'') | map(attribute=''event'') }}'
    then:
    - action: notify.mobile_app_pixel_8_pro
      data:
        title: ⚠️ Flood Warning Issued
        message: A Flood Warning has been issued for your area.
    - action: notify.mobile_app_pixel_8_pro
      data:
        message: TTS
        data:
          ttl: 0
          priority: high
          tts_text: attention!,,, a flood warning issued from the national weather
            service
  mode: single
- id: '1759876178314'
  alias: NWS - Mobile notifications III
  description: ''
  triggers:
  - entity_id: sensor.nws_alerts_alerts
    trigger: state
  conditions:
  - condition: numeric_state
    entity_id: sensor.nws_alerts_alerts
    above: 0
  actions:
  - repeat:
      for_each: '{{ trigger.to_state.attributes.Alerts | reject(''in'', trigger.from_state.attributes.Alerts)
        | sort(attribute=''ID'') | list() }}'
      sequence:
      - data:
          title: '⚠️Alert⚠️: {{ repeat.item.Event }}'
          message: '{{ repeat.item.Description }}'
          data:
            tag: NWS_{{ repeat.item.ID }}
            channel: alert
            group: alert
            sticky: true
            importance: high
            notification_icon: mdi:alert
            ttl: 0
            priority: high
            tts_text: attention!,,, {{ repeat.item.Event }} from the national weather
              service
        action: notify.mobile_app_pixel_8_pro
      - delay:
          seconds: 4
  mode: queued
  max: 10
- id: '1760065616426'
  alias: Zone Notification Donna's Work
  description: ''
  use_blueprint:
    path: homeassistant/notify_leaving_zone.yaml
    input:
      person_entity: person.donna
      zone_entity: zone.donna_s_work
      notify_device: 5402f427ac93601eeab00b7fc7d6f6da
- id: '1760066028618'
  alias: AI Event Summary (v1.4.3) III
  description: ''
  use_blueprint:
    path: valentinfrlch/event_summary.yaml
    input:
      camera_entities:
      - camera.driveway_cam_0
      - camera.porch_cam_0
      - camera.garage_cam_0
      - camera.patio_cam_0
      motion_sensors:
      - binary_sensor.side_motion_sensor
      - binary_sensor.front_motion
      - binary_sensor.garage_motion_sensors
      - binary_sensor.back_motion
      remember: true
      provider: 01JZ8Q8C7HDXYKWP5JF8M4ECFX
      notify_device:
      - 5402f427ac93601eeab00b7fc7d6f6da
      notification_channel: alarm_stream
      tts_notification: true
      tts_volume: alarm_stream_max
      model: gpt-4o-mini
      file_path: /config/www/tmp/{{ camera_file_path }}/last_snapshot.jpg
      use_memory: true
      run_conditions:
      - condition: state
        entity_id: input_boolean.people_home_boolean
        state: 'off'
      - condition: or
        conditions:
        - condition: time
          after: '23:59:00'
          before: 06:00:00
      max_tokens: 40
- id: '1760117169977'
  alias: NWS Check for Multi Alerts
  description: NWS Check for Multi Alerts
  triggers:
  - trigger: state
    entity_id: sensor.nws_alerts_alerts
  conditions:
  - condition: template
    value_template: '{{ states(''sensor.nws_alerts_alerts'') | int > 0 }}'
  - condition: template
    value_template: '{{ trigger.to_state.state|int > trigger.from_state.state|int
      }}'
  actions:
  - action: tts.home_assistant_cloud
    data:
      entity_id: media_player.office_display
      message: '{{ state_attr(''sensor.nws_alerts_alerts'', ''Description'').split(''
        - '')[0] }}'
  mode: single
- id: switch_den_fan_cycle_dynamic_state
  alias: '[SWITCH] Den Fan cycle (Dynamic with State)'
  description: Cycles den fan using helpers; restores original state on stop.
  triggers:
  - entity_id: input_boolean.den_fan_cycles
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.den_fan_cycles
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: fan.den_fan
            state: 'on'
          sequence:
          - target:
              entity_id: input_text.den_fan_cycle_initial_state
            data:
              value: 'on'
            action: input_text.set_value
        - conditions:
          - condition: state
            entity_id: fan.den_fan
            state: 'off'
          sequence:
          - target:
              entity_id: input_text.den_fan_cycle_initial_state
            data:
              value: 'off'
            action: input_text.set_value
          - entity_id: fan.den_fan
            action: fan.turn_on
      - repeat:
          while:
          - condition: state
            entity_id: input_boolean.den_fan_cycles
            state: 'on'
          sequence:
          - delay:
              seconds: '{{ states(''input_number.den_fan_cycle_on_time'') | int(180)
                }}'
          - entity_id: fan.den_fan
            action: fan.turn_off
          - delay:
              seconds: '{{ states(''input_number.den_fan_cycle_off_time'') | int(90)
                }}'
          - entity_id: fan.den_fan
            action: fan.turn_on
    default:
    - choose:
      - conditions:
        - condition: state
          entity_id: input_text.den_fan_cycle_initial_state
          state: 'on'
        sequence:
        - entity_id: fan.den_fan
          action: fan.turn_on
      - conditions:
        - condition: state
          entity_id: input_text.den_fan_cycle_initial_state
          state: 'off'
        sequence:
        - entity_id: fan.den_fan
          action: fan.turn_off
  mode: restart
- id: '1761438252145'
  alias: '[SWITCH] Office Fan cycle (Dynamic with State)'
  description: Cycles office fan using helpers; restores original state on stop.
  triggers:
  - entity_id: input_boolean.office_fan_cycles
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.office_fan_cycles
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: fan.office_fan
            state: 'on'
          sequence:
          - target:
              entity_id: input_text.office_fan_cycle_initial_state
            data:
              value: 'on'
            action: input_text.set_value
        - conditions:
          - condition: state
            entity_id: fan.office_fan
            state: 'off'
          sequence:
          - target:
              entity_id: input_text.office_fan_cycle_initial_state
            data:
              value: 'off'
            action: input_text.set_value
          - entity_id: fan.office_fan
            action: fan.turn_on
      - repeat:
          while:
          - condition: state
            entity_id: input_boolean.office_fan_cycles
            state: 'on'
          sequence:
          - delay:
              minutes: '{{ states(''input_number.office_fan_cycle_on_time'') | int(600)
                }}'
          - entity_id: fan.office_fan
            action: fan.turn_off
          - delay:
              minutes: '{{ states(''input_number.office_fan_cycle_off_time'') | int(4)
                }}'
          - entity_id: fan.office_fan
            action: fan.turn_on
    default:
    - choose:
      - conditions:
        - condition: state
          entity_id: input_text.office_fan_cycle_initial_state
          state: 'on'
        sequence:
        - entity_id: fan.office_fan
          action: fan.turn_on
      - conditions:
        - condition: state
          entity_id: input_text.office_fan_cycle_initial_state
          state: 'off'
        sequence:
        - entity_id: fan.office_fan
          action: fan.turn_off
  mode: restart
- id: '1761438361573'
  alias: '[SWITCH] Guest Fan cycle (Dynamic with State)'
  description: Cycles guest fan using helpers; restores original state on stop.
  triggers:
  - entity_id: input_boolean.guest_fan_cycles
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.guest_fan_cycles
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: fan.guest_fan
            state: 'on'
          sequence:
          - target:
              entity_id: input_text.guest_fan_cycle_initial_state
            data:
              value: 'on'
            action: input_text.set_value
        - conditions:
          - condition: state
            entity_id: fan.guest_fan
            state: 'off'
          sequence:
          - target:
              entity_id: input_text.guest_fan_cycle_initial_state
            data:
              value: 'off'
            action: input_text.set_value
          - entity_id: fan.guest_fan
            action: fan.turn_on
      - repeat:
          while:
          - condition: state
            entity_id: input_boolean.guest_fan_cycles
            state: 'on'
          sequence:
          - delay:
              minutes: '{{ states(''input_number.guest_fan_cycle_on_time'') | int(600)
                }}'
          - entity_id: fan.guest_fan
            action: fan.turn_off
          - delay:
              minutes: '{{ states(''input_number.guest_fan_cycle_off_time'') | int(5)
                }}'
          - entity_id: fan.guest_fan
            action: fan.turn_on
    default:
    - choose:
      - conditions:
        - condition: state
          entity_id: input_text.guest_fan_cycle_initial_state
          state: 'on'
        sequence:
        - entity_id: fan.guest_fan
          action: fan.turn_on
      - conditions:
        - condition: state
          entity_id: input_text.guest_fan_cycle_initial_state
          state: 'off'
        sequence:
        - entity_id: fan.guest_fan
          action: fan.turn_off
  mode: restart
- id: switch_patio_mister_control
  alias: '[SWITCH] Patio Mister Control (Cycle & Timer)'
  description: Cycles mister for 10s on / 50s off. Auto-off after 10 mins.
  triggers:
  - entity_id: input_boolean.patio_mister_switch
    to: 'on'
    id: turn_on
    trigger: state
  - entity_id: input_boolean.patio_mister_switch
    to: 'off'
    id: turn_off
    trigger: state
  - entity_id: input_boolean.patio_mister_switch
    to: 'on'
    for:
      minutes: 10
    id: timer_expired
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: turn_on
      sequence:
      - entity_id: fan.patio_fan
        action: fan.turn_on
      - repeat:
          while:
          - condition: state
            entity_id: input_boolean.patio_mister_switch
            state: 'on'
          sequence:
          - entity_id: switch.patio_mister_2
            action: switch.turn_on
          - delay:
              seconds: 10
          - entity_id: switch.patio_mister_2
            action: switch.turn_off
          - delay:
              seconds: 50
    - conditions:
      - condition: trigger
        id: timer_expired
      sequence:
      - entity_id: input_boolean.patio_mister_switch
        action: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id: turn_off
      sequence:
      - entity_id: fan.patio_fan
        action: fan.turn_off
      - entity_id: switch.patio_mister_2
        action: switch.turn_off
    default:
    - entity_id: fan.patio_fan
      action: fan.turn_off
    - entity_id: switch.patio_mister_2
      action: switch.turn_off
  mode: restart
- id: washer_state_manager_combined
  alias: Washer State Manager (Combined)
  description: Handles 'Washing', 'Idle', and 'Finished' notifications.
  triggers:
  - entity_id: sensor.washer_plug_zb_power
    above: 4
    for:
      minutes: 4
    id: started
    trigger: numeric_state
  - entity_id: sensor.washer_plug_zb_power
    below: 5
    for:
      minutes: 4
    id: stopped
    trigger: numeric_state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: started
      sequence:
      - if:
        - condition: template
          value_template: '{{ states(''sensor.washer_state'') != ''Washing'' }}'
        then:
        - data:
            topic: hass/state/washer
            payload: Washing
            retain: true
          action: mqtt.publish
    - conditions:
      - condition: trigger
        id: stopped
      sequence:
      - if:
        - condition: template
          value_template: '{{ states(''sensor.washer_state'') == ''Washing'' }}'
        then:
        - data:
            topic: hass/state/washer
            payload: Idle
            retain: true
          action: mqtt.publish
        - if:
          - condition: state
            entity_id: input_boolean.disable_laundry_notifications
            state: 'off'
          then:
          - data:
              entity_id: media_player.tv_speakers
              volume_level: 0.5
            action: media_player.volume_set
          - entity_id: media_player.tv_speakers
            data:
              message: Donna and Darren,,,Clothes ready,,,The washing machine has
                finished!
            action: tts.google_say
          - data:
              message: "Washing\U0001F455\U0001F457\U0001F456Finished {{ states('sensor.time_12_hour_am_pm')
                }}"
            action: notify.pixels_and_den_tv
        else:
        - data:
            topic: hass/state/washer
            payload: Idle
            retain: true
          action: mqtt.publish
- id: dryer_state_manager_combined
  alias: Dryer State Manager (Combined)
  description: Handles 'Drying', 'Idle', and 'Finished' notifications.
  triggers:
  - entity_id: sensor.dryer_energy_power
    above: 50
    for:
      minutes: 4
    id: started
    trigger: numeric_state
  - entity_id: sensor.dryer_energy_power
    below: 6
    for:
      minutes: 1
    id: stopped
    trigger: numeric_state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: started
      sequence:
      - data:
          topic: hass/state/dryer
          payload: Drying
          retain: true
        action: mqtt.publish
    - conditions:
      - condition: trigger
        id: stopped
      sequence:
      - if:
        - condition: template
          value_template: '{{ states(''sensor.dryer_state'') == ''Drying'' }}'
        then:
        - data:
            topic: hass/state/dryer
            payload: Idle
            retain: true
          action: mqtt.publish
        - if:
          - condition: state
            entity_id: input_boolean.disable_laundry_notifications
            state: 'off'
          then:
          - data:
              entity_id: media_player.tv_speakers
              volume_level: 0.5
            action: media_player.volume_set
          - entity_id: media_player.tv_speakers
            data:
              message: Donna and Darren,,,Clothes are ready,,,The dryer has finished!
            action: tts.google_say
          - data:
              message: "Drying\U0001F455\U0001F457\U0001F456Finished {{ states('sensor.time_12_hour_am_pm')
                }}"
            action: notify.pixels_and_den_tv
        else:
        - data:
            topic: hass/state/dryer
            payload: Idle
            retain: true
          action: mqtt.publish
- id: ensuite_motion_light_on_evening
  alias: '[Motion] Ensuite motion light on'
  description: Turns on ensuite lights & kiosk between 5 PM and 10 PM
  triggers:
  - entity_id: binary_sensor.ensuite_motion_sensors
    to: 'on'
    trigger: state
  conditions:
  - condition: time
    before: '22:00:00'
    after: '17:00:00'
  - condition: state
    entity_id: binary_sensor.night
    state: 'on'
  actions:
  - target:
      entity_id: light.jacuzzi_color
    data:
      brightness_pct: 10
    action: light.turn_on
  - target:
      entity_id: light.donnas_light
    action: light.turn_on
  - choose:
    - conditions:
      - condition: state
        entity_id: switch.ensuite_kiosk_screen
        state: 'off'
      sequence:
      - entity_id: switch.ensuite_kiosk_screen
        action: switch.turn_on
      - delay:
          seconds: 2
      - target:
          entity_id: button.ensuite_kiosk_load_start_url
        action: button.press
    - conditions:
      - condition: state
        entity_id: switch.ensuite_kiosk_screen
        state: 'on'
      sequence:
      - delay:
          seconds: 1
      - target:
          entity_id: button.ensuite_kiosk_load_start_url
        action: button.press
  - wait_for_trigger:
    - entity_id: binary_sensor.ensuite_motion_sensors
      from: 'on'
      to: 'off'
      trigger: state
  - delay:
      minutes: 60
  - continue_on_error: true
    target:
      entity_id: light.jacuzzi_color
    action: light.turn_off
  - continue_on_error: true
    entity_id: switch.ensuite_kiosk_screen
    action: switch.turn_off
  mode: restart
  max_exceeded: silent
- id: auto_ensuite_vent_manager_combined
  alias: '[Auto] Ensuite Vent Manager (Combined)'
  description: Manages fan based on humidity or a 15-minute timer.
  triggers:
  - entity_id: sensor.ensuite_humidity_2
    above: 65
    id: humidity_high
    trigger: numeric_state
  - entity_id: sensor.ensuite_humidity_2
    below: 59
    id: humidity_low
    trigger: numeric_state
  - entity_id: fan.ensuite_vent_2
    to: 'on'
    for:
      minutes: 15
    id: timer_expired
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: humidity_high
      - condition: state
        entity_id: light.jacuzzi_color
        state: 'off'
      sequence:
      - target:
          entity_id: fan.ensuite_vent_2
        action: fan.turn_on
    - conditions:
      - condition: trigger
        id: humidity_low
      - condition: state
        entity_id: light.jacuzzi_color
        state: 'off'
      sequence:
      - target:
          entity_id: fan.ensuite_vent_2
        action: fan.turn_off
    - conditions:
      - condition: trigger
        id: timer_expired
      sequence:
      - target:
          entity_id: fan.ensuite_vent_2
        action: fan.turn_off
  mode: single
  max_exceeded: silent
- id: combined_clocks_grandfather_cuckoo
  alias: Audible Clocks (Grandfather & Cuckoo)
  description: Plays the correct clock chime on the hour and half-hour.
  triggers:
  - hours: '*'
    minutes: '0'
    trigger: time_pattern
  - minutes: '30'
    trigger: time_pattern
  conditions:
  - condition: time
    after: 09:29:00
    before: '21:30:00'
  - condition: state
    entity_id: light.tv_ambient_lights
    state: 'off'
  - condition: or
    conditions:
    - condition: state
      entity_id: input_boolean.grandfather_clock
      state: 'on'
    - condition: state
      entity_id: input_boolean.cuckoo_clock
      state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.tv_speakers
        state: 'off'
      sequence:
      - data:
          volume_level: 0
        target:
          entity_id: media_player.tv_speakers
        action: media_player.volume_set
      - target:
          entity_id: media_player.tv_speakers
        action: media_player.turn_on
      - wait_template: '{{ is_state(''media_player.tv_speakers'', ''idle'') }}'
      - data:
          volume_level: 0.4
        target:
          entity_id: media_player.tv_speakers
        action: media_player.volume_set
    - conditions:
      - condition: state
        entity_id: media_player.tv_speakers
        state: idle
      sequence:
      - data:
          volume_level: 0.4
        target:
          entity_id: media_player.tv_speakers
        action: media_player.volume_set
      - delay:
          seconds: 1
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.grandfather_clock
        state: 'on'
      - condition: state
        entity_id: remote.den_tv
        state: 'off'
      sequence:
      - target:
          entity_id: media_player.tv_speakers
        data:
          media:
            media_content_id: "{% if now().minute == 30 %}\n  media-source://media_source/local/gf-hour-30.mp3\n{%
              else %}\n  media-source://media_source/local/gf-hour-{{ now().strftime(\"%I\")
              }}.mp3\n{% endif %}"
            media_content_type: music
            metadata: {}
        action: media_player.play_media
      - if:
        - condition: state
          entity_id: input_boolean.cuckoo_clock
          state: 'on'
        then:
        - target:
            entity_id: input_boolean.cuckoo_clock
          action: input_boolean.turn_off
    - conditions:
      - condition: state
        entity_id: input_boolean.cuckoo_clock
        state: 'on'
      sequence:
      - target:
          entity_id: media_player.tv_speakers
        data:
          media:
            media_content_id: "{% if now().minute == 30 %}\n  media-source://media_source/local/cuckoo-clock-01.wav\n{%
              else %}\n  media-source://media_source/local/cuckoo-clock-{{ now().strftime(\"%I\")
              }}.wav\n{% endif %}"
            media_content_type: music
            metadata: {}
        action: media_player.play_media
  initial_state: true
- id: critical_safety_alerts_detected
  alias: '[Notify] NEST Fire, Smoke, CO, & Heat Detected II'
  description: Handles all smoke, CO, and heat alerts.
  triggers:
  - id: smoke
    entity_id:
    - binary_sensor.nest_protect_hallway_smoke_status
    - binary_sensor.nest_protect_kitchen_smoke_status
    - binary_sensor.nest_protect_garage_smoke_status
    - binary_sensor.laundry_smoke_detected
    - binary_sensor.bedroom_smoke_detected
    to: 'on'
    for: 00:00:03
    trigger: state
  - id: co
    entity_id:
    - binary_sensor.nest_protect_hallway_co_status
    - binary_sensor.nest_protect_kitchen_co_status
    - binary_sensor.nest_protect_garage_co_status
    - binary_sensor.laundry_co_detected
    - binary_sensor.bedroom_carbon_monoxide_detected
    to: 'on'
    for: 00:00:03
    trigger: state
  - id: heat
    entity_id:
    - binary_sensor.nest_protect_hallway_heat_status
    - binary_sensor.nest_protect_kitchen_heat_status
    - binary_sensor.nest_protect_garage_heat_status
    to: 'on'
    for: 00:00:03
    trigger: state
  actions:
  - variables:
      trigger_name: '{{ trigger.to_state.attributes.friendly_name | default(trigger.entity_id)
        }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.id == ''smoke'' }}'
      sequence:
      - variables:
          alert_title: Smoke Alarm
          alert_message: "{{ trigger_name }} smoke detected \U0001F525"
          alert_icon: mdi:smoke-detector-variant-alert
    - conditions:
      - condition: template
        value_template: '{{ trigger.id == ''co'' }}'
      sequence:
      - variables:
          alert_title: Carbon Monoxide Alarm
          alert_message: '{{ trigger_name }} carbon monoxide detected ⚠️'
          alert_icon: mdi:molecule-co
    - conditions:
      - condition: template
        value_template: '{{ trigger.id == ''heat'' }}'
      sequence:
      - variables:
          alert_title: Heat Alarm
          alert_message: "{{ trigger_name }} heat detected \U0001F525"
          alert_icon: mdi:fire-alert
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.id in [''smoke'',''co''] }}'
      sequence:
      - continue_on_error: true
        data:
          service: fire
        action: noonlight.create_alarm
      - data:
          name: Noonlight
          entity_id: '{{ trigger.entity_id }}'
          message: Fire/CO alarm triggered from {{ trigger_name }}
        action: logbook.log
  - continue_on_error: true
    target:
      entity_id: climate.den
    action: climate.turn_off
  - continue_on_error: true
    target:
      entity_id: switch.dryer_plug
    action: switch.turn_off
  - continue_on_error: true
    target:
      entity_id: light.every_light
    data:
      brightness_pct: 100
    action: light.turn_on
  - data:
      title: '{{ alert_title }}'
      message: '{{ alert_message }}'
      data:
        channel: alert
        sticky: true
        importance: high
        notification_icon: '{{ alert_icon }}'
    action: notify.notify_all
  mode: queued
  max: 10
- id: safety_alerts_all_clear
  alias: '[Notify] Fire, Smoke, CO, & Heat All Clear None Detected'
  description: Resets systems and sends notification when all alerts clear.
  triggers:
  - id: clear_smoke
    entity_id:
    - binary_sensor.nest_protect_hallway_smoke_status
    - binary_sensor.nest_protect_kitchen_smoke_status
    - binary_sensor.nest_protect_garage_smoke_status
    - binary_sensor.laundry_smoke_detected
    - binary_sensor.bedroom_smoke_detected
    to: 'off'
    for: 00:00:10
    trigger: state
  - id: clear_co
    entity_id:
    - binary_sensor.nest_protect_hallway_co_status
    - binary_sensor.nest_protect_kitchen_co_status
    - binary_sensor.nest_protect_garage_co_status
    - binary_sensor.laundry_co_detected
    - binary_sensor.bedroom_carbon_monoxide_detected
    to: 'off'
    for: 00:00:10
    trigger: state
  - id: clear_heat
    entity_id:
    - binary_sensor.nest_protect_hallway_heat_status
    - binary_sensor.nest_protect_kitchen_heat_status
    - binary_sensor.nest_protect_garage_heat_status
    to: 'off'
    for: 00:00:10
    trigger: state
  conditions: []
  actions:
  - variables:
      trigger_name: '{{ trigger.to_state.attributes.friendly_name | default(trigger.entity_id)
        }}'
      clear_title: All Clear
      clear_message: '{{ trigger_name }} alarm cleared ✅'
      clear_icon: mdi:check-circle-outline
  - continue_on_error: true
    target:
      entity_id: climate.den
    action: climate.turn_on
  - continue_on_error: true
    target:
      entity_id: switch.dryer_plug
    action: switch.turn_on
  - continue_on_error: true
    target:
      entity_id: light.every_light
    action: light.turn_off
  - data:
      name: Safety System
      entity_id: '{{ trigger.entity_id }}'
      message: All clear received from {{ trigger_name }}
    action: logbook.log
  - data:
      title: '{{ clear_title }}'
      message: '{{ clear_message }}'
      data:
        channel: alert
        importance: high
        notification_icon: '{{ clear_icon }}'
    action: notify.notify_all
  mode: restart
- id: auto_bathroom_vent_manager_combined
  alias: '[Auto] Bathroom Vent Manager (Combined)'
  description: Manages bathroom vent based on humidity or a 15-minute timer.
  triggers:
  - entity_id: sensor.bathroom_humidity_2
    above: 65
    id: humidity_high
    trigger: numeric_state
  - entity_id: sensor.bathroom_humidity_2
    below: 59
    id: humidity_low
    trigger: numeric_state
  - entity_id: switch.bathroom_vent
    to: 'on'
    for:
      minutes: 15
    id: timer_expired
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: humidity_high
      sequence:
      - target:
          entity_id: switch.bathroom_vent
        action: switch.turn_on
    - conditions:
      - condition: trigger
        id: humidity_low
      sequence:
      - target:
          entity_id: switch.bathroom_vent
        action: switch.turn_off
    - conditions:
      - condition: trigger
        id: timer_expired
      sequence:
      - target:
          entity_id: switch.bathroom_vent
        action: switch.turn_off
  mode: single
  max_exceeded: silent
- id: motion_hall_bathroom_lights_revised
  alias: '[Motion] Hall Bathroom Lights II'
  description: ''
  triggers:
  - entity_id: binary_sensor.bathroom_motion_motion
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: time
        before: '22:29:59'
        after: 06:00:01
      sequence:
      - target:
          entity_id: light.bathroom_lights
        action: light.turn_on
    - conditions:
      - condition: time
        before: 06:00:00
        after: '22:30:00'
      sequence:
      - target:
          entity_id: light.bathtub_light
        action: light.turn_on
  - wait_for_trigger:
    - entity_id: binary_sensor.bathroom_motion_motion
      to: 'off'
      trigger: state
  - delay:
      seconds: 80
  - if:
    - condition: state
      entity_id: binary_sensor.bathroom_door_bt
      state: 'on'
    then:
    - target:
        entity_id: light.bathroom_lights
      action: light.turn_off
  mode: restart
  max_exceeded: silent
- id: alarmo_master_control_combined_revised
  alias: '[Alarmo] Master Control'
  description: Handles all Alarmo state changes, triggers, and notifications.
  triggers:
  - entity_id: alarm_control_panel.alarmo
    to: triggered
    id: triggered
    trigger: state
  - entity_id: alarm_control_panel.alarmo
    to: armed_home
    id: armed_home
    trigger: state
  - entity_id: alarm_control_panel.alarmo
    to: armed_away
    id: armed_away
    trigger: state
  - entity_id: alarm_control_panel.alarmo
    to: disarmed
    id: disarmed
    trigger: state
  - entity_id: input_boolean.alarm_arm_home_switch
    to: 'on'
    id: arm_home_switch
    trigger: state
  - entity_id: input_boolean.alarm_arm_away_switch
    to: 'on'
    id: arm_away_switch
    trigger: state
  - entity_id: input_boolean.alarm_disarm_switch
    to: 'on'
    id: disarm_switch
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: triggered
      sequence:
      - variables:
          tts_msg: The alarm has been triggered by {{ dict((states|selectattr('entity_id',
            'in', state_attr('group.monitored_contacts', 'entity_id'))|list)|groupby('state'))['on']|map(attribute='name')|list|join(',
            ') }}
      - continue_on_error: true
        data:
          message: TTS
          target:
          - mobile_app_pixel_8_pro
          - mobile_app_pixel_5
          data:
            ttl: 0
            priority: high
            tts_text: '{{ tts_msg }}'
        action: notify.notify_all
      - continue_on_error: true
        target:
          entity_id: group.alarm_sirens
        action: homeassistant.turn_on
      - continue_on_error: true
        data:
          action: police
        action: noonlight.create_alarm
      - continue_on_error: true
        target:
          entity_id:
          - light.every_light
          - light.outside_lights
        action: light.turn_on
      - continue_on_error: true
        data:
          entity_id: media_player.tv_speakers
          volume_level: 0.9
        action: media_player.volume_set
      - delay:
          seconds: 1
      - data:
          cache: true
          entity_id: media_player.tv_speakers
          message: Alarm triggered! Police has been notified! at {{ states('sensor.time_12_hour_am_pm')
            }}
        action: tts.google_say
    - conditions:
      - condition: trigger
        id: armed_home
      sequence:
      - data:
          message: TTS
          data:
            ttl: 0
            priority: high
            tts_text: Security system activated.
        action: notify.mobile_app_pixel_8_pro
    - conditions:
      - condition: trigger
        id: armed_away
      sequence:
      - data:
          message: TTS
          data:
            ttl: 0
            priority: high
            tts_text: Security system armed. I will notify you of any activity while
              you are out.
        action: notify.mobile_app_pixel_8_pro
      - data:
          entity_id: media_player.tv_speakers
          message: Motion sensors activated!
        action: tts.google_say
    - conditions:
      - condition: trigger
        id: disarmed
      sequence:
      - if:
        - condition: template
          value_template: '{{ trigger.from_state.state == ''triggered'' }}'
        then:
        - continue_on_error: true
          target:
            entity_id:
            - switch.noonlight_switch
            - group.alarm_sirens
          action: homeassistant.turn_off
        - continue_on_error: true
          target:
            entity_id:
            - light.every_light
            - light.outside_lights
          action: light.turn_off
        - data:
            message: Alarm canceled at {{ states('sensor.time_12_hour_am_pm') }}
          action: notify.pixels_and_den_tv
        - delay:
            seconds: 3
        - continue_on_error: true
          target:
            entity_id:
            - light.sofa_lamp
            - light.under_cabinet_lights
          action: light.turn_on
      - if:
        - condition: state
          entity_id: input_boolean.naptime
          state: 'off'
        then:
        - delay:
            seconds: 5
        - data:
            message: TTS
            data:
              ttl: 0
              priority: high
              tts_text: Security system deactivated. Welcome home!
          action: notify.mobile_app_pixel_8_pro
    - conditions:
      - condition: trigger
        id: arm_home_switch
      sequence:
      - target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
        action: alarm_control_panel.alarm_arm_home
      - target:
          entity_id: input_boolean.alarm_arm_home_switch
        action: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id: arm_away_switch
      sequence:
      - target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
        action: alarm_control_panel.alarm_arm_away
      - target:
          entity_id: input_boolean.alarm_arm_away_switch
        action: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id: disarm_switch
      sequence:
      - target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
        action: alarm_control_panel.alarm_disarm
      - target:
          entity_id: input_boolean.alarm_disarm_switch
        action: input_boolean.turn_off
  mode: restart
- id: tv_ambient_lights_sync
  alias: TV Ambient Lights Sync with TV
  description: Turns ambient lights on/off based on TV remote state.
  triggers:
  - entity_id: remote.den_tv
    to:
    - 'on'
    - 'off'
    trigger: state
  actions:
  - target:
      device_id: bc73bb14e38e8396900015b6b0d86506
    action: homeassistant.turn_{{ trigger.to_state.state }}
  mode: single
- id: ups_status_notifications_combined
  alias: UPS Status Notifications
  description: Sends notifications for power off, fully charged, and NUT events.
  triggers:
  - entity_id: sensor.mainups_input_voltage
    below: 10
    id: power_off
    trigger: numeric_state
  - entity_id: sensor.mainups_battery_charge
    above: 99
    id: fully_charged
    trigger: numeric_state
  - event_type: nut.ups_event
    id: nut_event
    trigger: event
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: power_off
      sequence:
      - data:
          title: Smart Home Alert
          message: The Power went OFF at {{ states('sensor.time_12_hour_am_pm') }}
        action: notify.mobile_app_pixel_8_pro
    - conditions:
      - condition: trigger
        id: fully_charged
      - condition: numeric_state
        entity_id: sensor.mainups_input_voltage
        above: 120
      sequence:
      - data:
          title: Smart Home Alert
          message: UPS is online and fully charged at {{ states('sensor.time_12_hour_am_pm')
            }}
        action: notify.mobile_app_pixel_8_pro
    - conditions:
      - condition: trigger
        id: nut_event
      sequence:
      - data:
          title: UPS changed state
          message: '{{ trigger.event.data.notify_msg }}'
        action: notify.mobile_app_pixel_8_pro
  mode: single
- id: door_announcements_combined
  alias: Door Announcements (TTS)
  description: Announces open/close status for Front, Side, Back, and Garage doors.
  triggers:
  - entity_id:
    - binary_sensor.front_door
    - binary_sensor.side_door_bt
    - binary_sensor.back_door1
    - binary_sensor.backdoor_bt_sensor
    - binary_sensor.garage_door_sensor_zb
    to:
    - 'on'
    - 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.door_announcements
    state: 'on'
  - condition: template
    value_template: '{{ trigger.from_state.state != ''unavailable'' and trigger.from_state.state
      != ''unknown'' }}'
  actions:
  - target:
      entity_id: media_player.living_room_google
    data:
      message: '{{ door_name }} {{ door_action }}'
    action: tts.google_say
  - action: notify.android_tv_fire_tv
    data_template:
      data:
        fontsize: large
        position: bottom-right
        duration: 3
        transparency: 25%
        color: grey
        interrupt: 1
      message: "{% if door_entity_id == 'binary_sensor.garage_door_sensor_zb' %}\n
        \ {% if door_action == 'opened' %}\n    {{ door_name }}⚠️opened⚠️ {{ states('sensor.time_12_hour_am_pm')
        }}\n  {% else %}\n    {{ door_name }} closed✅ {{ states('sensor.time_12_hour_am_pm')
        }}\n  {% endif %}\n{% elif door_entity_id == 'binary_sensor.side_door_bt'
        %}\n   ⚠️{{ door_name }}\U0001F6AA{{ door_action }} {{ states('sensor.time_12_hour_am_pm')
        }}\n{% else %}\n   {{ door_name }}\U0001F6AA{{ door_action }} {{ states('sensor.time_12_hour_am_pm')
        }}\n{% endif %}\n"
  mode: queued
  variables:
    door_entity_id: '{{ trigger.entity_id }}'
    door_state: '{{ trigger.to_state.state }}'
    door_action: '{{ ''opened'' if door_state == ''on'' else ''closed'' }}'
    door_name_map:
      binary_sensor.front_door: Front door
      binary_sensor.side_door_bt: Side door
      binary_sensor.back_door1: Back door
      binary_sensor.backdoor_bt_sensor: Back door
      binary_sensor.garage_door_sensor_zb: Garage door
    door_name: '{{ door_name_map.get(door_entity_id, trigger.to_state.attributes.friendly_name
      | default(''Unknown Door'')) }}'
- id: tablet_background_theme_manager
  alias: '[Tablet] Background and Theme Manager'
  description: Sets wallpaper options at specific times and cycles wallpaper/theme
    periodically.
  triggers:
  - at: 04:30:00
    id: morning
    trigger: time
  - at: '10:00:00'
    id: midday
    trigger: time
  - at: '16:00:00'
    id: evening
    trigger: time
  - at: '19:00:00'
    id: night
    trigger: time
  - minutes: /7
    id: cycle
    trigger: time_pattern
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: morning
      sequence:
      - target:
          entity_id: input_select.wallpaper
        data:
          options:
          - christian41.1
          - coffee1_11
          - coffee1_21
          - wallpaper7e
          - coffee1_31
          - coffee1_41
          - coffee1_51
          - coffee1_61
          - coffee1_71
        action: input_select.set_options
    - conditions:
      - condition: trigger
        id: midday
      sequence:
      - target:
          entity_id: input_select.wallpaper
        data:
          options:
          - christian1.1
          - wallpaper13
          - wallpaper7e
          - wallpaper66
          - christian21
          - wallpaper141
          - wallpaper33
          - christian31
          - wallpaper21
          - christian41.1
          - christian5
          - christian61
          - christian7.1
        action: input_select.set_options
    - conditions:
      - condition: trigger
        id: evening
      sequence:
      - target:
          entity_id: input_select.wallpaper
        data:
          options:
          - wallpaper141
          - wallpaper1
          - wallpaper13
          - wallpaper7e
          - wallpaper66
          - eye11
          - christian21
          - wallpaper121
          - ufo1
          - christian5
          - welcome4
          - christian1.1
          - wallpaper5
        action: input_select.set_options
    - conditions:
      - condition: trigger
        id: night
      sequence:
      - target:
          entity_id: input_select.wallpaper
        data:
          options:
          - christian41.1
          - wallpaper13
          - moonFull
          - christian31
          - wallpaper7e
          - wallpaper141
          - moon2Blue
          - wallpaper66
          - wallpaper1
          - christian21
          - wallpaper21
          - moonLake
        action: input_select.set_options
    - conditions:
      - condition: trigger
        id: cycle
      sequence:
      - target:
          entity_id: input_select.wallpaper
        action: input_select.select_next
      - action: input_select.random
        entity_id:
        - input_select.mobile_wallpaper
        - input_select.video_wallpaper
      - action: input_select.select_option
        data:
          option: mobile2
        target:
          entity_id: input_select.mobilelayout
- id: tablet_theme_video_wallpaper
  alias: '[Tablet] Theme Match for Video Wallpaper'
  description: Sets the browser theme based on the selected video wallpaper.
  triggers:
  - entity_id: input_select.video_wallpaper
    trigger: state
  actions:
  - action: script.browser_theme_{{ theme_suffix }}
  mode: single
  variables:
    theme_map:
      island: yellow
      waves: geaux
      nightClouds: ocean
      greenNeon: lime
      moonRising: orange
      berry: purple
      orangeSunset: orange
      inferno: orange
      fireworks: red
      fullMoon: orange
      fire: orange
      darkskyMoon: magenta
      spookyMoon: geaux
      beachyWaves: orange
      cloudyMoon: blue
      tunnel: blue
      veniceNight: orange
      stormyNight: geaux
      space: blue
      bubbling: pink
      blackBubbles: pink
      smoked: geaux
      fish: blue
      fish2: red
      fish3: ocean
      fish4: yellow
      fish5: green
      fishy2: ocean
      fishyRed: pink
      fishNew2: blue
      mars: blue
    selected_video: '{{ trigger.to_state.state }}'
    theme_suffix: '{{ theme_map.get(selected_video, ''lime'') }}'
- id: auto_fan_control_away_mode
  alias: '[Auto] Fan Control (Away Mode)'
  description: Turns Office and Guest fans on/off based on temp when away.
  triggers:
  - entity_id: sensor.office_temperature_2
    above: 75.5
    id: office_high
    trigger: numeric_state
  - entity_id: sensor.office_temperature_2
    below: 74
    id: office_low
    trigger: numeric_state
  - entity_id: sensor.guest_room_temperature
    above: 75.5
    id: guest_high
    trigger: numeric_state
  - entity_id: sensor.guest_room_temperature
    below: 74
    id: guest_low
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: group.person_group
    state: not_home
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: office_high
      sequence:
      - target:
          entity_id: fan.office_fan
        action: fan.turn_on
    - conditions:
      - condition: trigger
        id: office_low
      sequence:
      - target:
          entity_id: fan.office_fan
        action: fan.turn_off
    - conditions:
      - condition: trigger
        id: guest_high
      sequence:
      - target:
          entity_id: input_boolean.guest_ceiling_fan
        action: input_boolean.turn_on
      - continue_on_error: true
        data:
          command: turn on guest ceiling fan
        action: google_assistant_sdk.send_text_command
    - conditions:
      - condition: trigger
        id: guest_low
      sequence:
      - target:
          entity_id: input_boolean.guest_ceiling_fan
        action: input_boolean.turn_off
      - continue_on_error: true
        data:
          command: turn off guest ceiling fan
        action: google_assistant_sdk.send_text_command
- id: '1761795411635'
  alias: '[Master] Camera Last Motion Alerts'
  description: Handles all camera motion, analysis, and alerts for 4 zones.
  triggers:
  - entity_id: binary_sensor.back_motion
    to: 'on'
    id: back_door
    trigger: state
  - entity_id: binary_sensor.garage_motion_sensors
    to: 'on'
    id: garage
    trigger: state
  - entity_id: binary_sensor.front_porch_motion
    to: 'on'
    id: front_door
    trigger: state
  - device_id: 011d22447a45c26939459e4d099889cb
    domain: nest
    type: camera_person
    id: front_door
    trigger: device
  - entity_id: binary_sensor.side_motion_sensor
    to: 'on'
    id: side_door
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: back_door
      sequence:
      - variables:
          zone_name: Patio
          camera_entity: camera.patio_cam_0
          video_script: script.patio_video_snapshot
          alert_boolean: input_boolean.patio_garage_alerts
          tts_message: motion on patio
          nav_path: /dashboard-cast/patio
          snapshot_file: /config/www/tmp/last_snapshot_patio.jpg
          stream_command: stream patio camera
    - conditions:
      - condition: trigger
        id: garage
      sequence:
      - variables:
          zone_name: Garage
          camera_entity: camera.garage_cam_0
          video_script: script.garage_video_snapshot
          alert_boolean: input_boolean.patio_garage_alerts
          tts_message: Motion in garage
          nav_path: /dashboard-cast/garage
          snapshot_file: /config/www/tmp/last_snapshot_garage.jpg
          stream_command: stream garage camera
    - conditions:
      - condition: trigger
        id: front_door
      sequence:
      - variables:
          zone_name: Front Door
          camera_entity: camera.porch_cam_0
          video_script: script.porch_video_snapshot
          alert_boolean: input_boolean.camera_snapshots
          tts_message: Motion at front door
          nav_path: /dashboard-cast/porch
          snapshot_file: /config/www/tmp/last_snapshot_porch.jpg
          stream_command: stream porch camera
    - conditions:
      - condition: trigger
        id: side_door
      sequence:
      - variables:
          zone_name: Side Door
          camera_entity: camera.driveway_cam_0
          video_script: script.driveway_video_snapshot
          alert_boolean: input_boolean.camera_snapshots
          tts_message: motion at side door
          nav_path: /dashboard-cast/driveway
          snapshot_file: /config/www/tmp/last_snapshot_driveway.jpg
          stream_command: stream driveway camera
    default: []
  - continue_on_error: true
    target:
      entity_id: '{{ camera_entity }}'
    data:
      filename: '{{ snapshot_file }}'
    action: camera.snapshot
  - continue_on_error: true
    data:
      path: '{{ nav_path }}'
    action: browser_mod.navigate
  - target:
      entity_id: input_boolean.camera_motion_detected
    action: input_boolean.turn_on
  - continue_on_error: true
    data:
      provider: 01JZ8Q8C7HDXYKWP5JF8M4ECFX
      message: 'Classify the security event based on this image from the {{ zone_name
        }} camera. Choose from the following options: "passive" only when no people
        are present, "time-sensitive" for notable but non-critical events such as
        a person visible, and "critical" only for potential burglaries or highly suspicious
        activity. Respond with one of these options exactly, without additional explanation.

        '
      remember: true
      use_memory: true
      model: gpt-4o-mini
      image_file: '{{ snapshot_file }}'
      include_filename: true
      target_width: 1280
      max_tokens: 3
      generate_title: true
      expose_images: true
    response_variable: response
    action: llmvision.image_analyzer
  - variables:
      label: '{{ response.title }}'
      local_image: '{{ snapshot_file | replace(''/config/www'', ''/local'') }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ response.response_text|lower == ''passive'' }}'
      sequence:
      - delay:
          milliseconds: 10
    - conditions:
      - condition: template
        value_template: '{{ is_state(alert_boolean, ''on'') }}'
      - condition: time
        after: '22:00:00'
        before: 07:00:00
      sequence:
      - continue_on_error: true
        target:
          entity_id: '{{ video_script }}'
        action: script.turn_on
      - continue_on_error: true
        data:
          entity_id: media_player.office_display
          volume_level: 0.3
        action: media_player.volume_set
      - continue_on_error: true
        data:
          cache: true
          entity_id: media_player.office_display
          message: '{{ tts_message }}'
        action: tts.google_say
      - continue_on_error: true
        data:
          command: '{{ stream_command }} on office display'
        action: google_assistant_sdk.send_text_command
      - delay:
          milliseconds: 10
      - continue_on_error: true
        data:
          title: '{{ label }}'
          message: '{{ response.response_text }}'
          data:
            notification_icon: mdi:cctv
            image: '{{ local_image }}'
            persistent: true
            color: red
            channel: Cameras
            tag: Motion
            actions:
            - action: URI
              title: Click to Open Cameras
              uri: '{{ nav_path }}'
        action: notify.notify_all
      - delay:
          seconds: 240
    - conditions:
      - condition: template
        value_template: '{{ is_state(alert_boolean, ''on'') }}'
      - condition: time
        after: 07:00:01
        before: '21:59:59'
      sequence:
      - continue_on_error: true
        target:
          entity_id: '{{ video_script }}'
        action: script.turn_on
      - continue_on_error: true
        data:
          entity_id: media_player.tv_speakers
          volume_level: 0.6
        action: media_player.volume_set
      - continue_on_error: true
        data:
          cache: true
          entity_id: media_player.tv_speakers
          message: '{{ tts_message }}'
        action: tts.google_say
      - delay:
          milliseconds: 10
      - continue_on_error: true
        data:
          title: '{{ label }}'
          message: '{{ response.response_text }}'
          data:
            notification_icon: mdi:cctv
            image: '{{ local_image }}'
            persistent: true
            color: red
            channel: Cameras
            tag: Motion
            actions:
            - action: URI
              title: Click to Open Cameras
              uri: '{{ nav_path }}'
        action: notify.notify_all
      - delay:
          seconds: 120
    default: []
  - target:
      entity_id: input_boolean.camera_motion_detected
    action: input_boolean.turn_off
  - continue_on_error: true
    data:
      code: history.back()
    target: {}
    action: browser_mod.javascript
  - continue_on_error: true
    data:
      path: /lovelace/newtab
      browser_id:
      - 6077e78a0bccd7ab8ef18e1689611a46
      - 8ee04fb979f15f78deb7840ab3ca3242
    enabled: true
    action: browser_mod.navigate
  - continue_on_error: true
    data:
      entity_id: media_player.tv_speakers
      volume_level: 0.3
    action: media_player.volume_set
  - delay:
      milliseconds: 10
  - continue_on_error: true
    data:
      entity_id: media_player.office_display
      volume_level: 0.2
    action: media_player.volume_set
  mode: restart
  max_exceeded: silent
- id: '1761876381224'
  alias: '[Motion] Bedroom Motion Lights (remix)'
  description: ''
  triggers:
  - entity_id: binary_sensor.bedroom_motion_sensors
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.bedroom_door
    state: 'on'
  - condition: state
    entity_id: group.person_group
    state: home
  - condition: state
    entity_id: input_boolean.motion_lights
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: time
        after: 09:30:00
        before: '18:30:00'
      sequence:
      - continue_on_error: true
        target:
          entity_id:
          - light.mood_lights
          - light.donnas_light
          - light.darrens_nightstand_light
        data:
          brightness_pct: 45
        action: light.turn_on
      - continue_on_error: true
        target:
          entity_id: switch.ensuite_kiosk_screen
        action: switch.turn_on
    - conditions:
      - condition: time
        after: '18:30:01'
        before: '20:30:00'
      sequence:
      - continue_on_error: true
        target:
          entity_id:
          - light.mood_lights
          - light.donnas_light
          - light.darrens_nightstand_light
        data:
          brightness_pct: 15
        action: light.turn_on
      - continue_on_error: true
        target:
          entity_id: switch.ensuite_kiosk_screen
        action: switch.turn_on
    - conditions:
      - condition: time
        after: '20:30:01'
        before: '21:30:00'
      sequence:
      - continue_on_error: true
        target:
          entity_id:
          - light.donnas_light
          - light.darrens_nightstand_light
        data:
          brightness_pct: 5
        action: light.turn_on
      - continue_on_error: true
        target:
          entity_id: switch.ensuite_kiosk_screen
        action: switch.turn_on
    - conditions:
      - condition: time
        after: '21:30:01'
        before: '22:30:00'
      sequence:
      - continue_on_error: true
        target:
          entity_id: light.donnas_light
        data:
          brightness_pct: 5
        action: light.turn_on
      - continue_on_error: true
        target:
          entity_id: switch.ensuite_kiosk_screen
        action: switch.turn_on
    default:
    - continue_on_error: true
      target:
        entity_id: light.darrens_nightstand_light
      data:
        brightness_pct: 1
      action: light.turn_on
  - wait_for_trigger:
    - entity_id: binary_sensor.bedroom_motion_sensors
      from: 'on'
      to: 'off'
      trigger: state
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.bedroom_door
        state: 'on'
      sequence:
      - delay:
          seconds: 800
      - continue_on_error: true
        target:
          entity_id: light.mood_lights
        action: light.turn_off
      - delay:
          seconds: 800
      - continue_on_error: true
        target:
          entity_id: light.darrens_nightstand_light
        action: light.turn_off
      - delay:
          seconds: 1800
      - continue_on_error: true
        target:
          entity_id: light.donnas_light
        action: light.turn_off
      - continue_on_error: true
        target:
          entity_id: switch.ensuite_kiosk_screen
        action: switch.turn_off
    default: []
  mode: restart
  max_exceeded: silent
- id: '1761877868563'
  alias: '[Presence] Darren Arrives - Office Actions'
  description: Turns on office fan and monitor when Darren arrives home and enters
    the office.
  triggers:
  - entity_id: person.darren
    from: not_home
    to: home
    trigger: state
  actions:
  - wait_for_trigger:
    - entity_id: binary_sensor.office_motion_sensors
      from: 'off'
      to: 'on'
      trigger: state
    timeout:
      minutes: 30
    continue_on_timeout: true
  - target:
      entity_id:
      - fan.hallway_fan
      - switch.ha2_office_monitor
    action: homeassistant.turn_on
  mode: single
- id: '1761878499879'
  alias: '[Remote] Patio Remote Control'
  description: Handles all 4 button presses for the patio remote.
  triggers:
  - device_id: 678ee59e9221d02b1ee09145dd4183f1
    domain: bthome
    type: button_1
    subtype: press
    id: patio_btn_1
    trigger: device
  - device_id: 678ee59e9221d02b1ee09145dd4183f1
    domain: bthome
    type: button_2
    subtype: press
    id: patio_btn_2
    trigger: device
  - device_id: 678ee59e9221d02b1ee09145dd4183f1
    domain: bthome
    type: button_3
    subtype: press
    id: patio_btn_3
    trigger: device
  - device_id: 678ee59e9221d02b1ee09145dd4183f1
    domain: bthome
    type: button_4
    subtype: press
    id: patio_btn_4
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: patio_btn_1
      sequence:
      - target:
          entity_id: light.patio_led_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: patio_btn_2
      sequence:
      - target:
          entity_id: switch.patio_fountain_plug
        action: switch.toggle
    - conditions:
      - condition: trigger
        id: patio_btn_3
      sequence:
      - target:
          entity_id: input_boolean.patio_mister_switch
        action: input_boolean.toggle
    - conditions:
      - condition: trigger
        id: patio_btn_4
      sequence:
      - target:
          entity_id: light.outside_lights
        action: light.toggle
    default: []
  mode: single
- id: '1761879094337'
  alias: '[Remote] Bedroom Remote Control'
  description: Handles all button presses for the bedroom remote.
  triggers:
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_1
    subtype: press
    id: bed_btn_1_press
    trigger: device
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_1
    subtype: long_press
    id: bed_btn_1_long
    trigger: device
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_1
    subtype: double_press
    id: bed_btn_1_double
    trigger: device
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_2
    subtype: press
    id: bed_btn_2_press
    trigger: device
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_3
    subtype: press
    id: bed_btn_3_press
    trigger: device
  - device_id: adb14876079214910d4e2e8f2cf6fbf2
    domain: bthome
    type: button_4
    subtype: press
    id: bed_btn_4_press
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: bed_btn_1_press
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        action: light.toggle
    - conditions:
      - condition: trigger
        id: bed_btn_1_long
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        data:
          rgb_color:
          - 255
          - 0
          - 0
          brightness_pct: 16
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: bed_btn_1_double
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        data:
          color_temp_kelvin: 3000
          brightness_pct: 15
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: bed_btn_2_press
      sequence:
      - target:
          entity_id: light.bedroom_ceiling
        action: light.toggle
    - conditions:
      - condition: trigger
        id: bed_btn_3_press
      sequence:
      - target:
          entity_id: light.mood_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: bed_btn_4_press
      sequence:
      - target:
          entity_id: light.bedroom_lights
        action: light.toggle
    default: []
  mode: single
- id: '1761879585763'
  alias: '[Remote] Den Remote Control'
  description: Handles all button presses for the den remote.
  triggers:
  - device_id: 8fcbe6652dc5f7737c49fda014896978
    domain: bthome
    type: button_1
    subtype: press
    id: den_btn_1_press
    trigger: device
  - device_id: 8fcbe6652dc5f7737c49fda014896978
    domain: bthome
    type: button_2
    subtype: press
    id: den_btn_2_press
    trigger: device
  - device_id: 8fcbe6652dc5f7737c49fda014896978
    domain: bthome
    type: button_3
    subtype: press
    id: den_btn_3_press
    trigger: device
  - device_id: 8fcbe6652dc5f7737c49fda014896978
    domain: bthome
    type: button_4
    subtype: press
    id: den_btn_4_press
    trigger: device
  - device_id: 8fcbe6652dc5f7737c49fda014896978
    domain: bthome
    type: button_4
    subtype: long_press
    id: den_btn_4_long
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: den_btn_1_press
      sequence:
      - target:
          entity_id: light.foyer_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: den_btn_2_press
      sequence:
      - target:
          entity_id: light.porch_light_mini
        action: light.toggle
    - conditions:
      - condition: trigger
        id: den_btn_3_press
      sequence:
      - target:
          entity_id: light.outside_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: den_btn_4_press
      sequence:
      - target:
          entity_id: light.den_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: den_btn_4_long
      sequence:
      - target:
          entity_id: light.every_light
        action: light.turn_off
      - delay:
          milliseconds: 500
      - target:
          entity_id: light.tv_ambient_lights
        action: light.turn_on
    default: []
  mode: single
- id: '1761881973438'
  alias: '[Remote] Kitchen Remote Control 2'
  description: Handles all button presses for kitchen remote 2.
  triggers:
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_1
    subtype: press
    id: kitch_1_btn_1_press
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_1
    subtype: double_press
    id: kitch_1_btn_1_double
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_1
    subtype: long_press
    id: kitch_1_btn_1_long
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_2
    subtype: press
    id: kitch_1_btn_2_press
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_3
    subtype: press
    id: kitch_1_btn_3_press
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_3
    subtype: long_press
    id: kitch_1_btn_3_long
    trigger: device
  - device_id: 8d5ed8bf9702b9d30766b381026f1fd3
    domain: bthome
    type: button_4
    subtype: long_press
    id: kitch_1_btn_4_long
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: kitch_1_btn_1_press
      sequence:
      - target:
          entity_id: light.kitchen_ceiling_lights_3
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_1_btn_1_double
      sequence:
      - target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 25
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: kitch_1_btn_1_long
      sequence:
      - target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 100
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: kitch_1_btn_2_press
      sequence:
      - target:
          entity_id: light.under_cabinet_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_1_btn_3_press
      sequence:
      - target:
          entity_id: light.table_light
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_1_btn_3_long
      sequence:
      - target:
          entity_id: input_boolean.romance_time
        action: input_boolean.turn_on
    - conditions:
      - condition: trigger
        id: kitch_1_btn_4_long
      sequence:
      - target:
          entity_id: light.every_light
        action: light.turn_off
      - delay:
          milliseconds: 500
      - target:
          entity_id: light.tv_ambient_lights
        action: light.turn_on
    default: []
  mode: single
- id: '1761882426306'
  alias: '[Remote] Kitchen Remote Control 1'
  description: Handles all button presses for the main kitchen remote 1.
  triggers:
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_1
    subtype: press
    id: kitch_btn_1_press
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_1
    subtype: long_press
    id: kitch_btn_1_long
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_1
    subtype: double_press
    id: kitch_btn_1_double
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_2
    subtype: press
    id: kitch_btn_2_press
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_2
    subtype: long_press
    id: kitch_btn_2_long
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_3
    subtype: press
    id: kitch_btn_3_press
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_4
    subtype: press
    id: kitch_btn_4_press
    trigger: device
  - device_id: 5089e3c96fa21a53fa7baa762b008778
    domain: bthome
    type: button_4
    subtype: long_press
    id: kitch_btn_4_long
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: kitch_btn_1_press
      sequence:
      - target:
          entity_id: light.kitchen_ceiling_lights_3
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_btn_1_long
      sequence:
      - target:
          entity_id: light.sofa_lamp
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_btn_1_double
      sequence:
      - target:
          entity_id: light.kitchen_ceiling_lights_3
        data:
          brightness_pct: 25
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: kitch_btn_2_press
      sequence:
      - target:
          entity_id: light.under_cabinet_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_btn_2_long
      sequence:
      - target:
          entity_id: light.fireplace_lights
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_btn_3_press
      sequence:
      - target:
          entity_id: light.table_light
        action: light.toggle
    - conditions:
      - condition: trigger
        id: kitch_btn_4_press
      sequence:
      - target:
          entity_id: light.kitchen_lights
        action: light.turn_off
    - conditions:
      - condition: trigger
        id: kitch_btn_4_long
      sequence:
      - target:
          entity_id: light.every_light
        action: light.turn_off
      - delay:
          milliseconds: 500
      - target:
          entity_id: light.tv_ambient_lights
        action: light.turn_on
    default: []
  mode: single
- id: '1761882949117'
  alias: '[Remote] Ensuite Remote Control'
  description: Handles all button presses for the ensuite remote.
  triggers:
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_1
    subtype: press
    id: ensuite_btn_1_press
    trigger: device
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_1
    subtype: double_press
    id: ensuite_btn_1_double
    trigger: device
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_1
    subtype: long_press
    id: ensuite_btn_1_long
    trigger: device
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_2
    subtype: press
    id: ensuite_btn_2_press
    trigger: device
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_3
    subtype: press
    id: ensuite_btn_3_press
    trigger: device
  - device_id: 440e3fe1262b930f2812b5da9ca95f6b
    domain: bthome
    type: button_4
    subtype: press
    id: ensuite_btn_4_press
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: ensuite_btn_1_press
      sequence:
      - target:
          entity_id: light.jacuzzi_color
        action: light.toggle
    - conditions:
      - condition: trigger
        id: ensuite_btn_1_double
      sequence:
      - target:
          entity_id: light.jacuzzi_color
        data:
          color_temp_kelvin: 3600
          brightness_pct: 10
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: ensuite_btn_1_long
      sequence:
      - target:
          entity_id: light.jacuzzi_color
        data:
          brightness_pct: 100
          color_temp_kelvin: 3600
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: ensuite_btn_2_press
      sequence:
      - target:
          entity_id: light.jacuzzi_color
        data:
          color_temp_kelvin: 3600
          brightness_pct: 10
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: ensuite_btn_3_press
      sequence:
      - target:
          entity_id: light.jacuzzi_color
        data:
          brightness_pct: 50
          color_name: deeppink
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: ensuite_btn_4_press
      sequence:
      - target:
          entity_id: light.jacuzzi_color
        data:
          brightness_pct: 50
          color_name: darkviolet
        action: light.turn_on
    default: []
  mode: single
- id: '1761883452271'
  alias: '[Remote] Nightstand Remote Control'
  description: Handles all 4 button presses for nightstand remote.
  triggers:
  - device_id: 78ff2e94b80783ed2058499a305889b0
    domain: zha
    type: remote_button_short_press
    subtype: button_1
    id: nightstand_btn_1_press
    trigger: device
  - device_id: 78ff2e94b80783ed2058499a305889b0
    domain: zha
    type: remote_button_short_press
    subtype: button_2
    id: nightstand_btn_2_press
    trigger: device
  - device_id: 78ff2e94b80783ed2058499a305889b0
    domain: zha
    type: remote_button_short_press
    subtype: button_3
    id: nightstand_btn_3_press
    trigger: device
  - device_id: 78ff2e94b80783ed2058499a305889b0
    domain: zha
    type: remote_button_short_press
    subtype: button_4
    id: nightstand_btn_4_press
    trigger: device
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: nightstand_btn_1_press
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        data:
          transition: 3
        action: light.toggle
    - conditions:
      - condition: trigger
        id: nightstand_btn_2_press
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        data:
          brightness_pct: 1
          color_temp_kelvin: 2496
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: nightstand_btn_3_press
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        data:
          brightness_pct: 15
          color_temp_kelvin: 4000
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: nightstand_btn_4_press
      sequence:
      - target:
          entity_id: light.nightstand_lamps
        data:
          brightness_pct: 35
          color_name: red
        action: light.turn_on
    default: []
  mode: single
- id: '1761884965420'
  alias: '[Control] HVAC Mister'
  description: Turns the HVAC mister on when cooling (if warm/dry) and off when idle.
  triggers:
  - entity_id: sensor.hvac_mode
    to: cooling
    id: turn_on
    trigger: state
  - entity_id: sensor.hvac_mode
    to: idle
    for:
      seconds: 60
    id: turn_off
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: turn_on
      - condition: state
        entity_id: binary_sensor.night
        state: 'off'
      - condition: not
        conditions:
        - condition: state
          entity_id: weather.home
          state: rainy
      - condition: numeric_state
        entity_id: sensor.outside_recent_temperature
        above: 77
      sequence:
      - target:
          entity_id: switch.hvac_mister_2
        action: switch.turn_on
    - conditions:
      - condition: trigger
        id: turn_off
      - condition: state
        entity_id: switch.hvac_mister_2
        state: 'on'
      sequence:
      - target:
          entity_id: switch.hvac_mister_2
        action: switch.turn_off
    default: []
  mode: single
- id: '1761928278535'
  alias: '[Presence] Last Person Leaves - Away actions'
  description: Runs the 'away' script when the last person has left.
  triggers:
  - entity_id: input_boolean.darren_home
    from: 'on'
    to: 'off'
    id: darren_left
    trigger: state
  - entity_id: input_boolean.donna_home
    from: 'on'
    to: 'off'
    id: donna_left
    trigger: state
  conditions:
  - condition: template
    value_template: "{{ (trigger.id == 'darren_left' and is_state('input_boolean.donna_home',
      'off')) or\n   (trigger.id == 'donna_left' and is_state('input_boolean.darren_home',
      'off')) }}"
  actions:
  - target:
      entity_id: alarm_control_panel.alarmo
    data:
      code: '{{ states(''input_text.secure_code'') }}'
    action: alarm_control_panel.alarm_arm_away
  - target:
      entity_id: switch.main_kiosk_screen
    action: switch.turn_off
  - continue_on_error: true
    target:
      entity_id:
      - light.every_light
      - input_boolean.auto_tablet
      - input_boolean.auto_cameras
      - input_boolean.disable_popups
      - input_boolean.disable_cabinet_auto_lights
      - input_boolean.disable_patio_motion
      - input_boolean.disable_garage_auto_lights
      - input_boolean.auto_backgroundz
      - switch.night_switches
      - switch.den_nightlight_plugs
    action: homeassistant.turn_off
  - delay:
      seconds: 3
  - continue_on_error: true
    data:
      command: turn off kitchen water heater
    action: google_assistant_sdk.send_text_command
  - continue_on_error: true
    target:
      entity_id:
      - input_boolean.door_announcements
      - input_boolean.camera_snapshots
      - input_boolean.patio_garage_alerts
      - light.sofa_lamp
      - light.under_cabinet_lights
      - input_boolean.motion_lights
    action: homeassistant.turn_on
  - continue_on_error: true
    action: script.nest_set_away
  - delay:
      seconds: 10
  - continue_on_error: true
    data:
      entity_id: media_player.kitchen_speakers_2
      volume_level: 0.5
    action: media_player.volume_set
  - delay:
      seconds: 5
  - continue_on_error: true
    target:
      entity_id: media_player.kitchen_speakers_2
    data:
      media:
        media_content_id: library://radio/3
        media_content_type: music
        metadata: {}
    action: media_player.play_media
  - delay:
      seconds: 3
  - continue_on_error: true
    data:
      command: turn off den tv
    action: google_assistant_sdk.send_text_command
  - delay:
      seconds: 3
  - continue_on_error: true
    target:
      entity_id:
      - lock.side_door
      - lock.back_door
    action: lock.lock
  mode: single
- id: '1761947757593'
  alias: Report state on start-up remixed
  description: Publishes to MQTT, reloads kiosks, and sets theme on startup
  triggers:
  - event: start
    trigger: homeassistant
  actions:
  - data:
      topic: shellies/command
      payload: announce
    action: mqtt.publish
  - delay:
      seconds: 2
  - continue_on_error: true
    target:
      entity_id:
      - button.main_kiosk_load_start_url
      - button.ensuite_kiosk_load_start_url
    action: button.press
  - delay:
      seconds: 2
  - data:
      name: Blue-Nightz
    action: frontend.set_theme
  mode: single
- id: '1761948127841'
  alias: Turn on lights when garage or side door opened after dark(remix)
  description: ''
  triggers:
  - entity_id:
    - cover.garage_door
    - binary_sensor.side_door_bt
    to:
    - open
    - 'on'
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: sun
      after: sunset
      after_offset: 00:15:00
    - condition: sun
      before: sunrise
      before_offset: 00:15:00
  actions:
  - target:
      entity_id: light.front_yard_lights
    action: light.turn_on
  - delay:
      minutes: 10
  - target:
      entity_id: light.front_yard_lights
    action: light.turn_off
  mode: restart
- id: '1761965575144'
  alias: '[Presence] First Person Arrives - Welcome actions'
  description: Runs 'welcome home' script when the first person arrives.
  triggers:
  - entity_id: input_boolean.darren_home
    from: 'off'
    to: 'on'
    id: darren
    trigger: state
  - entity_id: input_boolean.donna_home
    from: 'off'
    to: 'on'
    id: donna
    trigger: state
  conditions:
  - condition: template
    value_template: "{{ (trigger.id == 'darren' and is_state('input_boolean.donna_home',
      'off')) or\n   (trigger.id == 'donna' and is_state('input_boolean.darren_home',
      'off')) }}"
  actions:
  - continue_on_error: true
    target:
      entity_id:
      - input_boolean.camera_snapshots
      - input_boolean.disable_popups
      - input_boolean.auto_tablet
      - input_boolean.auto_backgroundz
      - input_boolean.disable_inside_popups
      - switch.main_kiosk_screen
      - switch.den_nightlight_plugs
    action: homeassistant.turn_on
  - continue_on_error: true
    data:
      command: turn on kitchen water heater
    action: google_assistant_sdk.send_text_command
  - continue_on_error: true
    target:
      entity_id:
      - input_boolean.notifications
      - input_boolean.motion_lights
      - input_boolean.patio_garage_alerts
    action: homeassistant.turn_off
  - continue_on_error: true
    data:
      entity_id: media_player.kitchen_speakers_2
      volume_level: 0.4
    action: media_player.volume_set
  - if:
    - condition: state
      entity_id: media_player.kitchen_speakers_2
      state: playing
    then:
    - continue_on_error: true
      target:
        entity_id: media_player.kitchen_speakers_2
      action: media_player.media_stop
  - continue_on_error: true
    action: script.nest_set_home
  - delay:
      minutes: 3
  - continue_on_error: true
    target:
      entity_id:
      - switch.main_kiosk_screen
      - switch.ensuite_kiosk_screen
    action: switch.turn_on
  - continue_on_error: true
    target:
      entity_id:
      - light.main_kiosk_screen
      - light.ensuite_kiosk_screen
    action: light.turn_on
  - continue_on_error: true
    data:
      path: /lovelace/newtab
      browser_id:
      - 22de4b5bc46885f8fafdf89c6db80a28
      - 8ee04fb979f15f78deb7840ab3ca3242
    action: browser_mod.navigate
  - choose:
    - conditions:
      - condition: state
        entity_id: light.outside_lights
        state: 'off'
      sequence:
      - stop: Outside lights are already off
    - conditions:
      - condition: time
        after: '22:00:00'
        before: 07:00:00
      sequence:
      - delay:
          minutes: 4
      - target:
          entity_id: light.outside_lights
        action: light.turn_off
    - conditions:
      - condition: time
        after: 07:00:01
        before: '21:59:59'
      sequence:
      - delay:
          minutes: 10
      - target:
          entity_id: light.outside_lights
        action: light.turn_off
  mode: single
- id: '1761977564662'
  alias: '[Presence] Master Presence Control v7'
  description: Handles person-based presence for arrivals and departures.
  triggers:
  - entity_id: person.darren
    from: not_home
    to: home
    id: darren
    trigger: state
  - entity_id: person.darren
    from: home
    to: not_home
    id: darren
    trigger: state
  - entity_id: person.donna
    from: not_home
    to: home
    id: donna
    trigger: state
  - entity_id: person.donna
    from: home
    to: not_home
    id: donna
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ is_arriving }}'
      sequence:
      - target:
          entity_id: alarm_control_panel.alarmo
        data:
          code: '{{ states(''input_text.secure_code'') }}'
        action: alarm_control_panel.alarm_disarm
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.night
            state: 'on'
          sequence:
          - target:
              entity_id: light.outside_lights
            action: light.turn_on
        - conditions:
          - condition: state
            entity_id: binary_sensor.night
            state: 'off'
          sequence:
          - continue_on_error: true
            target:
              entity_id:
              - light.entryway_ceiling_dimmer
              - light.laundry_room_dimmer
            action: light.turn_on
      - choose:
        - conditions:
          - condition: state
            entity_id: cover.garage_door
            state: closed
          sequence:
          - target:
              entity_id: cover.garage_door
            action: cover.open_cover
        - conditions:
          - condition: state
            entity_id: cover.garage_door
            state: open
          sequence:
          - target:
              entity_id: light.garage_lights
            action: light.turn_on
      - choose:
        - conditions:
          - condition: trigger
            id: darren
          sequence:
          - target:
              entity_id: input_boolean.darren_home
            action: input_boolean.turn_on
          - target:
              entity_id:
              - input_boolean.patio_garage_alerts
              - input_boolean.naptime
            action: input_boolean.turn_off
        - conditions:
          - condition: trigger
            id: donna
          sequence:
          - target:
              entity_id: input_boolean.donna_home
            action: input_boolean.turn_on
          - target:
              entity_id: input_boolean.patio_garage_alerts
            action: input_boolean.turn_off
    - conditions:
      - condition: template
        value_template: '{{ not is_arriving }}'
      sequence:
      - choose:
        - conditions:
          - condition: trigger
            id: darren
          sequence:
          - target:
              entity_id: input_boolean.camera_snapshots
            action: input_boolean.turn_on
          - continue_on_error: true
            target:
              entity_id:
              - input_boolean.darren_home
              - light.office_lights
              - switch.ha2_office_monitor
              - fan.hallway_fan
              - switch.office_work_bench
              - switch.keurig_coffee_maker
            action: homeassistant.turn_off
        - conditions:
          - condition: trigger
            id: donna
          sequence:
          - target:
              entity_id: input_boolean.donna_home
            action: input_boolean.turn_off
          - target:
              entity_id: input_boolean.patio_garage_alerts
            action: input_boolean.turn_on
  mode: queued
  max_exceeded: silent
  variables:
    is_arriving: '{{ trigger.to_state.state == ''home'' }}'
- id: '1762015911681'
  alias: Mailbox Opened Notification
  description: ''
  triggers:
  - device_id: 36598d5759f923c08a41bacff5b869ac
    domain: binary_sensor
    entity_id: e8b3607933bd162bd10ead26edd60570
    type: opened
    trigger: device
  actions:
  - data:
      volume_level: 0
    target:
      entity_id: media_player.living_room_google
    action: media_player.volume_set
  - target:
      entity_id: media_player.living_room_google
    action: media_player.turn_on
  - delay:
      seconds: 1
  - data:
      volume_level: 0.7
    target:
      entity_id: media_player.living_room_google
    action: media_player.volume_set
  - delay:
      seconds: 1
  - target:
      entity_id: media_player.living_room_google
    data:
      media:
        media_content_id: media-source://media_source/local/youve-got-mail-sound.mp3
        media_content_type: audio/mpeg
        metadata: {}
    action: media_player.play_media
  - if:
    - condition: state
      entity_id: sensor.pixel_8_pro_ringer_mode
      state: normal
    - condition: state
      entity_id: sensor.pixel_8_pro_do_not_disturb_sensor
      state: 'off'
    then:
    - data:
        message: TTS
        data:
          tts_text: You've got mail!!!
          media_stream: alarm_stream_max
      action: notify.mobile_app_pixel_8_pro
  - data:
      message: Mailbox opened at {{ states('sensor.time_12_hour_am_pm') }}
      data:
        notification_icon: mdi:mailbox
        visibility: public
    action: notify.mobile_app_pixel_8_pro
  - delay:
      seconds: 4
  - data:
      volume_level: 0.4
    target:
      entity_id: media_player.living_room_google
    action: media_player.volume_set
  mode: queued
